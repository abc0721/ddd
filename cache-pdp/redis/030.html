<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>030. redis cluster 通过 master 水平扩容来支撑更高的读写吞吐 + 海量数据 | LEARN-BOOK</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/learn-book/favicon.ico">
    <link rel="manifest" href="/learn-book/manifest.json">
    <meta name="description" content="note-book 的第二分仓笔记仓库">
    
    <link rel="preload" href="/learn-book/assets/css/0.styles.d1598957.css" as="style"><link rel="preload" href="/learn-book/assets/js/app.028ed7df.js" as="script"><link rel="preload" href="/learn-book/assets/js/2.21223788.js" as="script"><link rel="preload" href="/learn-book/assets/js/308.af120a3e.js" as="script"><link rel="preload" href="/learn-book/assets/js/83.ec5af474.js" as="script"><link rel="prefetch" href="/learn-book/assets/js/10.ae9ef0d5.js"><link rel="prefetch" href="/learn-book/assets/js/100.e2686a94.js"><link rel="prefetch" href="/learn-book/assets/js/101.1e48f558.js"><link rel="prefetch" href="/learn-book/assets/js/102.2b0aead0.js"><link rel="prefetch" href="/learn-book/assets/js/103.36a9d0c5.js"><link rel="prefetch" href="/learn-book/assets/js/104.940c0889.js"><link rel="prefetch" href="/learn-book/assets/js/105.4059f322.js"><link rel="prefetch" href="/learn-book/assets/js/106.258dd171.js"><link rel="prefetch" href="/learn-book/assets/js/107.dc32950f.js"><link rel="prefetch" href="/learn-book/assets/js/108.f96a8dee.js"><link rel="prefetch" href="/learn-book/assets/js/109.ba4b933c.js"><link rel="prefetch" href="/learn-book/assets/js/11.a08a42ea.js"><link rel="prefetch" href="/learn-book/assets/js/110.3035f734.js"><link rel="prefetch" href="/learn-book/assets/js/111.fa05b698.js"><link rel="prefetch" href="/learn-book/assets/js/112.bbb150f0.js"><link rel="prefetch" href="/learn-book/assets/js/113.1263dcc6.js"><link rel="prefetch" href="/learn-book/assets/js/114.82285aec.js"><link rel="prefetch" href="/learn-book/assets/js/115.7509736a.js"><link rel="prefetch" href="/learn-book/assets/js/116.f57394f2.js"><link rel="prefetch" href="/learn-book/assets/js/117.9f37dd43.js"><link rel="prefetch" href="/learn-book/assets/js/118.73b62d5e.js"><link rel="prefetch" href="/learn-book/assets/js/119.ccc80315.js"><link rel="prefetch" href="/learn-book/assets/js/12.40792829.js"><link rel="prefetch" href="/learn-book/assets/js/120.0feeb1b4.js"><link rel="prefetch" href="/learn-book/assets/js/121.7bbdbedc.js"><link rel="prefetch" href="/learn-book/assets/js/122.f239e92d.js"><link rel="prefetch" href="/learn-book/assets/js/123.430e5350.js"><link rel="prefetch" href="/learn-book/assets/js/124.4a74a756.js"><link rel="prefetch" href="/learn-book/assets/js/125.9d441c34.js"><link rel="prefetch" href="/learn-book/assets/js/126.97b348bf.js"><link rel="prefetch" href="/learn-book/assets/js/127.85743ce6.js"><link rel="prefetch" href="/learn-book/assets/js/128.133b2151.js"><link rel="prefetch" href="/learn-book/assets/js/129.91eacdb7.js"><link rel="prefetch" href="/learn-book/assets/js/13.65102ef7.js"><link rel="prefetch" href="/learn-book/assets/js/130.00470fe8.js"><link rel="prefetch" href="/learn-book/assets/js/131.181aef24.js"><link rel="prefetch" href="/learn-book/assets/js/132.4166cdea.js"><link rel="prefetch" href="/learn-book/assets/js/133.ec5b9acc.js"><link rel="prefetch" href="/learn-book/assets/js/134.0c928687.js"><link rel="prefetch" href="/learn-book/assets/js/135.0b49f1c2.js"><link rel="prefetch" href="/learn-book/assets/js/136.be67ae82.js"><link rel="prefetch" href="/learn-book/assets/js/137.6f85ad05.js"><link rel="prefetch" href="/learn-book/assets/js/138.b3fa2ba7.js"><link rel="prefetch" href="/learn-book/assets/js/139.abf8672e.js"><link rel="prefetch" href="/learn-book/assets/js/14.4813a349.js"><link rel="prefetch" href="/learn-book/assets/js/140.d03ed1c1.js"><link rel="prefetch" href="/learn-book/assets/js/141.da6ec0e4.js"><link rel="prefetch" href="/learn-book/assets/js/142.09aed130.js"><link rel="prefetch" href="/learn-book/assets/js/143.4cffc3e5.js"><link rel="prefetch" href="/learn-book/assets/js/144.224499c6.js"><link rel="prefetch" href="/learn-book/assets/js/145.0268dd0e.js"><link rel="prefetch" href="/learn-book/assets/js/146.f0d0970e.js"><link rel="prefetch" href="/learn-book/assets/js/147.4a203a56.js"><link rel="prefetch" href="/learn-book/assets/js/148.3b084bf3.js"><link rel="prefetch" href="/learn-book/assets/js/149.d42b82bd.js"><link rel="prefetch" href="/learn-book/assets/js/15.ca243d77.js"><link rel="prefetch" href="/learn-book/assets/js/150.30cad9c9.js"><link rel="prefetch" href="/learn-book/assets/js/151.a27ba2c5.js"><link rel="prefetch" href="/learn-book/assets/js/152.8e388b90.js"><link rel="prefetch" href="/learn-book/assets/js/153.380f332c.js"><link rel="prefetch" href="/learn-book/assets/js/154.163b241b.js"><link rel="prefetch" href="/learn-book/assets/js/155.dacd37a6.js"><link rel="prefetch" href="/learn-book/assets/js/156.9296f4c8.js"><link rel="prefetch" href="/learn-book/assets/js/157.0c12b4ce.js"><link rel="prefetch" href="/learn-book/assets/js/158.79e7656c.js"><link rel="prefetch" href="/learn-book/assets/js/159.02749d11.js"><link rel="prefetch" href="/learn-book/assets/js/16.22ac0778.js"><link rel="prefetch" href="/learn-book/assets/js/160.3efbd6a0.js"><link rel="prefetch" href="/learn-book/assets/js/161.11e17eb7.js"><link rel="prefetch" href="/learn-book/assets/js/162.ed81bb49.js"><link rel="prefetch" href="/learn-book/assets/js/163.c321ec8d.js"><link rel="prefetch" href="/learn-book/assets/js/164.6831a594.js"><link rel="prefetch" href="/learn-book/assets/js/165.9e13a7e1.js"><link rel="prefetch" href="/learn-book/assets/js/166.20287335.js"><link rel="prefetch" href="/learn-book/assets/js/167.06fe0883.js"><link rel="prefetch" href="/learn-book/assets/js/168.574a5d34.js"><link rel="prefetch" href="/learn-book/assets/js/169.78d54345.js"><link rel="prefetch" href="/learn-book/assets/js/17.467198e5.js"><link rel="prefetch" href="/learn-book/assets/js/170.a8a8c838.js"><link rel="prefetch" href="/learn-book/assets/js/171.bce5528f.js"><link rel="prefetch" href="/learn-book/assets/js/172.6d122eaf.js"><link rel="prefetch" href="/learn-book/assets/js/173.b7b1734b.js"><link rel="prefetch" href="/learn-book/assets/js/174.0c5ddece.js"><link rel="prefetch" href="/learn-book/assets/js/175.fcb3bb1e.js"><link rel="prefetch" href="/learn-book/assets/js/176.4c8b6c1b.js"><link rel="prefetch" href="/learn-book/assets/js/177.2c821a10.js"><link rel="prefetch" href="/learn-book/assets/js/178.4b938acb.js"><link rel="prefetch" href="/learn-book/assets/js/179.e5a3f9d5.js"><link rel="prefetch" href="/learn-book/assets/js/18.2c2655d3.js"><link rel="prefetch" href="/learn-book/assets/js/180.e075e24a.js"><link rel="prefetch" href="/learn-book/assets/js/181.a8659308.js"><link rel="prefetch" href="/learn-book/assets/js/182.e02e157b.js"><link rel="prefetch" href="/learn-book/assets/js/183.fec3be72.js"><link rel="prefetch" href="/learn-book/assets/js/184.06841422.js"><link rel="prefetch" href="/learn-book/assets/js/185.967d47f7.js"><link rel="prefetch" href="/learn-book/assets/js/186.b27543eb.js"><link rel="prefetch" href="/learn-book/assets/js/187.0ab43110.js"><link rel="prefetch" href="/learn-book/assets/js/188.d2c20c41.js"><link rel="prefetch" href="/learn-book/assets/js/189.e50ac920.js"><link rel="prefetch" href="/learn-book/assets/js/19.87356261.js"><link rel="prefetch" href="/learn-book/assets/js/190.0bcce66f.js"><link rel="prefetch" href="/learn-book/assets/js/191.1a3d3266.js"><link rel="prefetch" href="/learn-book/assets/js/192.b46f1f92.js"><link rel="prefetch" href="/learn-book/assets/js/193.7cd9a2e2.js"><link rel="prefetch" href="/learn-book/assets/js/194.c7cac8f4.js"><link rel="prefetch" href="/learn-book/assets/js/195.76b36b43.js"><link rel="prefetch" href="/learn-book/assets/js/196.9ad5f9de.js"><link rel="prefetch" href="/learn-book/assets/js/197.2914f34f.js"><link rel="prefetch" href="/learn-book/assets/js/198.2e2c2c64.js"><link rel="prefetch" href="/learn-book/assets/js/199.0d8fc29e.js"><link rel="prefetch" href="/learn-book/assets/js/20.8693e977.js"><link rel="prefetch" href="/learn-book/assets/js/200.2bc59ffe.js"><link rel="prefetch" href="/learn-book/assets/js/201.6765dba2.js"><link rel="prefetch" href="/learn-book/assets/js/202.d19062c8.js"><link rel="prefetch" href="/learn-book/assets/js/203.270e8e72.js"><link rel="prefetch" href="/learn-book/assets/js/204.0ecf2cd8.js"><link rel="prefetch" href="/learn-book/assets/js/205.b241dd2b.js"><link rel="prefetch" href="/learn-book/assets/js/206.3d555da2.js"><link rel="prefetch" href="/learn-book/assets/js/207.b88d10dc.js"><link rel="prefetch" href="/learn-book/assets/js/208.d15b9895.js"><link rel="prefetch" href="/learn-book/assets/js/209.404964dd.js"><link rel="prefetch" href="/learn-book/assets/js/21.ce55ac2d.js"><link rel="prefetch" href="/learn-book/assets/js/210.8a6ad39b.js"><link rel="prefetch" href="/learn-book/assets/js/211.9f828903.js"><link rel="prefetch" href="/learn-book/assets/js/212.ecdb6c3d.js"><link rel="prefetch" href="/learn-book/assets/js/213.093b4b7f.js"><link rel="prefetch" href="/learn-book/assets/js/214.17e91916.js"><link rel="prefetch" href="/learn-book/assets/js/215.8f7b103b.js"><link rel="prefetch" href="/learn-book/assets/js/216.5a4cb55c.js"><link rel="prefetch" href="/learn-book/assets/js/217.850e8745.js"><link rel="prefetch" href="/learn-book/assets/js/218.b8913e63.js"><link rel="prefetch" href="/learn-book/assets/js/219.3260d54b.js"><link rel="prefetch" href="/learn-book/assets/js/22.2a565240.js"><link rel="prefetch" href="/learn-book/assets/js/220.6e440719.js"><link rel="prefetch" href="/learn-book/assets/js/221.ed0a4a3e.js"><link rel="prefetch" href="/learn-book/assets/js/222.ab1bbc7e.js"><link rel="prefetch" href="/learn-book/assets/js/223.b8d3fbb0.js"><link rel="prefetch" href="/learn-book/assets/js/224.eba39f96.js"><link rel="prefetch" href="/learn-book/assets/js/225.ba57ac7b.js"><link rel="prefetch" href="/learn-book/assets/js/226.760b4caf.js"><link rel="prefetch" href="/learn-book/assets/js/227.ff81b1ba.js"><link rel="prefetch" href="/learn-book/assets/js/228.15305fd8.js"><link rel="prefetch" href="/learn-book/assets/js/229.b1f93d41.js"><link rel="prefetch" href="/learn-book/assets/js/23.e4419686.js"><link rel="prefetch" href="/learn-book/assets/js/230.982e5c6c.js"><link rel="prefetch" href="/learn-book/assets/js/231.8ac0560e.js"><link rel="prefetch" href="/learn-book/assets/js/232.32eb3205.js"><link rel="prefetch" href="/learn-book/assets/js/233.cb14ad35.js"><link rel="prefetch" href="/learn-book/assets/js/234.0e3fb631.js"><link rel="prefetch" href="/learn-book/assets/js/235.1d7db823.js"><link rel="prefetch" href="/learn-book/assets/js/236.56df2b30.js"><link rel="prefetch" href="/learn-book/assets/js/237.56902777.js"><link rel="prefetch" href="/learn-book/assets/js/238.077f8961.js"><link rel="prefetch" href="/learn-book/assets/js/239.836f2633.js"><link rel="prefetch" href="/learn-book/assets/js/24.4ef60a35.js"><link rel="prefetch" href="/learn-book/assets/js/240.1958dc97.js"><link rel="prefetch" href="/learn-book/assets/js/241.628723f2.js"><link rel="prefetch" href="/learn-book/assets/js/242.80a9054d.js"><link rel="prefetch" href="/learn-book/assets/js/243.59d79e44.js"><link rel="prefetch" href="/learn-book/assets/js/244.d3442a00.js"><link rel="prefetch" href="/learn-book/assets/js/245.df290ae1.js"><link rel="prefetch" href="/learn-book/assets/js/246.bb4eb062.js"><link rel="prefetch" href="/learn-book/assets/js/247.c1cbe04d.js"><link rel="prefetch" href="/learn-book/assets/js/248.920787b0.js"><link rel="prefetch" href="/learn-book/assets/js/249.7ab19c67.js"><link rel="prefetch" href="/learn-book/assets/js/25.2b3311b7.js"><link rel="prefetch" href="/learn-book/assets/js/250.eacfb6a8.js"><link rel="prefetch" href="/learn-book/assets/js/251.44eb2a6b.js"><link rel="prefetch" href="/learn-book/assets/js/252.5af941db.js"><link rel="prefetch" href="/learn-book/assets/js/253.1d016c96.js"><link rel="prefetch" href="/learn-book/assets/js/254.3a6ec810.js"><link rel="prefetch" href="/learn-book/assets/js/255.77db8369.js"><link rel="prefetch" href="/learn-book/assets/js/256.a7b36739.js"><link rel="prefetch" href="/learn-book/assets/js/257.cffe71a4.js"><link rel="prefetch" href="/learn-book/assets/js/258.fdb4c219.js"><link rel="prefetch" href="/learn-book/assets/js/259.455a0c8b.js"><link rel="prefetch" href="/learn-book/assets/js/26.70973cf8.js"><link rel="prefetch" href="/learn-book/assets/js/260.f7d47a3e.js"><link rel="prefetch" href="/learn-book/assets/js/261.b1e2a5bf.js"><link rel="prefetch" href="/learn-book/assets/js/262.aaa755c2.js"><link rel="prefetch" href="/learn-book/assets/js/263.e838a513.js"><link rel="prefetch" href="/learn-book/assets/js/264.b8733c83.js"><link rel="prefetch" href="/learn-book/assets/js/265.c5fdd3c5.js"><link rel="prefetch" href="/learn-book/assets/js/266.e8d01769.js"><link rel="prefetch" href="/learn-book/assets/js/267.c9742e28.js"><link rel="prefetch" href="/learn-book/assets/js/268.2b148bef.js"><link rel="prefetch" href="/learn-book/assets/js/269.e03565b0.js"><link rel="prefetch" href="/learn-book/assets/js/27.8106f1e9.js"><link rel="prefetch" href="/learn-book/assets/js/270.65b5d908.js"><link rel="prefetch" href="/learn-book/assets/js/271.fbde0cac.js"><link rel="prefetch" href="/learn-book/assets/js/272.03745530.js"><link rel="prefetch" href="/learn-book/assets/js/273.8785fc29.js"><link rel="prefetch" href="/learn-book/assets/js/274.0ff015ae.js"><link rel="prefetch" href="/learn-book/assets/js/275.4fe4ba23.js"><link rel="prefetch" href="/learn-book/assets/js/276.26d537d4.js"><link rel="prefetch" href="/learn-book/assets/js/277.d95836c7.js"><link rel="prefetch" href="/learn-book/assets/js/278.eb312d49.js"><link rel="prefetch" href="/learn-book/assets/js/279.d0ce3bfd.js"><link rel="prefetch" href="/learn-book/assets/js/28.b3ebf8e6.js"><link rel="prefetch" href="/learn-book/assets/js/280.0c7ddd76.js"><link rel="prefetch" href="/learn-book/assets/js/281.94b40ca5.js"><link rel="prefetch" href="/learn-book/assets/js/282.4f902cb2.js"><link rel="prefetch" href="/learn-book/assets/js/283.834f65b2.js"><link rel="prefetch" href="/learn-book/assets/js/284.283c48cf.js"><link rel="prefetch" href="/learn-book/assets/js/285.4c68b9f5.js"><link rel="prefetch" href="/learn-book/assets/js/286.c34e142a.js"><link rel="prefetch" href="/learn-book/assets/js/287.b6713fe5.js"><link rel="prefetch" href="/learn-book/assets/js/288.cac84ba9.js"><link rel="prefetch" href="/learn-book/assets/js/289.9a6f3ebc.js"><link rel="prefetch" href="/learn-book/assets/js/29.e196143d.js"><link rel="prefetch" href="/learn-book/assets/js/290.fe2f74e5.js"><link rel="prefetch" href="/learn-book/assets/js/291.23dc1b91.js"><link rel="prefetch" href="/learn-book/assets/js/292.80606528.js"><link rel="prefetch" href="/learn-book/assets/js/293.aa013666.js"><link rel="prefetch" href="/learn-book/assets/js/294.0dee2576.js"><link rel="prefetch" href="/learn-book/assets/js/295.c731059a.js"><link rel="prefetch" href="/learn-book/assets/js/296.b226f176.js"><link rel="prefetch" href="/learn-book/assets/js/297.69f8e024.js"><link rel="prefetch" href="/learn-book/assets/js/298.8d2da06c.js"><link rel="prefetch" href="/learn-book/assets/js/299.e168b956.js"><link rel="prefetch" href="/learn-book/assets/js/3.e9334214.js"><link rel="prefetch" href="/learn-book/assets/js/30.0f44a043.js"><link rel="prefetch" href="/learn-book/assets/js/300.335941ee.js"><link rel="prefetch" href="/learn-book/assets/js/301.4bab8322.js"><link rel="prefetch" href="/learn-book/assets/js/302.2f5148b0.js"><link rel="prefetch" href="/learn-book/assets/js/303.2e8d30f0.js"><link rel="prefetch" href="/learn-book/assets/js/304.f0e9bbb8.js"><link rel="prefetch" href="/learn-book/assets/js/305.80fc4688.js"><link rel="prefetch" href="/learn-book/assets/js/306.f554b95c.js"><link rel="prefetch" href="/learn-book/assets/js/307.03aa7e5b.js"><link rel="prefetch" href="/learn-book/assets/js/309.af606132.js"><link rel="prefetch" href="/learn-book/assets/js/31.00dd7380.js"><link rel="prefetch" href="/learn-book/assets/js/310.47599795.js"><link rel="prefetch" href="/learn-book/assets/js/311.00539011.js"><link rel="prefetch" href="/learn-book/assets/js/312.fbc57673.js"><link rel="prefetch" href="/learn-book/assets/js/313.8e8daad4.js"><link rel="prefetch" href="/learn-book/assets/js/314.268dcf0e.js"><link rel="prefetch" href="/learn-book/assets/js/315.aabe7e52.js"><link rel="prefetch" href="/learn-book/assets/js/316.faa4e876.js"><link rel="prefetch" href="/learn-book/assets/js/317.d802eb3f.js"><link rel="prefetch" href="/learn-book/assets/js/318.c262b463.js"><link rel="prefetch" href="/learn-book/assets/js/319.24a8ff4d.js"><link rel="prefetch" href="/learn-book/assets/js/32.7c34bc5e.js"><link rel="prefetch" href="/learn-book/assets/js/320.9c7cda5a.js"><link rel="prefetch" href="/learn-book/assets/js/321.23b9a0be.js"><link rel="prefetch" href="/learn-book/assets/js/322.ad972338.js"><link rel="prefetch" href="/learn-book/assets/js/323.07f13ace.js"><link rel="prefetch" href="/learn-book/assets/js/324.18b8d5ae.js"><link rel="prefetch" href="/learn-book/assets/js/325.f01bde16.js"><link rel="prefetch" href="/learn-book/assets/js/326.629c1072.js"><link rel="prefetch" href="/learn-book/assets/js/327.39e6c9e2.js"><link rel="prefetch" href="/learn-book/assets/js/328.c699721e.js"><link rel="prefetch" href="/learn-book/assets/js/329.b54ab0db.js"><link rel="prefetch" href="/learn-book/assets/js/33.2386fa0f.js"><link rel="prefetch" href="/learn-book/assets/js/330.79e7cbcf.js"><link rel="prefetch" href="/learn-book/assets/js/331.377fadf6.js"><link rel="prefetch" href="/learn-book/assets/js/332.63cd94c2.js"><link rel="prefetch" href="/learn-book/assets/js/333.da52ece6.js"><link rel="prefetch" href="/learn-book/assets/js/334.5f196b50.js"><link rel="prefetch" href="/learn-book/assets/js/335.97b4ef4c.js"><link rel="prefetch" href="/learn-book/assets/js/336.e57f018e.js"><link rel="prefetch" href="/learn-book/assets/js/337.0a5a0859.js"><link rel="prefetch" href="/learn-book/assets/js/338.7a7f0b61.js"><link rel="prefetch" href="/learn-book/assets/js/339.7cd408bd.js"><link rel="prefetch" href="/learn-book/assets/js/34.0d02a15e.js"><link rel="prefetch" href="/learn-book/assets/js/340.04cb06e8.js"><link rel="prefetch" href="/learn-book/assets/js/341.537861d1.js"><link rel="prefetch" href="/learn-book/assets/js/342.da14f695.js"><link rel="prefetch" href="/learn-book/assets/js/343.74707d52.js"><link rel="prefetch" href="/learn-book/assets/js/344.b350096e.js"><link rel="prefetch" href="/learn-book/assets/js/345.dbf62aca.js"><link rel="prefetch" href="/learn-book/assets/js/346.3f255f50.js"><link rel="prefetch" href="/learn-book/assets/js/347.f4668b0d.js"><link rel="prefetch" href="/learn-book/assets/js/348.542573cc.js"><link rel="prefetch" href="/learn-book/assets/js/349.6888cb35.js"><link rel="prefetch" href="/learn-book/assets/js/35.74523ded.js"><link rel="prefetch" href="/learn-book/assets/js/350.cd705439.js"><link rel="prefetch" href="/learn-book/assets/js/351.093058d4.js"><link rel="prefetch" href="/learn-book/assets/js/352.77230cba.js"><link rel="prefetch" href="/learn-book/assets/js/353.8f883fac.js"><link rel="prefetch" href="/learn-book/assets/js/354.d52aee3e.js"><link rel="prefetch" href="/learn-book/assets/js/355.77a0126a.js"><link rel="prefetch" href="/learn-book/assets/js/356.dbf927e4.js"><link rel="prefetch" href="/learn-book/assets/js/357.0973baa0.js"><link rel="prefetch" href="/learn-book/assets/js/358.cac7fab3.js"><link rel="prefetch" href="/learn-book/assets/js/359.e8330d89.js"><link rel="prefetch" href="/learn-book/assets/js/36.0da2006f.js"><link rel="prefetch" href="/learn-book/assets/js/360.afef7c08.js"><link rel="prefetch" href="/learn-book/assets/js/361.6237f112.js"><link rel="prefetch" href="/learn-book/assets/js/362.34d1483e.js"><link rel="prefetch" href="/learn-book/assets/js/363.b7b45618.js"><link rel="prefetch" href="/learn-book/assets/js/364.e6d9ce62.js"><link rel="prefetch" href="/learn-book/assets/js/37.2fc83856.js"><link rel="prefetch" href="/learn-book/assets/js/38.79be50ee.js"><link rel="prefetch" href="/learn-book/assets/js/39.88a682f8.js"><link rel="prefetch" href="/learn-book/assets/js/4.0c4a4c2a.js"><link rel="prefetch" href="/learn-book/assets/js/40.e29bfa4b.js"><link rel="prefetch" href="/learn-book/assets/js/41.d4016d53.js"><link rel="prefetch" href="/learn-book/assets/js/42.c548ba43.js"><link rel="prefetch" href="/learn-book/assets/js/43.472c0c7f.js"><link rel="prefetch" href="/learn-book/assets/js/44.e0613af7.js"><link rel="prefetch" href="/learn-book/assets/js/45.e0c5b514.js"><link rel="prefetch" href="/learn-book/assets/js/46.0d833848.js"><link rel="prefetch" href="/learn-book/assets/js/47.167e51ca.js"><link rel="prefetch" href="/learn-book/assets/js/48.c55f2d7a.js"><link rel="prefetch" href="/learn-book/assets/js/49.600b0356.js"><link rel="prefetch" href="/learn-book/assets/js/5.c26035a1.js"><link rel="prefetch" href="/learn-book/assets/js/50.70947932.js"><link rel="prefetch" href="/learn-book/assets/js/51.924af1dd.js"><link rel="prefetch" href="/learn-book/assets/js/52.447da1c4.js"><link rel="prefetch" href="/learn-book/assets/js/53.b7e4c782.js"><link rel="prefetch" href="/learn-book/assets/js/54.4d31d080.js"><link rel="prefetch" href="/learn-book/assets/js/55.91a4b03c.js"><link rel="prefetch" href="/learn-book/assets/js/56.1cb7915e.js"><link rel="prefetch" href="/learn-book/assets/js/57.2affe6fc.js"><link rel="prefetch" href="/learn-book/assets/js/58.27d5c7cd.js"><link rel="prefetch" href="/learn-book/assets/js/59.2bd7f911.js"><link rel="prefetch" href="/learn-book/assets/js/6.41833f8f.js"><link rel="prefetch" href="/learn-book/assets/js/60.626def20.js"><link rel="prefetch" href="/learn-book/assets/js/61.45f51e6d.js"><link rel="prefetch" href="/learn-book/assets/js/62.4bdda78c.js"><link rel="prefetch" href="/learn-book/assets/js/63.557bc394.js"><link rel="prefetch" href="/learn-book/assets/js/64.aff699bf.js"><link rel="prefetch" href="/learn-book/assets/js/65.692f7816.js"><link rel="prefetch" href="/learn-book/assets/js/66.25ecbcaa.js"><link rel="prefetch" href="/learn-book/assets/js/67.8fa8a16e.js"><link rel="prefetch" href="/learn-book/assets/js/68.92b6a3f8.js"><link rel="prefetch" href="/learn-book/assets/js/69.efff96d2.js"><link rel="prefetch" href="/learn-book/assets/js/7.8100f2ed.js"><link rel="prefetch" href="/learn-book/assets/js/70.aacd8d45.js"><link rel="prefetch" href="/learn-book/assets/js/71.97a38b91.js"><link rel="prefetch" href="/learn-book/assets/js/72.fa0bbfba.js"><link rel="prefetch" href="/learn-book/assets/js/73.7065bf44.js"><link rel="prefetch" href="/learn-book/assets/js/74.cc9e8786.js"><link rel="prefetch" href="/learn-book/assets/js/75.9853915c.js"><link rel="prefetch" href="/learn-book/assets/js/76.3bb84aff.js"><link rel="prefetch" href="/learn-book/assets/js/77.1d7faa0b.js"><link rel="prefetch" href="/learn-book/assets/js/78.82ccf15d.js"><link rel="prefetch" href="/learn-book/assets/js/79.1ca14563.js"><link rel="prefetch" href="/learn-book/assets/js/8.a6e82c65.js"><link rel="prefetch" href="/learn-book/assets/js/80.009c8d78.js"><link rel="prefetch" href="/learn-book/assets/js/81.7c70581a.js"><link rel="prefetch" href="/learn-book/assets/js/82.25fa4637.js"><link rel="prefetch" href="/learn-book/assets/js/84.9e77b512.js"><link rel="prefetch" href="/learn-book/assets/js/85.bebb4293.js"><link rel="prefetch" href="/learn-book/assets/js/86.5a6fb0e3.js"><link rel="prefetch" href="/learn-book/assets/js/87.5a748d18.js"><link rel="prefetch" href="/learn-book/assets/js/88.17a0f517.js"><link rel="prefetch" href="/learn-book/assets/js/89.22035541.js"><link rel="prefetch" href="/learn-book/assets/js/9.5a3b25cd.js"><link rel="prefetch" href="/learn-book/assets/js/90.3222c7da.js"><link rel="prefetch" href="/learn-book/assets/js/91.4b34da5a.js"><link rel="prefetch" href="/learn-book/assets/js/92.9739a603.js"><link rel="prefetch" href="/learn-book/assets/js/93.38329abe.js"><link rel="prefetch" href="/learn-book/assets/js/94.52432e65.js"><link rel="prefetch" href="/learn-book/assets/js/95.363db7ac.js"><link rel="prefetch" href="/learn-book/assets/js/96.f5e07454.js"><link rel="prefetch" href="/learn-book/assets/js/97.76268626.js"><link rel="prefetch" href="/learn-book/assets/js/98.34e210bb.js"><link rel="prefetch" href="/learn-book/assets/js/99.d3018ce2.js">
    <link rel="stylesheet" href="/learn-book/assets/css/0.styles.d1598957.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-book/" class="home-link router-link-active"><img src="/learn-book/mlogo.svg" alt="LEARN-BOOK" class="logo"> <span class="site-name can-hide">LEARN-BOOK</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow down"></span></button> <button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="mobile-dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          综合性导航
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/" class="nav-link router-link-active">
  全目录导航
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/001-introduce.html" class="nav-link">
  第一版（001 ~ 123 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/124.html" class="nav-link">
  第二版（124 ~ 195 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/121.html" class="nav-link">
  课程总结（难题与解决方案）
</a></li></ul></li><li class="dropdown-item"><h4>
          精彩知识精选
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/redis/007.html" class="nav-link">
  Redis 篇（redis 企业级集群架构）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/035.html" class="nav-link">
  多级缓存架构设计
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/040.html" class="nav-link">
  数据库 + 缓存双写一致性解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/045.html" class="nav-link">
  缓存维度化拆分解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/051.html" class="nav-link">
  缓存命中率提升解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/057.html" class="nav-link">
  缓存并发重建冲突解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/069.html" class="nav-link">
  缓存预热解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/077.html" class="nav-link">
  热点缓存自动降级方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/110.html" class="nav-link">
  缓存雪崩解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/117.html" class="nav-link">
  缓存穿透解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/119.html" class="nav-link">
  缓存失效解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/hystrix/084.html" class="nav-link">
  高可用分布式系统架构设计（hystrix 篇）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/047.html" class="nav-link">
  spring boot 整合 ehcache
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/storm/062.html" class="nav-link">
  史上最通俗易懂 Storm 教程
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程目录" class="dropdown-title"><span class="title">课程目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程目录" class="mobile-dropdown-title"><span class="title">课程目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn-book/monitor-tuning/" class="nav-link">
  JAVA 生产环境下性能监控与调优详解
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/http-protocol/" class="nav-link">
  透视 HTTP 协议
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/ddd/" class="nav-link">
  DDD 实战课
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/middle-office/" class="nav-link">
  说透中台
</a></li><li class="dropdown-item"><h4>
          设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/imocc/design_pattern/" class="nav-link">
  设计模式（慕课）
</a></li><li class="dropdown-subitem"><a href="/learn-book/design_pattern/" class="nav-link">
  研磨设计模式（李兴华）
</a></li></ul></li></ul></div></div> <a href="https://github.com/abc0721/learn-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow down"></span></button> <button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="mobile-dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          综合性导航
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/" class="nav-link router-link-active">
  全目录导航
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/001-introduce.html" class="nav-link">
  第一版（001 ~ 123 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/124.html" class="nav-link">
  第二版（124 ~ 195 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/121.html" class="nav-link">
  课程总结（难题与解决方案）
</a></li></ul></li><li class="dropdown-item"><h4>
          精彩知识精选
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/redis/007.html" class="nav-link">
  Redis 篇（redis 企业级集群架构）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/035.html" class="nav-link">
  多级缓存架构设计
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/040.html" class="nav-link">
  数据库 + 缓存双写一致性解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/045.html" class="nav-link">
  缓存维度化拆分解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/051.html" class="nav-link">
  缓存命中率提升解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/057.html" class="nav-link">
  缓存并发重建冲突解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/069.html" class="nav-link">
  缓存预热解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/077.html" class="nav-link">
  热点缓存自动降级方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/110.html" class="nav-link">
  缓存雪崩解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/117.html" class="nav-link">
  缓存穿透解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/119.html" class="nav-link">
  缓存失效解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/hystrix/084.html" class="nav-link">
  高可用分布式系统架构设计（hystrix 篇）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/047.html" class="nav-link">
  spring boot 整合 ehcache
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/storm/062.html" class="nav-link">
  史上最通俗易懂 Storm 教程
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程目录" class="dropdown-title"><span class="title">课程目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程目录" class="mobile-dropdown-title"><span class="title">课程目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn-book/monitor-tuning/" class="nav-link">
  JAVA 生产环境下性能监控与调优详解
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/http-protocol/" class="nav-link">
  透视 HTTP 协议
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/ddd/" class="nav-link">
  DDD 实战课
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/middle-office/" class="nav-link">
  说透中台
</a></li><li class="dropdown-item"><h4>
          设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/imocc/design_pattern/" class="nav-link">
  设计模式（慕课）
</a></li><li class="dropdown-subitem"><a href="/learn-book/design_pattern/" class="nav-link">
  研磨设计模式（李兴华）
</a></li></ul></li></ul></div></div> <a href="https://github.com/abc0721/learn-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/learn-book/cache-pdp/" aria-current="page" class="sidebar-link">亿级流量电商详情页系统实战（第二版）：缓存架构+高可用服务架构+微服务架构</a></li><li><a href="/learn-book/cache-pdp/001-introduce.html" class="sidebar-link">001. 课程介绍以及高并发高可用复杂系统中的缓存架构有哪些东西</a></li><li><a href="/learn-book/cache-pdp/002.html" class="sidebar-link">002. 基于大型电商网站中的商品详情页系统贯穿的授课思路介绍</a></li><li><a href="/learn-book/cache-pdp/003.html" class="sidebar-link">003. 小型电商网站的商品详情页的页面静态化架构以及其缺陷</a></li><li><a href="/learn-book/cache-pdp/004.html" class="sidebar-link">004. 大型电商网站的异步多级缓存构建 + nginx 数据本地化动态渲染的架构</a></li><li><a href="/learn-book/cache-pdp/005.html" class="sidebar-link">005. 能够支撑高并发 + 高可用 + 海量数据 + 备份恢复的 redis 的重要性</a></li><li><a href="/learn-book/cache-pdp/006.html" class="sidebar-link">006. 从零开始在虚拟机中一步一步搭建一个 4 个节点的 CentOS 集群</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>redis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-book/cache-pdp/redis/007.html" class="sidebar-link">007. 单机版 redis 的安装以及 redis 生产环境启动方案</a></li><li><a href="/learn-book/cache-pdp/redis/008.html" class="sidebar-link">008. redis 持久化机对于生产环境中的灾难恢复的意义</a></li><li><a href="/learn-book/cache-pdp/redis/009.html" class="sidebar-link">009. 图解分析 redis 的 RDB 和 AOF 两种持久化机制的工作原理</a></li><li><a href="/learn-book/cache-pdp/redis/010.html" class="sidebar-link">010. redis 的 RDB 和 AOF 两种持久化机制的优劣势对比</a></li><li><a href="/learn-book/cache-pdp/redis/011.html" class="sidebar-link">011. redis 的 RDB 持久化配置以及数据恢复实验</a></li><li><a href="/learn-book/cache-pdp/redis/012.html" class="sidebar-link">012. redis 的 AOF 持久化深入讲解各种操作和相关实验</a></li><li><a href="/learn-book/cache-pdp/redis/013.html" class="sidebar-link">013. 在项目中部署 redis 企业级数据备份方案以及各种踩坑的数据恢复容灾演练</a></li><li><a href="/learn-book/cache-pdp/redis/014.html" class="sidebar-link">014. redis 如何通过读写分离来承载读请求 QPS 超过 10 万 +？</a></li><li><a href="/learn-book/cache-pdp/redis/015.html" class="sidebar-link">015. redis replication 以及 master 持久化对主从架构的安全意义</a></li><li><a href="/learn-book/cache-pdp/redis/016.html" class="sidebar-link">016. redis 主从复制原理、断点续传、无磁盘化复制、过期 key 处理</a></li><li><a href="/learn-book/cache-pdp/redis/017.html" class="sidebar-link">017. redis replication 的完整流运行程和原理的再次深入剖析</a></li><li><a href="/learn-book/cache-pdp/redis/018.html" class="sidebar-link">018. 在项目中部署 redis 的读写分离架构（包含节点间认证口令）</a></li><li><a href="/learn-book/cache-pdp/redis/019.html" class="sidebar-link">019. 对项目的主从 redis 架构进行 QPS 压测以及水平扩容支撑更高 QPS</a></li><li><a href="/learn-book/cache-pdp/redis/020.html" class="sidebar-link">020. redis 主从架构下如何才能做到 99.99% 的高可用性？</a></li><li><a href="/learn-book/cache-pdp/redis/021.html" class="sidebar-link">021. redis 哨兵架构的相关基础知识的讲解</a></li><li><a href="/learn-book/cache-pdp/redis/022.html" class="sidebar-link">022. redis 哨兵主备切换的数据丢失问题：异步复制、集群脑裂</a></li><li><a href="/learn-book/cache-pdp/redis/023.html" class="sidebar-link">023. redis 哨兵的多个核心底层原理的深入解析（包含 slave 选举算法）</a></li><li><a href="/learn-book/cache-pdp/redis/024.html" class="sidebar-link">024. 在项目中以经典的 3 节点方式部署哨兵集群</a></li><li><a href="/learn-book/cache-pdp/redis/025.html" class="sidebar-link">025. 对项目中的哨兵节点进行管理以及高可用 redis 集群的容灾演练</a></li><li><a href="/learn-book/cache-pdp/redis/026.html" class="sidebar-link">026. redis 如何在保持读写分离+高可用的架构下，还能横向扩容支撑 1T + 海量数据</a></li><li><a href="/learn-book/cache-pdp/redis/027.html" class="sidebar-link">027. 数据分布算法：hash+ 一致性 hash + redis cluster 的 hash slot</a></li><li><a href="/learn-book/cache-pdp/redis/028.html" class="sidebar-link">028. 在项目中重新搭建一套读写分离+高可用+多 master 的 redis cluster 集群</a></li><li><a href="/learn-book/cache-pdp/redis/029.html" class="sidebar-link">029. 对项目的 redis cluster 实验多 master 写入、读写分离、高可用性</a></li><li><a href="/learn-book/cache-pdp/redis/030.html" aria-current="page" class="active sidebar-link">030. redis cluster 通过 master 水平扩容来支撑更高的读写吞吐 + 海量数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-book/cache-pdp/redis/030.html#加入新的-master" class="sidebar-link">加入新的 master</a></li><li class="sidebar-sub-header"><a href="/learn-book/cache-pdp/redis/030.html#reshard-一些数据到新添加的-master-上" class="sidebar-link">reshard 一些数据到新添加的 master 上</a></li><li class="sidebar-sub-header"><a href="/learn-book/cache-pdp/redis/030.html#添加-node-作为-slave" class="sidebar-link">添加 node 作为 slave</a></li><li class="sidebar-sub-header"><a href="/learn-book/cache-pdp/redis/030.html#删除-node" class="sidebar-link">删除 node</a></li></ul></li><li><a href="/learn-book/cache-pdp/redis/031.html" class="sidebar-link">031. redis cluster 的自动化 slave 迁移实现更强的高可用架构的部署方案</a></li><li><a href="/learn-book/cache-pdp/redis/032.html" class="sidebar-link">032. redis cluster 的核心原理分析：gossip 通信、jedis smart 定位、主备切换</a></li><li><a href="/learn-book/cache-pdp/redis/033.html" class="sidebar-link">033. redis 在实践中的一些常见问题以及优化思路（包含 linux 内核参数优化）</a></li><li><a href="/learn-book/cache-pdp/redis/034.html" class="sidebar-link">034. redis 阶段性总结：1T 以上海量数据+10 万以上 QPS 高并发+ 99.99% 高可用</a></li></ul></section></li><li><a href="/learn-book/cache-pdp/035.html" class="sidebar-link">035. 亿级流量商品详情页的多级缓存架构以及架构中每一层的意义</a></li><li><a href="/learn-book/cache-pdp/036.html" class="sidebar-link">036. Cache Aside Pattern 缓存+数据库读写模式的分析</a></li><li><a href="/learn-book/cache-pdp/037.html" class="sidebar-link">037. 高并发场景下的缓存 + 数据库双写不一致问题分析与解决方案设计</a></li><li><a href="/learn-book/cache-pdp/038.html" class="sidebar-link">038. 在 linux 虚拟机中安装部署 MySQL 数据库</a></li><li><a href="/learn-book/cache-pdp/039.html" class="sidebar-link">039. 库存服务的开发框架整合与搭建：spring boot + mybatis + jedis</a></li><li><a href="/learn-book/cache-pdp/040.html" class="sidebar-link">040. 在库存服务中实现缓存与数据库双写一致性保障方案</a></li><li><a href="/learn-book/cache-pdp/044.html" class="sidebar-link">044. 库存服务代码调试以及打印日志观察服务的运行流程是否正确</a></li><li><a href="/learn-book/cache-pdp/045.html" class="sidebar-link">045. 商品详情页结构分析、缓存全量更新问题以及缓存维度化解决方案</a></li><li><a href="/learn-book/cache-pdp/046.html" class="sidebar-link">046. 缓存数据生产服务的工作流程分析以及工程环境搭建</a></li><li><a href="/learn-book/cache-pdp/047.html" class="sidebar-link">047. 完成 spring boot 整合 ehcache 的搭建以支持服务本地堆缓存</a></li><li><a href="/learn-book/cache-pdp/048.html" class="sidebar-link">048. redis 的 LRU 缓存清除算法讲解以及相关配置使用</a></li><li><a href="/learn-book/cache-pdp/049.html" class="sidebar-link">049. zookeeper + kafka 集群的安装部署以及如何简单使用的介绍</a></li><li><a href="/learn-book/cache-pdp/050.html" class="sidebar-link">050. 基于 kafka + ehcache + redis 完成缓存数据生产服务的开发与测试</a></li><li><a href="/learn-book/cache-pdp/051.html" class="sidebar-link">051. 基于“分发层 + 应用层”双层 nginx 架构提升缓存命中率方案分析</a></li><li><a href="/learn-book/cache-pdp/052.html" class="sidebar-link">052. 基于 OpenResty 部署应用层 nginx 以及 nginx + lua 开发 hello world</a></li><li><a href="/learn-book/cache-pdp/053.html" class="sidebar-link">053. 部署分发层 nginx 以及基于 lua 完成基于商品 id 的定向流量分发策略</a></li><li><a href="/learn-book/cache-pdp/054.html" class="sidebar-link">054. 基于 nginx + lua + java 完成多级缓存架构的核心业务逻辑（一）</a></li><li><a href="/learn-book/cache-pdp/055.html" class="sidebar-link">055. 基于 nginx + lua + java 完成多级缓存架构的核心业务逻辑（二）</a></li><li><a href="/learn-book/cache-pdp/056.html" class="sidebar-link">056. 基于 nginx + lua + java 完成多级缓存架构的核心业务逻辑（三）</a></li><li><a href="/learn-book/cache-pdp/057.html" class="sidebar-link">057. 分布式缓存重建并发冲突问题以及 zookeeper 分布式锁解决方案</a></li><li><a href="/learn-book/cache-pdp/058.html" class="sidebar-link">058. 缓存数据生产服务中的 zk 分布式锁解决方案的代码实现（一）</a></li><li><a href="/learn-book/cache-pdp/059.html" class="sidebar-link">059. 缓存数据生产服务中的 zk 分布式锁解决方案的代码实现（二）</a></li><li><a href="/learn-book/cache-pdp/060.html" class="sidebar-link">060. 缓存数据生产服务中的 zk 分布式锁解决方案的代码实现（三）</a></li><li><a href="/learn-book/cache-pdp/061.html" class="sidebar-link">061. Java 程序员、缓存架构以及 Storm 大数据实时计算之间的关系</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>讲给 Java 工程师的史上最通俗易懂 Storm 教程</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/learn-book/cache-pdp/068.html" class="sidebar-link">068. 缓存冷启动问题：新系统上线 redis 彻底崩溃导致数据无法恢复</a></li><li><a href="/learn-book/cache-pdp/069.html" class="sidebar-link">069. 缓存预热解决方案：基于 storm 实时热点统计的分布式并行缓存预热</a></li><li><a href="/learn-book/cache-pdp/070.html" class="sidebar-link">070. 基于 nginx+lua 完成商品详情页访问流量实时上报 kafka 的开发</a></li><li><a href="/learn-book/cache-pdp/071.html" class="sidebar-link">071. 基于 storm+kafka 完成商品访问次数实时统计拓扑的开发</a></li><li><a href="/learn-book/cache-pdp/072.html" class="sidebar-link">072. 基于 storm 完成 LRUMap 中 topn 热门商品列表的算法讲解与编写</a></li><li><a href="/learn-book/cache-pdp/073.html" class="sidebar-link">073. 基于 storm+zookeeper 完成热门商品列表的分段存储</a></li><li><a href="/learn-book/cache-pdp/074.html" class="sidebar-link">074. 基于双重 zookeeper 分布式锁完成分布式并行缓存预热的代码开发</a></li><li><a href="/learn-book/cache-pdp/075.html" class="sidebar-link">075. 将缓存预热解决方案的代码运行后观察效果以及调试和修复所有的 bug</a></li><li><a href="/learn-book/cache-pdp/076.html" class="sidebar-link">076. 热点缓存问题：促销抢购时的超级热门商品可能导致系统全盘崩溃的场景</a></li><li><a href="/learn-book/cache-pdp/077.html" class="sidebar-link">077. 基于 nginx+lua+storm 的热点缓存的流量分发策略自动降级解决方案</a></li><li><a href="/learn-book/cache-pdp/078.html" class="sidebar-link">078. 在 storm 拓扑中加入热点缓存实时自动识别和感知的代码逻辑</a></li><li><a href="/learn-book/cache-pdp/079.html" class="sidebar-link">079. 在 storm 拓扑中加入 nginx 反向推送缓存热点与缓存数据的代码逻辑</a></li><li><a href="/learn-book/cache-pdp/080.html" class="sidebar-link">080. 在流量分发+后端应用双层 nginx 中加入接收热点缓存数据的接口</a></li><li><a href="/learn-book/cache-pdp/081.html" class="sidebar-link">081. 在 nginx+lua 中实现热点缓存自动降级为负载均衡流量分发策略的逻辑</a></li><li><a href="/learn-book/cache-pdp/082.html" class="sidebar-link">082. 在 storm 拓扑中加入热点缓存消失的实时自动识别和感知的代码逻辑</a></li><li><a href="/learn-book/cache-pdp/083.html" class="sidebar-link">083. 将热点缓存自动降级解决方案的代码运行后观察效果以及调试和修复 bug</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>hystrix</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>缓存雪崩</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>缓存穿透</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/learn-book/cache-pdp/121.html" class="sidebar-link">121. 支撑高并发与高可用的大型电商详情页系统的缓存架构课程总结</a></li><li><a href="/learn-book/cache-pdp/122.html" class="sidebar-link">122. 如何将课程中的东西学以致用在自己目前的项目中去应用？</a></li><li><a href="/learn-book/cache-pdp/123.html" class="sidebar-link">123. 如何带着课程中讲解的东西化为自己的技术并找一份更好的工作？</a></li><li><a href="/learn-book/cache-pdp/124.html" class="sidebar-link">124. 大型电商网站的商品详情页的深入分析（第二版开始）</a></li><li><a href="/learn-book/cache-pdp/125.html" class="sidebar-link">125. 大型电商网站的商品详情页系统架构是如何一步一步演进的</a></li><li><a href="/learn-book/cache-pdp/126.html" class="sidebar-link">126. 亿级流量大型电商网站的商品详情页系统架构的整体设计</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>动态渲染系统</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>OneService 系统</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/learn-book/cache-pdp/195.html" class="sidebar-link">195. 商品详情页前端介绍&amp;课程总结&amp; Java 架构师展望</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_030-redis-cluster-通过-master-水平扩容来支撑更高的读写吞吐-海量数据"><a href="#_030-redis-cluster-通过-master-水平扩容来支撑更高的读写吞吐-海量数据" class="header-anchor">#</a> 030. redis cluster 通过 master 水平扩容来支撑更高的读写吞吐 + 海量数据</h1> <p>redis cluster 模式下，不建议做物理的读写分离了，我们建议通过 master 的水平扩容，来横向扩展读写吞吐量，还有支撑更多的海量数据</p> <p>比如 redis 单机假设读吞吐是 5w/s，写吞吐 2w/s，如果有 5 台 master，读吞吐可以达到总量 25w/s QPS，写可以达到 10w/s QPS</p> <p>redis 单机内存不建议过大（建议值 6G、8G），因为 fork 类操作的时候很耗时，会导致请求延时的问题</p> <p>只要横向扩容更多的 master 就能达到支撑 1TB 数据量。</p> <h2 id="加入新的-master"><a href="#加入新的-master" class="header-anchor">#</a> 加入新的 master</h2> <p>暂时不添加机器了（比较耗时，主要是为了演示这个功能），在 eshop-cache03 上增加一个 7007 的 redis 节点，然后把该节点加入到 redis cluster 中</p> <p>搭建方式和配置文件的修改<a href="/learn-book/cache-pdp/redis/028.html#在三台机器上启动-6-个-redis-实例">参考</a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 添加节点到集群
[root@eshop-cache01 ~]# redis-trib.rb add-node 192.168.99.172:7007 192.168.99.170:7001
&gt;&gt;&gt; Adding node 192.168.99.172:7007 to cluster 192.168.99.170:7001
&gt;&gt;&gt; Performing Cluster Check (using node 192.168.99.170:7001)
S: 3807711e01cd28509d7ba9839e601058bf2a30cf 192.168.99.170:7001
   slots: (0 slots) slave
   replicates a174fe6613862db8985f82caac58bde91dfbd664
M: 9247dfb394441619da9da5b75b62b034c3f420e5 192.168.99.172:7006
   slots:10923-16383 (5461 slots) master
   1 additional replica(s)
M: a174fe6613862db8985f82caac58bde91dfbd664 192.168.99.171:7004
   slots:0-5460 (5461 slots) master
   1 additional replica(s)
S: b0d66be3b15e117696c50a781ff24a842456733d 192.168.99.170:7002
   slots: (0 slots) slave
   replicates 0ff0e8ab05a8b032aeacf24e0c7fea77be3f5c55
S: cb2256b653cf5b7b3f9d1478cfa2953cc334c5bf 192.168.99.172:7005
   slots: (0 slots) slave
   replicates 9247dfb394441619da9da5b75b62b034c3f420e5
M: 0ff0e8ab05a8b032aeacf24e0c7fea77be3f5c55 192.168.99.171:7003
   slots:5461-10922 (5462 slots) master
   1 additional replica(s)
[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
&gt;&gt;&gt; Send CLUSTER MEET to node 192.168.99.172:7007 to make it join the cluster.

# 检查集群信息

[root@eshop-cache01 ~]# redis-trib.rb check 192.168.99.170:7001
&gt;&gt;&gt; Performing Cluster Check (using node 192.168.99.170:7001)
S: 3807711e01cd28509d7ba9839e601058bf2a30cf 192.168.99.170:7001
   slots: (0 slots) slave
   replicates a174fe6613862db8985f82caac58bde91dfbd664
M: 9247dfb394441619da9da5b75b62b034c3f420e5 192.168.99.172:7006
   slots:10923-16383 (5461 slots) master
   1 additional replica(s)
M: a174fe6613862db8985f82caac58bde91dfbd664 192.168.99.171:7004
   slots:0-5460 (5461 slots) master
   1 additional replica(s)
M: 5d236f5ff996f0d378914b01159a8b7c5dee383d 192.168.99.172:7007
   slots: (0 slots) master
   0 additional replica(s)
S: b0d66be3b15e117696c50a781ff24a842456733d 192.168.99.170:7002
   slots: (0 slots) slave
   replicates 0ff0e8ab05a8b032aeacf24e0c7fea77be3f5c55
S: cb2256b653cf5b7b3f9d1478cfa2953cc334c5bf 192.168.99.172:7005
   slots: (0 slots) slave
   replicates 9247dfb394441619da9da5b75b62b034c3f420e5
M: 0ff0e8ab05a8b032aeacf24e0c7fea77be3f5c55 192.168.99.171:7003
   slots:5461-10922 (5462 slots) master
   1 additional replica(s)
[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p>可以看到 7007 变成了一个 master，但是只有 0 个 slots ，表示此事的 7007 还不能对外服务，需要手动把执行迁移命令</p> <h2 id="reshard-一些数据到新添加的-master-上"><a href="#reshard-一些数据到新添加的-master-上" class="header-anchor">#</a> reshard 一些数据到新添加的 master 上</h2> <p>注：由于第一次迁移的时候输入完 done 后，就被刷屏了，记录没有保存下来，我把分配的 4096 个 slots 迁移到了 7006 上，这里再分配一次。记录下命令的反应（集群创建的时候，它会均匀分配 slots 到每个机器上的）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 任意连接一台集群内的集群即可
[root@eshop-cache01 ~]# redis-trib.rb reshard 192.168.99.170:7001
&gt;&gt;&gt; Performing Cluster Check (using node 192.168.99.170:7001)
S: 3807711e01cd28509d7ba9839e601058bf2a30cf 192.168.99.170:7001
   slots: (0 slots) slave
   replicates a174fe6613862db8985f82caac58bde91dfbd664
M: 9247dfb394441619da9da5b75b62b034c3f420e5 192.168.99.172:7006
   slots:0-1364,5461-6826,10923-16383 (8192 slots) master
   1 additional replica(s)
M: a174fe6613862db8985f82caac58bde91dfbd664 192.168.99.171:7004
   slots:1365-5460 (4096 slots) master
   1 additional replica(s)
M: 5d236f5ff996f0d378914b01159a8b7c5dee383d 192.168.99.172:7007
   slots: (0 slots) master
   0 additional replica(s)
S: b0d66be3b15e117696c50a781ff24a842456733d 192.168.99.170:7002
   slots: (0 slots) slave
   replicates 0ff0e8ab05a8b032aeacf24e0c7fea77be3f5c55
S: cb2256b653cf5b7b3f9d1478cfa2953cc334c5bf 192.168.99.172:7005
   slots: (0 slots) slave
   replicates 9247dfb394441619da9da5b75b62b034c3f420e5
M: 0ff0e8ab05a8b032aeacf24e0c7fea77be3f5c55 192.168.99.171:7003
   slots:6827-10922 (4096 slots) master
   1 additional replica(s)
[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
# 询问你要迁移多少个 slots 到目标机器去? 一共是 16384/4 = 4096
How many slots do you want to move (from 1 to 16384)? 4096
# 要迁移到的目标机器 id，这个id就在上面的 M/S 后面这一串
What is the receiving node ID? 5d236f5ff996f0d378914b01159a8b7c5dee383d
Please enter all the source node IDs.
  Type 'all' to use all the nodes as source nodes for the hash slots.
  Type 'done' once you entered all the source nodes IDs.
# 输入被迁移的 id，这里是要把之前的 3 台上的 node 均匀的迁移 4096 到 新机器上
Source node #1:9247dfb394441619da9da5b75b62b034c3f420e5
Source node #2:a174fe6613862db8985f82caac58bde91dfbd664
Source node #3:0ff0e8ab05a8b032aeacf24e0c7fea77be3f5c55
# 需要输入 done 命令完成输入源
Source node #4:done
... 接下来会一大串的日志信息，
Moving slot 7850 from 0ff0e8ab05a8b032aeacf24e0c7fea77be3f5c55
# 是否要继续执行集群计划
Do you want to proceed with the proposed reshard plan (yes/no)? yes
又是一大堆日志刷屏，完成后
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><blockquote><p>报错问题</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>难道他们不是均匀分配的吗？对于下面这种问题，报错后，我没有回复成功，
只能把所有的 /etc/redis/ 和 /etc/redis-cluster/ 下的 conf 文件删除后，
并且重启所有的 redis 后，登录上节点手动执行 flushall 和 cluster reset 后，
才能重新创建集群，重新回复到现在这个章节的过程中来的</p> <p>这里我怀疑只要把所有节点都执行  flushall 和 cluster reset 就可以吧集群打散。再重建</p></div> <p>报错问题：在下面这种 slots 分布下，7006 有 8192 个节点，7007 0 个，
本来以为 redis 会自动迁移到 7007 上面去，指定了 3 个源节点，结果执行过程中报错了</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>S: 3807711e01cd28509d7ba9839e601058bf2a30cf 192.168.99.170:7001
   slots: (0 slots) slave
   replicates a174fe6613862db8985f82caac58bde91dfbd664
M: 9247dfb394441619da9da5b75b62b034c3f420e5 192.168.99.172:7006
   slots:0-1364,5461-6826,10923-16383 (8192 slots) master
   1 additional replica(s)
M: a174fe6613862db8985f82caac58bde91dfbd664 192.168.99.171:7004
   slots:1365-5460 (4096 slots) master
   1 additional replica(s)
M: 5d236f5ff996f0d378914b01159a8b7c5dee383d 192.168.99.172:7007
   slots: (0 slots) master
   0 additional replica(s)
S: b0d66be3b15e117696c50a781ff24a842456733d 192.168.99.170:7002
   slots: (0 slots) slave
   replicates 0ff0e8ab05a8b032aeacf24e0c7fea77be3f5c55
S: cb2256b653cf5b7b3f9d1478cfa2953cc334c5bf 192.168.99.172:7005
   slots: (0 slots) slave
   replicates 9247dfb394441619da9da5b75b62b034c3f420e5
M: 0ff0e8ab05a8b032aeacf24e0c7fea77be3f5c55 192.168.99.171:7003
   slots:6827-10922 (4096 slots) master

[ERR] Calling MIGRATE: ERR Syntax error, try CLIENT (LIST | KILL | GETNAME | SETNAME | PAUSE | REPLY)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>再次尝试迁移，发现还是报错</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[root@eshop-cache01 ~]# redis-trib.rb reshard 192.168.99.170:7001
&gt;&gt;&gt; Performing Cluster Check (using node 192.168.99.170:7001)
S: 3807711e01cd28509d7ba9839e601058bf2a30cf 192.168.99.170:7001
   slots: (0 slots) slave
   replicates a174fe6613862db8985f82caac58bde91dfbd664
M: 9247dfb394441619da9da5b75b62b034c3f420e5 192.168.99.172:7006
   slots:6144-6826,10923-16383 (6144 slots) master
   1 additional replica(s)
M: a174fe6613862db8985f82caac58bde91dfbd664 192.168.99.171:7004
   slots:1860-5460 (3601 slots) master
   1 additional replica(s)
M: 5d236f5ff996f0d378914b01159a8b7c5dee383d 192.168.99.172:7007
   slots:0-1859,5461-6143 (2543 slots) master
   0 additional replica(s)
S: b0d66be3b15e117696c50a781ff24a842456733d 192.168.99.170:7002
   slots: (0 slots) slave
   replicates 0ff0e8ab05a8b032aeacf24e0c7fea77be3f5c55
S: cb2256b653cf5b7b3f9d1478cfa2953cc334c5bf 192.168.99.172:7005
   slots: (0 slots) slave
   replicates 9247dfb394441619da9da5b75b62b034c3f420e5
M: 0ff0e8ab05a8b032aeacf24e0c7fea77be3f5c55 192.168.99.171:7003
   slots:6827-10922 (4096 slots) master
   1 additional replica(s)
[OK] All nodes agree about slots configuration.
&gt;&gt;&gt; Check for open slots...
[WARNING] Node 192.168.99.171:7004 has slots in migrating state (1860).
[WARNING] Node 192.168.99.172:7007 has slots in importing state (1860).
[WARNING] The following slots are open: 1860
&gt;&gt;&gt; Check slots coverage...
[OK] All 16384 slots covered.
*** Please fix your cluster problems before resharding
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>手动 kill 掉 7004 和 7007 后再次重启，发现还是有问题</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[ERR] Nodes don't agree about configuration!
&gt;&gt;&gt; Check for open slots...
[WARNING] Node 192.168.99.172:7007 has slots in importing state (1860).
[WARNING] The following slots are open: 1860
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这个时候百度到了，使用 fix 来修复，但是没有成功，由于我把 /etc/redis-cluster/node-7007.conf 内容清空了。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>redis-trib.rb fix 192.168.99.172:7007
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="添加-node-作为-slave"><a href="#添加-node-作为-slave" class="header-anchor">#</a> 添加 node 作为 slave</h2> <p>在 eshop-cache03 上增加一个 7008 的 redis 节点</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># redis-trib.rb add-node --slave --master-id 要挂载的 masterid ，被挂载的 slave ，随便给一个集群节点即可
# 我这里是吧 7008 挂载到了 7001 上
redis-trib.rb add-node --slave --master-id b49a4562f0164bbf9c8fc9c6059e09e420ee7abf 192.168.99.172:7008 192.168.99.170:7001
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="删除-node"><a href="#删除-node" class="header-anchor">#</a> 删除 node</h2> <p>先用 resharding 将数据都移除到其他节点，确保 node 为空之后，才能执行 remove 操作</p> <p>这里删除 7007 这个，现在集群中 4 个 master 都是 4096 个 slots</p> <p>需要手动计算把 4096 平均分配给另外 3 个 master ，2 个分配 1365，1个分配 1366</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 手动执行 3 次，把 7007 上的 slots 分布迁移到其他 三个 master 上
redis-trib.rb reshard 192.168.99.170:7001

# 再删除 node-id，也就是协商 7007 的 id
redis-trib.rb del-node 192.168.99.170:7001 &lt;node-id&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>当你清空了一个 master 的 hashslot 时，redis cluster 就会自动将其 slave 挂载到其他 master 上去，这个时候就只要删除掉 master 就可以了</p> <iframe height="500px" width="100%" frameborder="0" allowfullscreen="allowfullscreen" src="/learn-book/ads.html"></iframe></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/abc0721/learn-book/edit/main/docs/cache-pdp/redis/030.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022-07-21 22:05:38</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/learn-book/cache-pdp/redis/029.html" class="prev">
        029. 对项目的 redis cluster 实验多 master 写入、读写分离、高可用性
      </a></span> <span class="next"><a href="/learn-book/cache-pdp/redis/031.html">
        031. redis cluster 的自动化 slave 迁移实现更强的高可用架构的部署方案
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/learn-book/assets/js/app.028ed7df.js" defer></script><script src="/learn-book/assets/js/2.21223788.js" defer></script><script src="/learn-book/assets/js/308.af120a3e.js" defer></script><script src="/learn-book/assets/js/83.ec5af474.js" defer></script>
  </body>
</html>
