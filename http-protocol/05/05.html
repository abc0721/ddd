<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>05 | 更好更快的握手: TLS 1.3 特性解析 | LEARN-BOOK</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/learn-book/favicon.ico">
    <link rel="manifest" href="/learn-book/manifest.json">
    <meta name="description" content="note-book 的第二分仓笔记仓库">
    
    <link rel="preload" href="/learn-book/assets/css/0.styles.d1598957.css" as="style"><link rel="preload" href="/learn-book/assets/js/app.028ed7df.js" as="script"><link rel="preload" href="/learn-book/assets/js/2.21223788.js" as="script"><link rel="preload" href="/learn-book/assets/js/59.2bd7f911.js" as="script"><link rel="preload" href="/learn-book/assets/js/83.ec5af474.js" as="script"><link rel="prefetch" href="/learn-book/assets/js/10.ae9ef0d5.js"><link rel="prefetch" href="/learn-book/assets/js/100.e2686a94.js"><link rel="prefetch" href="/learn-book/assets/js/101.1e48f558.js"><link rel="prefetch" href="/learn-book/assets/js/102.2b0aead0.js"><link rel="prefetch" href="/learn-book/assets/js/103.36a9d0c5.js"><link rel="prefetch" href="/learn-book/assets/js/104.940c0889.js"><link rel="prefetch" href="/learn-book/assets/js/105.4059f322.js"><link rel="prefetch" href="/learn-book/assets/js/106.258dd171.js"><link rel="prefetch" href="/learn-book/assets/js/107.dc32950f.js"><link rel="prefetch" href="/learn-book/assets/js/108.f96a8dee.js"><link rel="prefetch" href="/learn-book/assets/js/109.ba4b933c.js"><link rel="prefetch" href="/learn-book/assets/js/11.a08a42ea.js"><link rel="prefetch" href="/learn-book/assets/js/110.3035f734.js"><link rel="prefetch" href="/learn-book/assets/js/111.fa05b698.js"><link rel="prefetch" href="/learn-book/assets/js/112.bbb150f0.js"><link rel="prefetch" href="/learn-book/assets/js/113.1263dcc6.js"><link rel="prefetch" href="/learn-book/assets/js/114.82285aec.js"><link rel="prefetch" href="/learn-book/assets/js/115.7509736a.js"><link rel="prefetch" href="/learn-book/assets/js/116.f57394f2.js"><link rel="prefetch" href="/learn-book/assets/js/117.9f37dd43.js"><link rel="prefetch" href="/learn-book/assets/js/118.73b62d5e.js"><link rel="prefetch" href="/learn-book/assets/js/119.ccc80315.js"><link rel="prefetch" href="/learn-book/assets/js/12.40792829.js"><link rel="prefetch" href="/learn-book/assets/js/120.0feeb1b4.js"><link rel="prefetch" href="/learn-book/assets/js/121.7bbdbedc.js"><link rel="prefetch" href="/learn-book/assets/js/122.f239e92d.js"><link rel="prefetch" href="/learn-book/assets/js/123.430e5350.js"><link rel="prefetch" href="/learn-book/assets/js/124.4a74a756.js"><link rel="prefetch" href="/learn-book/assets/js/125.9d441c34.js"><link rel="prefetch" href="/learn-book/assets/js/126.97b348bf.js"><link rel="prefetch" href="/learn-book/assets/js/127.85743ce6.js"><link rel="prefetch" href="/learn-book/assets/js/128.133b2151.js"><link rel="prefetch" href="/learn-book/assets/js/129.91eacdb7.js"><link rel="prefetch" href="/learn-book/assets/js/13.65102ef7.js"><link rel="prefetch" href="/learn-book/assets/js/130.00470fe8.js"><link rel="prefetch" href="/learn-book/assets/js/131.181aef24.js"><link rel="prefetch" href="/learn-book/assets/js/132.4166cdea.js"><link rel="prefetch" href="/learn-book/assets/js/133.ec5b9acc.js"><link rel="prefetch" href="/learn-book/assets/js/134.0c928687.js"><link rel="prefetch" href="/learn-book/assets/js/135.0b49f1c2.js"><link rel="prefetch" href="/learn-book/assets/js/136.be67ae82.js"><link rel="prefetch" href="/learn-book/assets/js/137.6f85ad05.js"><link rel="prefetch" href="/learn-book/assets/js/138.b3fa2ba7.js"><link rel="prefetch" href="/learn-book/assets/js/139.abf8672e.js"><link rel="prefetch" href="/learn-book/assets/js/14.4813a349.js"><link rel="prefetch" href="/learn-book/assets/js/140.d03ed1c1.js"><link rel="prefetch" href="/learn-book/assets/js/141.da6ec0e4.js"><link rel="prefetch" href="/learn-book/assets/js/142.09aed130.js"><link rel="prefetch" href="/learn-book/assets/js/143.4cffc3e5.js"><link rel="prefetch" href="/learn-book/assets/js/144.224499c6.js"><link rel="prefetch" href="/learn-book/assets/js/145.0268dd0e.js"><link rel="prefetch" href="/learn-book/assets/js/146.f0d0970e.js"><link rel="prefetch" href="/learn-book/assets/js/147.4a203a56.js"><link rel="prefetch" href="/learn-book/assets/js/148.3b084bf3.js"><link rel="prefetch" href="/learn-book/assets/js/149.d42b82bd.js"><link rel="prefetch" href="/learn-book/assets/js/15.ca243d77.js"><link rel="prefetch" href="/learn-book/assets/js/150.30cad9c9.js"><link rel="prefetch" href="/learn-book/assets/js/151.a27ba2c5.js"><link rel="prefetch" href="/learn-book/assets/js/152.8e388b90.js"><link rel="prefetch" href="/learn-book/assets/js/153.380f332c.js"><link rel="prefetch" href="/learn-book/assets/js/154.163b241b.js"><link rel="prefetch" href="/learn-book/assets/js/155.dacd37a6.js"><link rel="prefetch" href="/learn-book/assets/js/156.9296f4c8.js"><link rel="prefetch" href="/learn-book/assets/js/157.0c12b4ce.js"><link rel="prefetch" href="/learn-book/assets/js/158.79e7656c.js"><link rel="prefetch" href="/learn-book/assets/js/159.02749d11.js"><link rel="prefetch" href="/learn-book/assets/js/16.22ac0778.js"><link rel="prefetch" href="/learn-book/assets/js/160.3efbd6a0.js"><link rel="prefetch" href="/learn-book/assets/js/161.11e17eb7.js"><link rel="prefetch" href="/learn-book/assets/js/162.ed81bb49.js"><link rel="prefetch" href="/learn-book/assets/js/163.c321ec8d.js"><link rel="prefetch" href="/learn-book/assets/js/164.6831a594.js"><link rel="prefetch" href="/learn-book/assets/js/165.9e13a7e1.js"><link rel="prefetch" href="/learn-book/assets/js/166.20287335.js"><link rel="prefetch" href="/learn-book/assets/js/167.06fe0883.js"><link rel="prefetch" href="/learn-book/assets/js/168.574a5d34.js"><link rel="prefetch" href="/learn-book/assets/js/169.78d54345.js"><link rel="prefetch" href="/learn-book/assets/js/17.467198e5.js"><link rel="prefetch" href="/learn-book/assets/js/170.a8a8c838.js"><link rel="prefetch" href="/learn-book/assets/js/171.bce5528f.js"><link rel="prefetch" href="/learn-book/assets/js/172.6d122eaf.js"><link rel="prefetch" href="/learn-book/assets/js/173.b7b1734b.js"><link rel="prefetch" href="/learn-book/assets/js/174.0c5ddece.js"><link rel="prefetch" href="/learn-book/assets/js/175.fcb3bb1e.js"><link rel="prefetch" href="/learn-book/assets/js/176.4c8b6c1b.js"><link rel="prefetch" href="/learn-book/assets/js/177.2c821a10.js"><link rel="prefetch" href="/learn-book/assets/js/178.4b938acb.js"><link rel="prefetch" href="/learn-book/assets/js/179.e5a3f9d5.js"><link rel="prefetch" href="/learn-book/assets/js/18.2c2655d3.js"><link rel="prefetch" href="/learn-book/assets/js/180.e075e24a.js"><link rel="prefetch" href="/learn-book/assets/js/181.a8659308.js"><link rel="prefetch" href="/learn-book/assets/js/182.e02e157b.js"><link rel="prefetch" href="/learn-book/assets/js/183.fec3be72.js"><link rel="prefetch" href="/learn-book/assets/js/184.06841422.js"><link rel="prefetch" href="/learn-book/assets/js/185.967d47f7.js"><link rel="prefetch" href="/learn-book/assets/js/186.b27543eb.js"><link rel="prefetch" href="/learn-book/assets/js/187.0ab43110.js"><link rel="prefetch" href="/learn-book/assets/js/188.d2c20c41.js"><link rel="prefetch" href="/learn-book/assets/js/189.e50ac920.js"><link rel="prefetch" href="/learn-book/assets/js/19.87356261.js"><link rel="prefetch" href="/learn-book/assets/js/190.0bcce66f.js"><link rel="prefetch" href="/learn-book/assets/js/191.1a3d3266.js"><link rel="prefetch" href="/learn-book/assets/js/192.b46f1f92.js"><link rel="prefetch" href="/learn-book/assets/js/193.7cd9a2e2.js"><link rel="prefetch" href="/learn-book/assets/js/194.c7cac8f4.js"><link rel="prefetch" href="/learn-book/assets/js/195.76b36b43.js"><link rel="prefetch" href="/learn-book/assets/js/196.9ad5f9de.js"><link rel="prefetch" href="/learn-book/assets/js/197.2914f34f.js"><link rel="prefetch" href="/learn-book/assets/js/198.2e2c2c64.js"><link rel="prefetch" href="/learn-book/assets/js/199.0d8fc29e.js"><link rel="prefetch" href="/learn-book/assets/js/20.8693e977.js"><link rel="prefetch" href="/learn-book/assets/js/200.2bc59ffe.js"><link rel="prefetch" href="/learn-book/assets/js/201.6765dba2.js"><link rel="prefetch" href="/learn-book/assets/js/202.d19062c8.js"><link rel="prefetch" href="/learn-book/assets/js/203.270e8e72.js"><link rel="prefetch" href="/learn-book/assets/js/204.0ecf2cd8.js"><link rel="prefetch" href="/learn-book/assets/js/205.b241dd2b.js"><link rel="prefetch" href="/learn-book/assets/js/206.3d555da2.js"><link rel="prefetch" href="/learn-book/assets/js/207.b88d10dc.js"><link rel="prefetch" href="/learn-book/assets/js/208.d15b9895.js"><link rel="prefetch" href="/learn-book/assets/js/209.404964dd.js"><link rel="prefetch" href="/learn-book/assets/js/21.ce55ac2d.js"><link rel="prefetch" href="/learn-book/assets/js/210.8a6ad39b.js"><link rel="prefetch" href="/learn-book/assets/js/211.9f828903.js"><link rel="prefetch" href="/learn-book/assets/js/212.ecdb6c3d.js"><link rel="prefetch" href="/learn-book/assets/js/213.093b4b7f.js"><link rel="prefetch" href="/learn-book/assets/js/214.17e91916.js"><link rel="prefetch" href="/learn-book/assets/js/215.8f7b103b.js"><link rel="prefetch" href="/learn-book/assets/js/216.5a4cb55c.js"><link rel="prefetch" href="/learn-book/assets/js/217.850e8745.js"><link rel="prefetch" href="/learn-book/assets/js/218.b8913e63.js"><link rel="prefetch" href="/learn-book/assets/js/219.3260d54b.js"><link rel="prefetch" href="/learn-book/assets/js/22.2a565240.js"><link rel="prefetch" href="/learn-book/assets/js/220.6e440719.js"><link rel="prefetch" href="/learn-book/assets/js/221.ed0a4a3e.js"><link rel="prefetch" href="/learn-book/assets/js/222.ab1bbc7e.js"><link rel="prefetch" href="/learn-book/assets/js/223.b8d3fbb0.js"><link rel="prefetch" href="/learn-book/assets/js/224.eba39f96.js"><link rel="prefetch" href="/learn-book/assets/js/225.ba57ac7b.js"><link rel="prefetch" href="/learn-book/assets/js/226.760b4caf.js"><link rel="prefetch" href="/learn-book/assets/js/227.ff81b1ba.js"><link rel="prefetch" href="/learn-book/assets/js/228.15305fd8.js"><link rel="prefetch" href="/learn-book/assets/js/229.b1f93d41.js"><link rel="prefetch" href="/learn-book/assets/js/23.e4419686.js"><link rel="prefetch" href="/learn-book/assets/js/230.982e5c6c.js"><link rel="prefetch" href="/learn-book/assets/js/231.8ac0560e.js"><link rel="prefetch" href="/learn-book/assets/js/232.32eb3205.js"><link rel="prefetch" href="/learn-book/assets/js/233.cb14ad35.js"><link rel="prefetch" href="/learn-book/assets/js/234.0e3fb631.js"><link rel="prefetch" href="/learn-book/assets/js/235.1d7db823.js"><link rel="prefetch" href="/learn-book/assets/js/236.56df2b30.js"><link rel="prefetch" href="/learn-book/assets/js/237.56902777.js"><link rel="prefetch" href="/learn-book/assets/js/238.077f8961.js"><link rel="prefetch" href="/learn-book/assets/js/239.836f2633.js"><link rel="prefetch" href="/learn-book/assets/js/24.4ef60a35.js"><link rel="prefetch" href="/learn-book/assets/js/240.1958dc97.js"><link rel="prefetch" href="/learn-book/assets/js/241.628723f2.js"><link rel="prefetch" href="/learn-book/assets/js/242.80a9054d.js"><link rel="prefetch" href="/learn-book/assets/js/243.59d79e44.js"><link rel="prefetch" href="/learn-book/assets/js/244.d3442a00.js"><link rel="prefetch" href="/learn-book/assets/js/245.df290ae1.js"><link rel="prefetch" href="/learn-book/assets/js/246.bb4eb062.js"><link rel="prefetch" href="/learn-book/assets/js/247.c1cbe04d.js"><link rel="prefetch" href="/learn-book/assets/js/248.920787b0.js"><link rel="prefetch" href="/learn-book/assets/js/249.7ab19c67.js"><link rel="prefetch" href="/learn-book/assets/js/25.2b3311b7.js"><link rel="prefetch" href="/learn-book/assets/js/250.eacfb6a8.js"><link rel="prefetch" href="/learn-book/assets/js/251.44eb2a6b.js"><link rel="prefetch" href="/learn-book/assets/js/252.5af941db.js"><link rel="prefetch" href="/learn-book/assets/js/253.1d016c96.js"><link rel="prefetch" href="/learn-book/assets/js/254.3a6ec810.js"><link rel="prefetch" href="/learn-book/assets/js/255.77db8369.js"><link rel="prefetch" href="/learn-book/assets/js/256.a7b36739.js"><link rel="prefetch" href="/learn-book/assets/js/257.cffe71a4.js"><link rel="prefetch" href="/learn-book/assets/js/258.fdb4c219.js"><link rel="prefetch" href="/learn-book/assets/js/259.455a0c8b.js"><link rel="prefetch" href="/learn-book/assets/js/26.70973cf8.js"><link rel="prefetch" href="/learn-book/assets/js/260.f7d47a3e.js"><link rel="prefetch" href="/learn-book/assets/js/261.b1e2a5bf.js"><link rel="prefetch" href="/learn-book/assets/js/262.aaa755c2.js"><link rel="prefetch" href="/learn-book/assets/js/263.e838a513.js"><link rel="prefetch" href="/learn-book/assets/js/264.b8733c83.js"><link rel="prefetch" href="/learn-book/assets/js/265.c5fdd3c5.js"><link rel="prefetch" href="/learn-book/assets/js/266.e8d01769.js"><link rel="prefetch" href="/learn-book/assets/js/267.c9742e28.js"><link rel="prefetch" href="/learn-book/assets/js/268.2b148bef.js"><link rel="prefetch" href="/learn-book/assets/js/269.e03565b0.js"><link rel="prefetch" href="/learn-book/assets/js/27.8106f1e9.js"><link rel="prefetch" href="/learn-book/assets/js/270.65b5d908.js"><link rel="prefetch" href="/learn-book/assets/js/271.fbde0cac.js"><link rel="prefetch" href="/learn-book/assets/js/272.03745530.js"><link rel="prefetch" href="/learn-book/assets/js/273.8785fc29.js"><link rel="prefetch" href="/learn-book/assets/js/274.0ff015ae.js"><link rel="prefetch" href="/learn-book/assets/js/275.4fe4ba23.js"><link rel="prefetch" href="/learn-book/assets/js/276.26d537d4.js"><link rel="prefetch" href="/learn-book/assets/js/277.d95836c7.js"><link rel="prefetch" href="/learn-book/assets/js/278.eb312d49.js"><link rel="prefetch" href="/learn-book/assets/js/279.d0ce3bfd.js"><link rel="prefetch" href="/learn-book/assets/js/28.b3ebf8e6.js"><link rel="prefetch" href="/learn-book/assets/js/280.0c7ddd76.js"><link rel="prefetch" href="/learn-book/assets/js/281.94b40ca5.js"><link rel="prefetch" href="/learn-book/assets/js/282.4f902cb2.js"><link rel="prefetch" href="/learn-book/assets/js/283.834f65b2.js"><link rel="prefetch" href="/learn-book/assets/js/284.283c48cf.js"><link rel="prefetch" href="/learn-book/assets/js/285.4c68b9f5.js"><link rel="prefetch" href="/learn-book/assets/js/286.c34e142a.js"><link rel="prefetch" href="/learn-book/assets/js/287.b6713fe5.js"><link rel="prefetch" href="/learn-book/assets/js/288.cac84ba9.js"><link rel="prefetch" href="/learn-book/assets/js/289.9a6f3ebc.js"><link rel="prefetch" href="/learn-book/assets/js/29.e196143d.js"><link rel="prefetch" href="/learn-book/assets/js/290.fe2f74e5.js"><link rel="prefetch" href="/learn-book/assets/js/291.23dc1b91.js"><link rel="prefetch" href="/learn-book/assets/js/292.80606528.js"><link rel="prefetch" href="/learn-book/assets/js/293.aa013666.js"><link rel="prefetch" href="/learn-book/assets/js/294.0dee2576.js"><link rel="prefetch" href="/learn-book/assets/js/295.c731059a.js"><link rel="prefetch" href="/learn-book/assets/js/296.b226f176.js"><link rel="prefetch" href="/learn-book/assets/js/297.69f8e024.js"><link rel="prefetch" href="/learn-book/assets/js/298.8d2da06c.js"><link rel="prefetch" href="/learn-book/assets/js/299.e168b956.js"><link rel="prefetch" href="/learn-book/assets/js/3.e9334214.js"><link rel="prefetch" href="/learn-book/assets/js/30.0f44a043.js"><link rel="prefetch" href="/learn-book/assets/js/300.335941ee.js"><link rel="prefetch" href="/learn-book/assets/js/301.4bab8322.js"><link rel="prefetch" href="/learn-book/assets/js/302.2f5148b0.js"><link rel="prefetch" href="/learn-book/assets/js/303.2e8d30f0.js"><link rel="prefetch" href="/learn-book/assets/js/304.f0e9bbb8.js"><link rel="prefetch" href="/learn-book/assets/js/305.80fc4688.js"><link rel="prefetch" href="/learn-book/assets/js/306.f554b95c.js"><link rel="prefetch" href="/learn-book/assets/js/307.03aa7e5b.js"><link rel="prefetch" href="/learn-book/assets/js/308.af120a3e.js"><link rel="prefetch" href="/learn-book/assets/js/309.af606132.js"><link rel="prefetch" href="/learn-book/assets/js/31.00dd7380.js"><link rel="prefetch" href="/learn-book/assets/js/310.47599795.js"><link rel="prefetch" href="/learn-book/assets/js/311.00539011.js"><link rel="prefetch" href="/learn-book/assets/js/312.fbc57673.js"><link rel="prefetch" href="/learn-book/assets/js/313.8e8daad4.js"><link rel="prefetch" href="/learn-book/assets/js/314.268dcf0e.js"><link rel="prefetch" href="/learn-book/assets/js/315.aabe7e52.js"><link rel="prefetch" href="/learn-book/assets/js/316.faa4e876.js"><link rel="prefetch" href="/learn-book/assets/js/317.d802eb3f.js"><link rel="prefetch" href="/learn-book/assets/js/318.c262b463.js"><link rel="prefetch" href="/learn-book/assets/js/319.24a8ff4d.js"><link rel="prefetch" href="/learn-book/assets/js/32.7c34bc5e.js"><link rel="prefetch" href="/learn-book/assets/js/320.9c7cda5a.js"><link rel="prefetch" href="/learn-book/assets/js/321.23b9a0be.js"><link rel="prefetch" href="/learn-book/assets/js/322.ad972338.js"><link rel="prefetch" href="/learn-book/assets/js/323.07f13ace.js"><link rel="prefetch" href="/learn-book/assets/js/324.18b8d5ae.js"><link rel="prefetch" href="/learn-book/assets/js/325.f01bde16.js"><link rel="prefetch" href="/learn-book/assets/js/326.629c1072.js"><link rel="prefetch" href="/learn-book/assets/js/327.39e6c9e2.js"><link rel="prefetch" href="/learn-book/assets/js/328.c699721e.js"><link rel="prefetch" href="/learn-book/assets/js/329.b54ab0db.js"><link rel="prefetch" href="/learn-book/assets/js/33.2386fa0f.js"><link rel="prefetch" href="/learn-book/assets/js/330.79e7cbcf.js"><link rel="prefetch" href="/learn-book/assets/js/331.377fadf6.js"><link rel="prefetch" href="/learn-book/assets/js/332.63cd94c2.js"><link rel="prefetch" href="/learn-book/assets/js/333.da52ece6.js"><link rel="prefetch" href="/learn-book/assets/js/334.5f196b50.js"><link rel="prefetch" href="/learn-book/assets/js/335.97b4ef4c.js"><link rel="prefetch" href="/learn-book/assets/js/336.e57f018e.js"><link rel="prefetch" href="/learn-book/assets/js/337.0a5a0859.js"><link rel="prefetch" href="/learn-book/assets/js/338.7a7f0b61.js"><link rel="prefetch" href="/learn-book/assets/js/339.7cd408bd.js"><link rel="prefetch" href="/learn-book/assets/js/34.0d02a15e.js"><link rel="prefetch" href="/learn-book/assets/js/340.04cb06e8.js"><link rel="prefetch" href="/learn-book/assets/js/341.537861d1.js"><link rel="prefetch" href="/learn-book/assets/js/342.da14f695.js"><link rel="prefetch" href="/learn-book/assets/js/343.74707d52.js"><link rel="prefetch" href="/learn-book/assets/js/344.b350096e.js"><link rel="prefetch" href="/learn-book/assets/js/345.dbf62aca.js"><link rel="prefetch" href="/learn-book/assets/js/346.3f255f50.js"><link rel="prefetch" href="/learn-book/assets/js/347.f4668b0d.js"><link rel="prefetch" href="/learn-book/assets/js/348.542573cc.js"><link rel="prefetch" href="/learn-book/assets/js/349.6888cb35.js"><link rel="prefetch" href="/learn-book/assets/js/35.74523ded.js"><link rel="prefetch" href="/learn-book/assets/js/350.cd705439.js"><link rel="prefetch" href="/learn-book/assets/js/351.093058d4.js"><link rel="prefetch" href="/learn-book/assets/js/352.77230cba.js"><link rel="prefetch" href="/learn-book/assets/js/353.8f883fac.js"><link rel="prefetch" href="/learn-book/assets/js/354.d52aee3e.js"><link rel="prefetch" href="/learn-book/assets/js/355.77a0126a.js"><link rel="prefetch" href="/learn-book/assets/js/356.dbf927e4.js"><link rel="prefetch" href="/learn-book/assets/js/357.0973baa0.js"><link rel="prefetch" href="/learn-book/assets/js/358.cac7fab3.js"><link rel="prefetch" href="/learn-book/assets/js/359.e8330d89.js"><link rel="prefetch" href="/learn-book/assets/js/36.0da2006f.js"><link rel="prefetch" href="/learn-book/assets/js/360.afef7c08.js"><link rel="prefetch" href="/learn-book/assets/js/361.6237f112.js"><link rel="prefetch" href="/learn-book/assets/js/362.34d1483e.js"><link rel="prefetch" href="/learn-book/assets/js/363.b7b45618.js"><link rel="prefetch" href="/learn-book/assets/js/364.e6d9ce62.js"><link rel="prefetch" href="/learn-book/assets/js/37.2fc83856.js"><link rel="prefetch" href="/learn-book/assets/js/38.79be50ee.js"><link rel="prefetch" href="/learn-book/assets/js/39.88a682f8.js"><link rel="prefetch" href="/learn-book/assets/js/4.0c4a4c2a.js"><link rel="prefetch" href="/learn-book/assets/js/40.e29bfa4b.js"><link rel="prefetch" href="/learn-book/assets/js/41.d4016d53.js"><link rel="prefetch" href="/learn-book/assets/js/42.c548ba43.js"><link rel="prefetch" href="/learn-book/assets/js/43.472c0c7f.js"><link rel="prefetch" href="/learn-book/assets/js/44.e0613af7.js"><link rel="prefetch" href="/learn-book/assets/js/45.e0c5b514.js"><link rel="prefetch" href="/learn-book/assets/js/46.0d833848.js"><link rel="prefetch" href="/learn-book/assets/js/47.167e51ca.js"><link rel="prefetch" href="/learn-book/assets/js/48.c55f2d7a.js"><link rel="prefetch" href="/learn-book/assets/js/49.600b0356.js"><link rel="prefetch" href="/learn-book/assets/js/5.c26035a1.js"><link rel="prefetch" href="/learn-book/assets/js/50.70947932.js"><link rel="prefetch" href="/learn-book/assets/js/51.924af1dd.js"><link rel="prefetch" href="/learn-book/assets/js/52.447da1c4.js"><link rel="prefetch" href="/learn-book/assets/js/53.b7e4c782.js"><link rel="prefetch" href="/learn-book/assets/js/54.4d31d080.js"><link rel="prefetch" href="/learn-book/assets/js/55.91a4b03c.js"><link rel="prefetch" href="/learn-book/assets/js/56.1cb7915e.js"><link rel="prefetch" href="/learn-book/assets/js/57.2affe6fc.js"><link rel="prefetch" href="/learn-book/assets/js/58.27d5c7cd.js"><link rel="prefetch" href="/learn-book/assets/js/6.41833f8f.js"><link rel="prefetch" href="/learn-book/assets/js/60.626def20.js"><link rel="prefetch" href="/learn-book/assets/js/61.45f51e6d.js"><link rel="prefetch" href="/learn-book/assets/js/62.4bdda78c.js"><link rel="prefetch" href="/learn-book/assets/js/63.557bc394.js"><link rel="prefetch" href="/learn-book/assets/js/64.aff699bf.js"><link rel="prefetch" href="/learn-book/assets/js/65.692f7816.js"><link rel="prefetch" href="/learn-book/assets/js/66.25ecbcaa.js"><link rel="prefetch" href="/learn-book/assets/js/67.8fa8a16e.js"><link rel="prefetch" href="/learn-book/assets/js/68.92b6a3f8.js"><link rel="prefetch" href="/learn-book/assets/js/69.efff96d2.js"><link rel="prefetch" href="/learn-book/assets/js/7.8100f2ed.js"><link rel="prefetch" href="/learn-book/assets/js/70.aacd8d45.js"><link rel="prefetch" href="/learn-book/assets/js/71.97a38b91.js"><link rel="prefetch" href="/learn-book/assets/js/72.fa0bbfba.js"><link rel="prefetch" href="/learn-book/assets/js/73.7065bf44.js"><link rel="prefetch" href="/learn-book/assets/js/74.cc9e8786.js"><link rel="prefetch" href="/learn-book/assets/js/75.9853915c.js"><link rel="prefetch" href="/learn-book/assets/js/76.3bb84aff.js"><link rel="prefetch" href="/learn-book/assets/js/77.1d7faa0b.js"><link rel="prefetch" href="/learn-book/assets/js/78.82ccf15d.js"><link rel="prefetch" href="/learn-book/assets/js/79.1ca14563.js"><link rel="prefetch" href="/learn-book/assets/js/8.a6e82c65.js"><link rel="prefetch" href="/learn-book/assets/js/80.009c8d78.js"><link rel="prefetch" href="/learn-book/assets/js/81.7c70581a.js"><link rel="prefetch" href="/learn-book/assets/js/82.25fa4637.js"><link rel="prefetch" href="/learn-book/assets/js/84.9e77b512.js"><link rel="prefetch" href="/learn-book/assets/js/85.bebb4293.js"><link rel="prefetch" href="/learn-book/assets/js/86.5a6fb0e3.js"><link rel="prefetch" href="/learn-book/assets/js/87.5a748d18.js"><link rel="prefetch" href="/learn-book/assets/js/88.17a0f517.js"><link rel="prefetch" href="/learn-book/assets/js/89.22035541.js"><link rel="prefetch" href="/learn-book/assets/js/9.5a3b25cd.js"><link rel="prefetch" href="/learn-book/assets/js/90.3222c7da.js"><link rel="prefetch" href="/learn-book/assets/js/91.4b34da5a.js"><link rel="prefetch" href="/learn-book/assets/js/92.9739a603.js"><link rel="prefetch" href="/learn-book/assets/js/93.38329abe.js"><link rel="prefetch" href="/learn-book/assets/js/94.52432e65.js"><link rel="prefetch" href="/learn-book/assets/js/95.363db7ac.js"><link rel="prefetch" href="/learn-book/assets/js/96.f5e07454.js"><link rel="prefetch" href="/learn-book/assets/js/97.76268626.js"><link rel="prefetch" href="/learn-book/assets/js/98.34e210bb.js"><link rel="prefetch" href="/learn-book/assets/js/99.d3018ce2.js">
    <link rel="stylesheet" href="/learn-book/assets/css/0.styles.d1598957.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-book/" class="home-link router-link-active"><img src="/learn-book/mlogo.svg" alt="LEARN-BOOK" class="logo"> <span class="site-name can-hide">LEARN-BOOK</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow down"></span></button> <button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="mobile-dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          综合性导航
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/" class="nav-link">
  全目录导航
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/001-introduce.html" class="nav-link">
  第一版（001 ~ 123 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/124.html" class="nav-link">
  第二版（124 ~ 195 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/121.html" class="nav-link">
  课程总结（难题与解决方案）
</a></li></ul></li><li class="dropdown-item"><h4>
          精彩知识精选
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/redis/007.html" class="nav-link">
  Redis 篇（redis 企业级集群架构）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/035.html" class="nav-link">
  多级缓存架构设计
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/040.html" class="nav-link">
  数据库 + 缓存双写一致性解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/045.html" class="nav-link">
  缓存维度化拆分解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/051.html" class="nav-link">
  缓存命中率提升解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/057.html" class="nav-link">
  缓存并发重建冲突解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/069.html" class="nav-link">
  缓存预热解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/077.html" class="nav-link">
  热点缓存自动降级方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/110.html" class="nav-link">
  缓存雪崩解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/117.html" class="nav-link">
  缓存穿透解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/119.html" class="nav-link">
  缓存失效解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/hystrix/084.html" class="nav-link">
  高可用分布式系统架构设计（hystrix 篇）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/047.html" class="nav-link">
  spring boot 整合 ehcache
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/storm/062.html" class="nav-link">
  史上最通俗易懂 Storm 教程
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程目录" class="dropdown-title"><span class="title">课程目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程目录" class="mobile-dropdown-title"><span class="title">课程目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn-book/monitor-tuning/" class="nav-link">
  JAVA 生产环境下性能监控与调优详解
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/http-protocol/" class="nav-link router-link-active">
  透视 HTTP 协议
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/ddd/" class="nav-link">
  DDD 实战课
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/middle-office/" class="nav-link">
  说透中台
</a></li><li class="dropdown-item"><h4>
          设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/imocc/design_pattern/" class="nav-link">
  设计模式（慕课）
</a></li><li class="dropdown-subitem"><a href="/learn-book/design_pattern/" class="nav-link">
  研磨设计模式（李兴华）
</a></li></ul></li></ul></div></div> <a href="https://github.com/abc0721/learn-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow down"></span></button> <button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="mobile-dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          综合性导航
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/" class="nav-link">
  全目录导航
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/001-introduce.html" class="nav-link">
  第一版（001 ~ 123 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/124.html" class="nav-link">
  第二版（124 ~ 195 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/121.html" class="nav-link">
  课程总结（难题与解决方案）
</a></li></ul></li><li class="dropdown-item"><h4>
          精彩知识精选
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/redis/007.html" class="nav-link">
  Redis 篇（redis 企业级集群架构）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/035.html" class="nav-link">
  多级缓存架构设计
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/040.html" class="nav-link">
  数据库 + 缓存双写一致性解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/045.html" class="nav-link">
  缓存维度化拆分解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/051.html" class="nav-link">
  缓存命中率提升解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/057.html" class="nav-link">
  缓存并发重建冲突解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/069.html" class="nav-link">
  缓存预热解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/077.html" class="nav-link">
  热点缓存自动降级方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/110.html" class="nav-link">
  缓存雪崩解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/117.html" class="nav-link">
  缓存穿透解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/119.html" class="nav-link">
  缓存失效解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/hystrix/084.html" class="nav-link">
  高可用分布式系统架构设计（hystrix 篇）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/047.html" class="nav-link">
  spring boot 整合 ehcache
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/storm/062.html" class="nav-link">
  史上最通俗易懂 Storm 教程
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程目录" class="dropdown-title"><span class="title">课程目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程目录" class="mobile-dropdown-title"><span class="title">课程目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn-book/monitor-tuning/" class="nav-link">
  JAVA 生产环境下性能监控与调优详解
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/http-protocol/" class="nav-link router-link-active">
  透视 HTTP 协议
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/ddd/" class="nav-link">
  DDD 实战课
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/middle-office/" class="nav-link">
  说透中台
</a></li><li class="dropdown-item"><h4>
          设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/imocc/design_pattern/" class="nav-link">
  设计模式（慕课）
</a></li><li class="dropdown-subitem"><a href="/learn-book/design_pattern/" class="nav-link">
  研磨设计模式（李兴华）
</a></li></ul></li></ul></div></div> <a href="https://github.com/abc0721/learn-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/learn-book/http-protocol/" aria-current="page" class="sidebar-link">透视 HTTP 协议</a></li><li><a href="/learn-book/http-protocol/01/" class="sidebar-link">01 | 开篇: To Be a HTTP Hero</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/http-protocol/02/" class="sidebar-heading clickable"><span>02 | 破冰篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/http-protocol/03/" class="sidebar-heading clickable"><span>03 | 基础篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/http-protocol/04/" class="sidebar-heading clickable"><span>04 | 进阶篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/http-protocol/05/" class="sidebar-heading clickable router-link-active open"><span>05 | 安全篇</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-book/http-protocol/05/01.html" class="sidebar-link">01 | TLS 又是什么？</a></li><li><a href="/learn-book/http-protocol/05/02.html" class="sidebar-link">02 | 固若金汤的根本: 对称加密与非对称加密</a></li><li><a href="/learn-book/http-protocol/05/03.html" class="sidebar-link">03 | 固若金汤的根本: 数字签名与证书</a></li><li><a href="/learn-book/http-protocol/05/04.html" class="sidebar-link">04 | 信任始于握手: TLS 1.2 连接过程解析</a></li><li><a href="/learn-book/http-protocol/05/05.html" aria-current="page" class="active sidebar-link">05 | 更好更快的握手: TLS 1.3 特性解析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/05/05.html#最大化兼容性" class="sidebar-link">最大化兼容性</a></li><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/05/05.html#强化安全" class="sidebar-link">强化安全</a></li><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/05/05.html#提升性能" class="sidebar-link">提升性能</a></li><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/05/05.html#握手分析" class="sidebar-link">握手分析</a></li><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/05/05.html#小结" class="sidebar-link">小结</a></li><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/05/05.html#课下作业" class="sidebar-link">课下作业</a></li><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/05/05.html#拓展阅读" class="sidebar-link">拓展阅读</a></li></ul></li><li><a href="/learn-book/http-protocol/05/06.html" class="sidebar-link">06 | 连接太慢该怎么办 HTTPS 的优化</a></li><li><a href="/learn-book/http-protocol/05/07.html" class="sidebar-link">07 | 我应该迁移到 HTTPS 吗？</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/http-protocol/06/" class="sidebar-heading clickable"><span>06 | 飞翔篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/http-protocol/07/" class="sidebar-heading clickable"><span>07 | 探索篇</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/learn-book/http-protocol/08/" class="sidebar-link">08 | 总结篇: HTTP 性能优化面面观</a></li><li><a href="/learn-book/http-protocol/09.html" class="sidebar-link">参考资源</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_05-更好更快的握手-tls-1-3-特性解析"><a href="#_05-更好更快的握手-tls-1-3-特性解析" class="header-anchor">#</a> 05 | 更好更快的握手: TLS 1.3 特性解析</h1> <p>上一讲中我讲了 TLS1.2 的握手过程，你是不是已经完全掌握了呢？</p> <p>不过 TLS1.2 已经是 10 年前（2008 年）的老协议了，虽然历经考验，但毕竟岁月不饶人，在安全、性能等方面已经跟不上如今的互联网了。</p> <p>于是经过四年、近 30 个草案的反复打磨，TLS1.3 终于在去年（2018 年）粉墨登场，再次确立了信息安全领域的新标准。</p> <p>在抓包分析握手之前，我们先来快速浏览一下 TLS1.3 的三个主要改进目标：<strong>兼容</strong>、<strong>安全与性能</strong> 。</p> <h2 id="最大化兼容性"><a href="#最大化兼容性" class="header-anchor">#</a> 最大化兼容性</h2> <p>由于 1.1、1.2 等协议已经出现了很多年，很多应用软件、中间代理（官方称为<code>MiddleBox</code>）只认老的记录协议格式，更新改造很困难，甚至是不可行（设备僵化）。</p> <p>在早期的试验中发现，一旦变更了记录头字段里的版本号，也就是由 0x303（TLS1.2）改为 0x304（TLS1.3）的话，大量的代理服务器、网关都无法正确处理，最终导致 TLS 握手失败。</p> <p>为了保证这些被广泛部署的 「老设备」 能够继续使用，避免新协议带来的冲击，TLS1.3 不得不做出妥协，保持现有的记录格式不变，通过伪装来实现兼容，使得 TLS1.3 看上去像是 TLS1.2。</p> <p>那么，该怎么区分 1.2 和 1.3 呢？</p> <p>这要用到一个新的 <strong>扩展协议</strong>（Extension Protocol），它有点补充条款的意思，通过在记录末尾添加一系列的「扩展字段」来增加新的功能，老版本的 TLS 不认识它可以直接忽略，这就实现了「后向兼容」。</p> <p>在记录头的 Version 字段被兼容性「固定」的情况下，只要是 TLS1.3 协议，握手的 <code>Hello</code> 消息后面就必须有 <strong>supported_versions</strong> 扩展，它标记了 TLS 的版本号，使用它就能区分新旧协议。</p> <p>其实上一讲 Chrome 在握手时发的就是 TLS1.3 协议，你可以看一下 <code>Client Hello</code> 消息后面的扩展，只是因为服务器不支持 1.3，所以就 <strong>后向兼容</strong> 降级成了 1.2。</p> <div class="language-http line-numbers-mode"><pre class="language-http"><code>Handshake Protocol: Client Hello
    Version: TLS 1.2 (0x0303)
    Extension: supported_versions (len=11)
        Supported Version: TLS 1.3 (0x0304)
        Supported Version: TLS 1.2 (0x0303)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>TLS1.3 利用扩展实现了许多重要的功能，比如 <code>supported_groups</code>、<code>key_share</code>、<code>signature_algorithms</code>、<code>server_name</code> 等，这些等后面用到的时候再说。</p> <h2 id="强化安全"><a href="#强化安全" class="header-anchor">#</a> 强化安全</h2> <p>TLS1.2 在十来年的应用中获得了许多宝贵的经验，陆续发现了很多的漏洞和加密算法的弱点，所以 TLS1.3 就在协议里修补了这些不安全因素。</p> <p>比如：</p> <ul><li>伪随机数函数由 PRF 升级为 HKDF（HMAC-based Extract-and-Expand Key Derivation Function）；</li> <li>明确禁止在记录协议里使用压缩；</li> <li>废除了 RC4、DES 对称加密算法；</li> <li>废除了 ECB、CBC 等传统分组模式；</li> <li>废除了 MD5、SHA1、SHA-224 摘要算法；</li> <li>废除了 RSA、DH 密钥交换算法和许多命名曲线。</li></ul> <p>经过这一番「减肥瘦身」之后，TLS1.3 里只保留了 AES、ChaCha20 对称加密算法，分组模式只能用 AEAD 的 GCM、CCM 和 Poly1305，摘要算法只能用 SHA256、SHA384，密钥交换算法只有 ECDHE 和 DHE，椭圆曲线也被“砍”到只剩 P-256 和 x25519 等 5 种。</p> <p>减肥可以让人变得更轻巧灵活，TLS 也是这样。</p> <p>算法精简后带来了一个意料之中的好处：原来众多的算法、参数组合导致密码套件非常复杂，难以选择，而现在的 TLS1.3 里只有 5 个套件，无论是客户端还是服务器都不会再犯“选择困难症”了。</p> <p><img src="/learn-book/assets/img/eeeb1d30acbc0e69541ce0620346b765.eeeb1d30.jpg" alt="img"></p> <p>这里还要特别说一下废除 RSA 和 DH 密钥交换算法的原因。</p> <p>上一讲用 Wireshark 抓包时你一定看到了，浏览器默认会使用 ECDHE 而不是 RSA 做密钥交换，这是因为它不具有 <strong>前向安全</strong>（Forward Secrecy）。</p> <p>假设有这么一个很有耐心的黑客，一直在长期收集混合加密系统收发的所有报文。如果加密系统使用服务器证书里的 RSA 做密钥交换，一旦私钥泄露或被破解（使用社会工程学或者巨型计算机），那么黑客就能够使用私钥解密出之前所有报文的 <code>Pre-Master</code> ，再算出会话密钥，破解所有密文。</p> <p>这就是所谓的 <strong>今日截获，明日破解</strong> 。</p> <p>而 ECDHE 算法在每次握手时都会生成一对临时的公钥和私钥，每次通信的密钥对都是不同的，也就是 <strong>一次一密</strong>，即使黑客花大力气破解了这一次的会话密钥，也只是这次通信被攻击，之前的历史消息不会受到影响，仍然是安全的。</p> <p>所以现在主流的服务器和浏览器在握手阶段都已经不再使用 RSA，改用 ECDHE，而 TLS1.3 在协议里明确废除 RSA 和 DH 则在标准层面保证了 <strong>前向安全</strong> 。</p> <h2 id="提升性能"><a href="#提升性能" class="header-anchor">#</a> 提升性能</h2> <p>HTTPS 建立连接时除了要做 TCP 握手，还要做 TLS 握手，在 1.2 中会多花两个消息往返（2-RTT），可能导致几十毫秒甚至上百毫秒的延迟，在移动网络中延迟还会更严重。</p> <p>现在因为密码套件大幅度简化，也就没有必要再像以前那样走复杂的协商流程了。TLS1.3 压缩了以前的 <code>Hello</code> 协商过程，删除了 <code>Key Exchange</code> 消息，把握手时间减少到了 <code>1-RTT</code> ，效率提高了一倍。</p> <p>那么它是怎么做的呢？</p> <p>其实具体的做法还是利用了扩展。客户端在 <code>Client Hello</code> 消息里直接用 <strong>supported_groups</strong> 带上支持的曲线，比如 P-256、x25519，用 <strong>key_share</strong> 带上曲线对应的客户端公钥参数，用 <strong>signature_algorithms</strong> 带上签名算法。</p> <p>服务器收到后在这些扩展里选定一个曲线和参数，再用 <code>key_share</code> 扩展返回服务器这边的公钥参数，就实现了双方的密钥交换，后面的流程就和 1.2 基本一样了。</p> <p>我为 1.3 的握手过程画了一张图，你可以对比 1.2 看看区别在哪里。</p> <p><img src="/learn-book/assets/img/4d1df4d07dbb1c2500fc4ea69ecf7ab0.4d1df4d0.png" alt="img"></p> <p>除了标准的 <code>1-RTT</code> 握手，TLS1.3 还引入了 <code>0-RTT</code> 握手，用 <code>pre_shared_key</code> 和 <code>early_data</code> 扩展，在 TCP 连接后立即就建立安全连接发送加密消息，不过这需要有一些前提条件，今天暂且不说。</p> <h2 id="握手分析"><a href="#握手分析" class="header-anchor">#</a> 握手分析</h2> <p>目前 Nginx 等 Web 服务器都能够很好地支持 TLS1.3，但要求底层的 OpenSSL 必须是 1.1.1，而我们实验环境里用的 OpenSSL 是 1.1.0，所以暂时无法直接测试 TLS1.3。</p> <p>不过我在 Linux 上用 OpenSSL1.1.1 编译了一个支持 TLS1.3 的 Nginx，用 Wireshark 抓包存到了 GitHub 上，用它就可以分析 TLS1.3 的握手过程。</p> <p><img src="/learn-book/assets/img/7a2bc39fdbb421cf72a01e887e9156db.7a2bc39f.png" alt="img"></p> <p>在 TCP 建立连接之后，浏览器首先还是发一个 <strong>Client Hello</strong> 。</p> <p>因为 1.3 的消息兼容 1.2，所以开头的版本号、支持的密码套件和随机数（Client Random）结构都是一样的（不过这时的随机数是 32 个字节）。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Handshake Protocol: Client Hello
    Version: TLS 1.2 (0x0303)
    Random: cebeb6c05403654d66c2329…
    Cipher Suites (18 suites)
        Cipher Suite: TLS_AES_128_GCM_SHA256 (0x1301)
        Cipher Suite: TLS_CHACHA20_POLY1305_SHA256 (0x1303)
        Cipher Suite: TLS_AES_256_GCM_SHA384 (0x1302)
    Extension: supported_versions (len=9)
        Supported Version: TLS 1.3 (0x0304)
        Supported Version: TLS 1.2 (0x0303)
    Extension: supported_groups (len=14)
        Supported Groups (6 groups)
            Supported Group: x25519 (0x001d)
            Supported Group: secp256r1 (0x0017)
    Extension: key_share (len=107)
        Key Share extension
            Client Key Share Length: 105
            Key Share Entry: Group: x25519
            Key Share Entry: Group: secp256r1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>注意 <code>Client Hello</code> 里的扩展，<strong>supported_versions</strong> 表示这是 TLS1.3，<strong>supported_groups</strong> 是支持的曲线，<strong>key_share</strong> 是曲线对应的参数。</p> <p>这就好像是说：</p> <p>还是照老规矩打招呼，这边有这些这些信息。但我猜你可能会升级，所以再多给你一些东西，也许后面用的上，咱们有话尽量一口气说完。</p> <p>服务器收到 <code>Client Hello</code> 同样返回 <code>Server Hello</code> 消息，还是要给出一个 <strong>随机数</strong>（Server Random）和选定密码套件。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Handshake Protocol: Server Hello
    Version: TLS 1.2 (0x0303)
    Random: 12d2bce6568b063d3dee2…
    Cipher Suite: TLS_AES_128_GCM_SHA256 (0x1301)
    Extension: supported_versions (len=2)
        Supported Version: TLS 1.3 (0x0304)
    Extension: key_share (len=36)
        Key Share extension
            Key Share Entry: Group: x25519, Key Exchange length: 32

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>表面上看和 TLS1.2 是一样的，重点是后面的扩展。<strong>supported_versions</strong> 里确认使用的是 TLS1.3，然后在 <strong>key_share</strong> 扩展带上曲线和对应的公钥参数。</p> <p>服务器的 <code>Hello</code> 消息大概是这个意思：</p> <p>还真让你给猜对了，虽然还是按老规矩打招呼，但咱们来个‘旧瓶装新酒’。刚才你给的我都用上了，我再给几个你缺的参数，这次加密就这么定了。</p> <p>这时只交换了两条消息，客户端和服务器就拿到了四个共享信息：<strong>Client Random</strong> 和 <strong>Server Random</strong> 、<strong>Client Params</strong> 和 <strong>Server Params</strong> ，两边就可以各自用 ECDHE 算出 <strong>Pre-Master</strong> ，再用 HKDF 生成主密钥 <strong>Master Secret</strong> ，效率比 TLS1.2 提高了一大截。</p> <p>在算出主密钥后，服务器立刻发出 <strong>Change Cipher Spec</strong> 消息，比 TLS1.2 提早进入加密通信，后面的证书等就都是加密的了，减少了握手时的明文信息泄露。</p> <p>这里 TLS1.3 还有一个安全强化措施，多了个 <strong>Certificate Verify</strong> 消息，用服务器的私钥把前面的曲线、套件、参数等握手数据加了签名，作用和 <strong>Finished</strong> 消息差不多。但由于是私钥签名，所以强化了身份认证和和防窜改。</p> <p>这两个 <code>Hello</code> 消息之后，客户端验证服务器证书，再发 <code>Finished</code> 消息，就正式完成了握手，开始收发 HTTP 报文。</p> <p>虽然我们的实验环境暂时不能抓包测试 TLS1.3，但互联网上很多网站都已经支持了 TLS1.3，比如<a href="https://www.nginx.com/" target="_blank" rel="noopener noreferrer">Nginx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://github.com/" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，你可以课后自己用 Wireshark 试试。</p> <p>在 Chrome 的开发者工具里，可以看到这些网站的 TLS1.3 应用情况。</p> <p><img src="/learn-book/assets/img/44d8c3349ffdea5a1e4e13d222bc743c.44d8c334.png" alt="img"></p> <h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <p>今天我们一起学习了 TLS1.3 的新特性，用抓包研究了它的握手过程，不过 TLS1.3 里的内容很多，还有一些特性没有谈到，后面会继续讲。</p> <ol><li>为了兼容 1.1、1.2 等“老”协议，TLS1.3 会“伪装”成 TLS1.2，新特性在“扩展”里实现；</li> <li>1.1、1.2 在实践中发现了很多安全隐患，所以 TLS1.3 大幅度删减了加密算法，只保留了 ECDHE、AES、ChaCha20、SHA-2 等极少数算法，强化了安全；</li> <li>TLS1.3 也简化了握手过程，完全握手只需要一个消息往返，提升了性能。</li></ol> <h2 id="课下作业"><a href="#课下作业" class="header-anchor">#</a> 课下作业</h2> <ol><li><p>TLS1.3 里的密码套件没有指定密钥交换算法和签名算法，那么在握手的时候会不会有问题呢？</p> <p>TLS1.3 精简了加密算法，通过 support_groups、key_share、signature_algorithms 这些参数就能判断出密钥交换算法和签名算法，不用在 cipher suite 中协商了</p></li> <li><p>结合上一讲的 RSA 握手过程，解释一下为什么 RSA 密钥交换不具有 <strong>前向安全</strong>。</p> <p>RSA 握手时，client key exchage 会使用 RSA 公钥加密 pre master 后传给服务端，一旦私钥被破解，那么之前的信息都会被破译，根本原因还是在于 RSA 的这一对公钥私钥并不是临时的</p></li> <li><p>TLS1.3 的握手过程与 TLS1.2 的 False Start 有什么异同？</p> <p>相同点：都在未收到 Finished 确认消息时就已经向对方发送加密信息了，不同点：TLS1.3 将 change cipher spec 合并到了 hello 中</p></li></ol> <h2 id="拓展阅读"><a href="#拓展阅读" class="header-anchor">#</a> 拓展阅读</h2> <ul><li>对 TLS12 已知的攻击有 BEAST、 BREACH、CRME、 FREAK、 LUCKY13、 POODLE、ROBOT 等</li> <li>虽然 TLS1.3 到今天刚满一岁，但由于有之前多个草案的实践，各大浏览器和服务器基本都
已经实现了支持，整个互联网也正在快速向 TLS1.3 迁移。</li> <li>关于前向安全最著名的案例就是斯诺登于 2013 年爆出的棱镜计划</li> <li>在 TLS1.3 的 RFC 文档里已经删除了 <code>Change Cipher Spec</code> 子协议，但用 Wireshark 抓包
却还能看到，这里以抓包为准</li> <li>TLS1.3 还提供了降级保护机制，如果 「中间人」恶意降级到 1.2，服务器的随机数最后 8 个字节会被设置为 <code>44 4F 57 4E 47 52 44 01</code>，即 <code>DOWNGRD01</code>，支持 TLS1.3 的客户端就可以检查发现被降级，然后发出警报终止连接</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这一章节，其实从上一章节开始，笔者就已经不太能看懂了，只当讲了个故事，知道 TSL1.3 进行了优化，安全方面更强悍了...</p></div> <iframe height="500px" width="100%" frameborder="0" allowfullscreen="allowfullscreen" src="/learn-book/ads.html"></iframe></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/abc0721/learn-book/edit/main/docs/http-protocol/05/05.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022-07-21 21:38:52</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/learn-book/http-protocol/05/04.html" class="prev">
        04 | 信任始于握手: TLS 1.2 连接过程解析
      </a></span> <span class="next"><a href="/learn-book/http-protocol/05/06.html">
        06 | 连接太慢该怎么办 HTTPS 的优化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/learn-book/assets/js/app.028ed7df.js" defer></script><script src="/learn-book/assets/js/2.21223788.js" defer></script><script src="/learn-book/assets/js/59.2bd7f911.js" defer></script><script src="/learn-book/assets/js/83.ec5af474.js" defer></script>
  </body>
</html>
