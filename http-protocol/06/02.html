<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>02 | 时代之风：HTTP/2 内核剖析 | LEARN-BOOK</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/learn-book/favicon.ico">
    <link rel="manifest" href="/learn-book/manifest.json">
    <meta name="description" content="note-book 的第二分仓笔记仓库">
    
    <link rel="preload" href="/learn-book/assets/css/0.styles.d1598957.css" as="style"><link rel="preload" href="/learn-book/assets/js/app.028ed7df.js" as="script"><link rel="preload" href="/learn-book/assets/js/2.21223788.js" as="script"><link rel="preload" href="/learn-book/assets/js/6.41833f8f.js" as="script"><link rel="preload" href="/learn-book/assets/js/83.ec5af474.js" as="script"><link rel="prefetch" href="/learn-book/assets/js/10.ae9ef0d5.js"><link rel="prefetch" href="/learn-book/assets/js/100.e2686a94.js"><link rel="prefetch" href="/learn-book/assets/js/101.1e48f558.js"><link rel="prefetch" href="/learn-book/assets/js/102.2b0aead0.js"><link rel="prefetch" href="/learn-book/assets/js/103.36a9d0c5.js"><link rel="prefetch" href="/learn-book/assets/js/104.940c0889.js"><link rel="prefetch" href="/learn-book/assets/js/105.4059f322.js"><link rel="prefetch" href="/learn-book/assets/js/106.258dd171.js"><link rel="prefetch" href="/learn-book/assets/js/107.dc32950f.js"><link rel="prefetch" href="/learn-book/assets/js/108.f96a8dee.js"><link rel="prefetch" href="/learn-book/assets/js/109.ba4b933c.js"><link rel="prefetch" href="/learn-book/assets/js/11.a08a42ea.js"><link rel="prefetch" href="/learn-book/assets/js/110.3035f734.js"><link rel="prefetch" href="/learn-book/assets/js/111.fa05b698.js"><link rel="prefetch" href="/learn-book/assets/js/112.bbb150f0.js"><link rel="prefetch" href="/learn-book/assets/js/113.1263dcc6.js"><link rel="prefetch" href="/learn-book/assets/js/114.82285aec.js"><link rel="prefetch" href="/learn-book/assets/js/115.7509736a.js"><link rel="prefetch" href="/learn-book/assets/js/116.f57394f2.js"><link rel="prefetch" href="/learn-book/assets/js/117.9f37dd43.js"><link rel="prefetch" href="/learn-book/assets/js/118.73b62d5e.js"><link rel="prefetch" href="/learn-book/assets/js/119.ccc80315.js"><link rel="prefetch" href="/learn-book/assets/js/12.40792829.js"><link rel="prefetch" href="/learn-book/assets/js/120.0feeb1b4.js"><link rel="prefetch" href="/learn-book/assets/js/121.7bbdbedc.js"><link rel="prefetch" href="/learn-book/assets/js/122.f239e92d.js"><link rel="prefetch" href="/learn-book/assets/js/123.430e5350.js"><link rel="prefetch" href="/learn-book/assets/js/124.4a74a756.js"><link rel="prefetch" href="/learn-book/assets/js/125.9d441c34.js"><link rel="prefetch" href="/learn-book/assets/js/126.97b348bf.js"><link rel="prefetch" href="/learn-book/assets/js/127.85743ce6.js"><link rel="prefetch" href="/learn-book/assets/js/128.133b2151.js"><link rel="prefetch" href="/learn-book/assets/js/129.91eacdb7.js"><link rel="prefetch" href="/learn-book/assets/js/13.65102ef7.js"><link rel="prefetch" href="/learn-book/assets/js/130.00470fe8.js"><link rel="prefetch" href="/learn-book/assets/js/131.181aef24.js"><link rel="prefetch" href="/learn-book/assets/js/132.4166cdea.js"><link rel="prefetch" href="/learn-book/assets/js/133.ec5b9acc.js"><link rel="prefetch" href="/learn-book/assets/js/134.0c928687.js"><link rel="prefetch" href="/learn-book/assets/js/135.0b49f1c2.js"><link rel="prefetch" href="/learn-book/assets/js/136.be67ae82.js"><link rel="prefetch" href="/learn-book/assets/js/137.6f85ad05.js"><link rel="prefetch" href="/learn-book/assets/js/138.b3fa2ba7.js"><link rel="prefetch" href="/learn-book/assets/js/139.abf8672e.js"><link rel="prefetch" href="/learn-book/assets/js/14.4813a349.js"><link rel="prefetch" href="/learn-book/assets/js/140.d03ed1c1.js"><link rel="prefetch" href="/learn-book/assets/js/141.da6ec0e4.js"><link rel="prefetch" href="/learn-book/assets/js/142.09aed130.js"><link rel="prefetch" href="/learn-book/assets/js/143.4cffc3e5.js"><link rel="prefetch" href="/learn-book/assets/js/144.224499c6.js"><link rel="prefetch" href="/learn-book/assets/js/145.0268dd0e.js"><link rel="prefetch" href="/learn-book/assets/js/146.f0d0970e.js"><link rel="prefetch" href="/learn-book/assets/js/147.4a203a56.js"><link rel="prefetch" href="/learn-book/assets/js/148.3b084bf3.js"><link rel="prefetch" href="/learn-book/assets/js/149.d42b82bd.js"><link rel="prefetch" href="/learn-book/assets/js/15.ca243d77.js"><link rel="prefetch" href="/learn-book/assets/js/150.30cad9c9.js"><link rel="prefetch" href="/learn-book/assets/js/151.a27ba2c5.js"><link rel="prefetch" href="/learn-book/assets/js/152.8e388b90.js"><link rel="prefetch" href="/learn-book/assets/js/153.380f332c.js"><link rel="prefetch" href="/learn-book/assets/js/154.163b241b.js"><link rel="prefetch" href="/learn-book/assets/js/155.dacd37a6.js"><link rel="prefetch" href="/learn-book/assets/js/156.9296f4c8.js"><link rel="prefetch" href="/learn-book/assets/js/157.0c12b4ce.js"><link rel="prefetch" href="/learn-book/assets/js/158.79e7656c.js"><link rel="prefetch" href="/learn-book/assets/js/159.02749d11.js"><link rel="prefetch" href="/learn-book/assets/js/16.22ac0778.js"><link rel="prefetch" href="/learn-book/assets/js/160.3efbd6a0.js"><link rel="prefetch" href="/learn-book/assets/js/161.11e17eb7.js"><link rel="prefetch" href="/learn-book/assets/js/162.ed81bb49.js"><link rel="prefetch" href="/learn-book/assets/js/163.c321ec8d.js"><link rel="prefetch" href="/learn-book/assets/js/164.6831a594.js"><link rel="prefetch" href="/learn-book/assets/js/165.9e13a7e1.js"><link rel="prefetch" href="/learn-book/assets/js/166.20287335.js"><link rel="prefetch" href="/learn-book/assets/js/167.06fe0883.js"><link rel="prefetch" href="/learn-book/assets/js/168.574a5d34.js"><link rel="prefetch" href="/learn-book/assets/js/169.78d54345.js"><link rel="prefetch" href="/learn-book/assets/js/17.467198e5.js"><link rel="prefetch" href="/learn-book/assets/js/170.a8a8c838.js"><link rel="prefetch" href="/learn-book/assets/js/171.bce5528f.js"><link rel="prefetch" href="/learn-book/assets/js/172.6d122eaf.js"><link rel="prefetch" href="/learn-book/assets/js/173.b7b1734b.js"><link rel="prefetch" href="/learn-book/assets/js/174.0c5ddece.js"><link rel="prefetch" href="/learn-book/assets/js/175.fcb3bb1e.js"><link rel="prefetch" href="/learn-book/assets/js/176.4c8b6c1b.js"><link rel="prefetch" href="/learn-book/assets/js/177.2c821a10.js"><link rel="prefetch" href="/learn-book/assets/js/178.4b938acb.js"><link rel="prefetch" href="/learn-book/assets/js/179.e5a3f9d5.js"><link rel="prefetch" href="/learn-book/assets/js/18.2c2655d3.js"><link rel="prefetch" href="/learn-book/assets/js/180.e075e24a.js"><link rel="prefetch" href="/learn-book/assets/js/181.a8659308.js"><link rel="prefetch" href="/learn-book/assets/js/182.e02e157b.js"><link rel="prefetch" href="/learn-book/assets/js/183.fec3be72.js"><link rel="prefetch" href="/learn-book/assets/js/184.06841422.js"><link rel="prefetch" href="/learn-book/assets/js/185.967d47f7.js"><link rel="prefetch" href="/learn-book/assets/js/186.b27543eb.js"><link rel="prefetch" href="/learn-book/assets/js/187.0ab43110.js"><link rel="prefetch" href="/learn-book/assets/js/188.d2c20c41.js"><link rel="prefetch" href="/learn-book/assets/js/189.e50ac920.js"><link rel="prefetch" href="/learn-book/assets/js/19.87356261.js"><link rel="prefetch" href="/learn-book/assets/js/190.0bcce66f.js"><link rel="prefetch" href="/learn-book/assets/js/191.1a3d3266.js"><link rel="prefetch" href="/learn-book/assets/js/192.b46f1f92.js"><link rel="prefetch" href="/learn-book/assets/js/193.7cd9a2e2.js"><link rel="prefetch" href="/learn-book/assets/js/194.c7cac8f4.js"><link rel="prefetch" href="/learn-book/assets/js/195.76b36b43.js"><link rel="prefetch" href="/learn-book/assets/js/196.9ad5f9de.js"><link rel="prefetch" href="/learn-book/assets/js/197.2914f34f.js"><link rel="prefetch" href="/learn-book/assets/js/198.2e2c2c64.js"><link rel="prefetch" href="/learn-book/assets/js/199.0d8fc29e.js"><link rel="prefetch" href="/learn-book/assets/js/20.8693e977.js"><link rel="prefetch" href="/learn-book/assets/js/200.2bc59ffe.js"><link rel="prefetch" href="/learn-book/assets/js/201.6765dba2.js"><link rel="prefetch" href="/learn-book/assets/js/202.d19062c8.js"><link rel="prefetch" href="/learn-book/assets/js/203.270e8e72.js"><link rel="prefetch" href="/learn-book/assets/js/204.0ecf2cd8.js"><link rel="prefetch" href="/learn-book/assets/js/205.b241dd2b.js"><link rel="prefetch" href="/learn-book/assets/js/206.3d555da2.js"><link rel="prefetch" href="/learn-book/assets/js/207.b88d10dc.js"><link rel="prefetch" href="/learn-book/assets/js/208.d15b9895.js"><link rel="prefetch" href="/learn-book/assets/js/209.404964dd.js"><link rel="prefetch" href="/learn-book/assets/js/21.ce55ac2d.js"><link rel="prefetch" href="/learn-book/assets/js/210.8a6ad39b.js"><link rel="prefetch" href="/learn-book/assets/js/211.9f828903.js"><link rel="prefetch" href="/learn-book/assets/js/212.ecdb6c3d.js"><link rel="prefetch" href="/learn-book/assets/js/213.093b4b7f.js"><link rel="prefetch" href="/learn-book/assets/js/214.17e91916.js"><link rel="prefetch" href="/learn-book/assets/js/215.8f7b103b.js"><link rel="prefetch" href="/learn-book/assets/js/216.5a4cb55c.js"><link rel="prefetch" href="/learn-book/assets/js/217.850e8745.js"><link rel="prefetch" href="/learn-book/assets/js/218.b8913e63.js"><link rel="prefetch" href="/learn-book/assets/js/219.3260d54b.js"><link rel="prefetch" href="/learn-book/assets/js/22.2a565240.js"><link rel="prefetch" href="/learn-book/assets/js/220.6e440719.js"><link rel="prefetch" href="/learn-book/assets/js/221.ed0a4a3e.js"><link rel="prefetch" href="/learn-book/assets/js/222.ab1bbc7e.js"><link rel="prefetch" href="/learn-book/assets/js/223.b8d3fbb0.js"><link rel="prefetch" href="/learn-book/assets/js/224.eba39f96.js"><link rel="prefetch" href="/learn-book/assets/js/225.ba57ac7b.js"><link rel="prefetch" href="/learn-book/assets/js/226.760b4caf.js"><link rel="prefetch" href="/learn-book/assets/js/227.ff81b1ba.js"><link rel="prefetch" href="/learn-book/assets/js/228.15305fd8.js"><link rel="prefetch" href="/learn-book/assets/js/229.b1f93d41.js"><link rel="prefetch" href="/learn-book/assets/js/23.e4419686.js"><link rel="prefetch" href="/learn-book/assets/js/230.982e5c6c.js"><link rel="prefetch" href="/learn-book/assets/js/231.8ac0560e.js"><link rel="prefetch" href="/learn-book/assets/js/232.32eb3205.js"><link rel="prefetch" href="/learn-book/assets/js/233.cb14ad35.js"><link rel="prefetch" href="/learn-book/assets/js/234.0e3fb631.js"><link rel="prefetch" href="/learn-book/assets/js/235.1d7db823.js"><link rel="prefetch" href="/learn-book/assets/js/236.56df2b30.js"><link rel="prefetch" href="/learn-book/assets/js/237.56902777.js"><link rel="prefetch" href="/learn-book/assets/js/238.077f8961.js"><link rel="prefetch" href="/learn-book/assets/js/239.836f2633.js"><link rel="prefetch" href="/learn-book/assets/js/24.4ef60a35.js"><link rel="prefetch" href="/learn-book/assets/js/240.1958dc97.js"><link rel="prefetch" href="/learn-book/assets/js/241.628723f2.js"><link rel="prefetch" href="/learn-book/assets/js/242.80a9054d.js"><link rel="prefetch" href="/learn-book/assets/js/243.59d79e44.js"><link rel="prefetch" href="/learn-book/assets/js/244.d3442a00.js"><link rel="prefetch" href="/learn-book/assets/js/245.df290ae1.js"><link rel="prefetch" href="/learn-book/assets/js/246.bb4eb062.js"><link rel="prefetch" href="/learn-book/assets/js/247.c1cbe04d.js"><link rel="prefetch" href="/learn-book/assets/js/248.920787b0.js"><link rel="prefetch" href="/learn-book/assets/js/249.7ab19c67.js"><link rel="prefetch" href="/learn-book/assets/js/25.2b3311b7.js"><link rel="prefetch" href="/learn-book/assets/js/250.eacfb6a8.js"><link rel="prefetch" href="/learn-book/assets/js/251.44eb2a6b.js"><link rel="prefetch" href="/learn-book/assets/js/252.5af941db.js"><link rel="prefetch" href="/learn-book/assets/js/253.1d016c96.js"><link rel="prefetch" href="/learn-book/assets/js/254.3a6ec810.js"><link rel="prefetch" href="/learn-book/assets/js/255.77db8369.js"><link rel="prefetch" href="/learn-book/assets/js/256.a7b36739.js"><link rel="prefetch" href="/learn-book/assets/js/257.cffe71a4.js"><link rel="prefetch" href="/learn-book/assets/js/258.fdb4c219.js"><link rel="prefetch" href="/learn-book/assets/js/259.455a0c8b.js"><link rel="prefetch" href="/learn-book/assets/js/26.70973cf8.js"><link rel="prefetch" href="/learn-book/assets/js/260.f7d47a3e.js"><link rel="prefetch" href="/learn-book/assets/js/261.b1e2a5bf.js"><link rel="prefetch" href="/learn-book/assets/js/262.aaa755c2.js"><link rel="prefetch" href="/learn-book/assets/js/263.e838a513.js"><link rel="prefetch" href="/learn-book/assets/js/264.b8733c83.js"><link rel="prefetch" href="/learn-book/assets/js/265.c5fdd3c5.js"><link rel="prefetch" href="/learn-book/assets/js/266.e8d01769.js"><link rel="prefetch" href="/learn-book/assets/js/267.c9742e28.js"><link rel="prefetch" href="/learn-book/assets/js/268.2b148bef.js"><link rel="prefetch" href="/learn-book/assets/js/269.e03565b0.js"><link rel="prefetch" href="/learn-book/assets/js/27.8106f1e9.js"><link rel="prefetch" href="/learn-book/assets/js/270.65b5d908.js"><link rel="prefetch" href="/learn-book/assets/js/271.fbde0cac.js"><link rel="prefetch" href="/learn-book/assets/js/272.03745530.js"><link rel="prefetch" href="/learn-book/assets/js/273.8785fc29.js"><link rel="prefetch" href="/learn-book/assets/js/274.0ff015ae.js"><link rel="prefetch" href="/learn-book/assets/js/275.4fe4ba23.js"><link rel="prefetch" href="/learn-book/assets/js/276.26d537d4.js"><link rel="prefetch" href="/learn-book/assets/js/277.d95836c7.js"><link rel="prefetch" href="/learn-book/assets/js/278.eb312d49.js"><link rel="prefetch" href="/learn-book/assets/js/279.d0ce3bfd.js"><link rel="prefetch" href="/learn-book/assets/js/28.b3ebf8e6.js"><link rel="prefetch" href="/learn-book/assets/js/280.0c7ddd76.js"><link rel="prefetch" href="/learn-book/assets/js/281.94b40ca5.js"><link rel="prefetch" href="/learn-book/assets/js/282.4f902cb2.js"><link rel="prefetch" href="/learn-book/assets/js/283.834f65b2.js"><link rel="prefetch" href="/learn-book/assets/js/284.283c48cf.js"><link rel="prefetch" href="/learn-book/assets/js/285.4c68b9f5.js"><link rel="prefetch" href="/learn-book/assets/js/286.c34e142a.js"><link rel="prefetch" href="/learn-book/assets/js/287.b6713fe5.js"><link rel="prefetch" href="/learn-book/assets/js/288.cac84ba9.js"><link rel="prefetch" href="/learn-book/assets/js/289.9a6f3ebc.js"><link rel="prefetch" href="/learn-book/assets/js/29.e196143d.js"><link rel="prefetch" href="/learn-book/assets/js/290.fe2f74e5.js"><link rel="prefetch" href="/learn-book/assets/js/291.23dc1b91.js"><link rel="prefetch" href="/learn-book/assets/js/292.80606528.js"><link rel="prefetch" href="/learn-book/assets/js/293.aa013666.js"><link rel="prefetch" href="/learn-book/assets/js/294.0dee2576.js"><link rel="prefetch" href="/learn-book/assets/js/295.c731059a.js"><link rel="prefetch" href="/learn-book/assets/js/296.b226f176.js"><link rel="prefetch" href="/learn-book/assets/js/297.69f8e024.js"><link rel="prefetch" href="/learn-book/assets/js/298.8d2da06c.js"><link rel="prefetch" href="/learn-book/assets/js/299.e168b956.js"><link rel="prefetch" href="/learn-book/assets/js/3.e9334214.js"><link rel="prefetch" href="/learn-book/assets/js/30.0f44a043.js"><link rel="prefetch" href="/learn-book/assets/js/300.335941ee.js"><link rel="prefetch" href="/learn-book/assets/js/301.4bab8322.js"><link rel="prefetch" href="/learn-book/assets/js/302.2f5148b0.js"><link rel="prefetch" href="/learn-book/assets/js/303.2e8d30f0.js"><link rel="prefetch" href="/learn-book/assets/js/304.f0e9bbb8.js"><link rel="prefetch" href="/learn-book/assets/js/305.80fc4688.js"><link rel="prefetch" href="/learn-book/assets/js/306.f554b95c.js"><link rel="prefetch" href="/learn-book/assets/js/307.03aa7e5b.js"><link rel="prefetch" href="/learn-book/assets/js/308.af120a3e.js"><link rel="prefetch" href="/learn-book/assets/js/309.af606132.js"><link rel="prefetch" href="/learn-book/assets/js/31.00dd7380.js"><link rel="prefetch" href="/learn-book/assets/js/310.47599795.js"><link rel="prefetch" href="/learn-book/assets/js/311.00539011.js"><link rel="prefetch" href="/learn-book/assets/js/312.fbc57673.js"><link rel="prefetch" href="/learn-book/assets/js/313.8e8daad4.js"><link rel="prefetch" href="/learn-book/assets/js/314.268dcf0e.js"><link rel="prefetch" href="/learn-book/assets/js/315.aabe7e52.js"><link rel="prefetch" href="/learn-book/assets/js/316.faa4e876.js"><link rel="prefetch" href="/learn-book/assets/js/317.d802eb3f.js"><link rel="prefetch" href="/learn-book/assets/js/318.c262b463.js"><link rel="prefetch" href="/learn-book/assets/js/319.24a8ff4d.js"><link rel="prefetch" href="/learn-book/assets/js/32.7c34bc5e.js"><link rel="prefetch" href="/learn-book/assets/js/320.9c7cda5a.js"><link rel="prefetch" href="/learn-book/assets/js/321.23b9a0be.js"><link rel="prefetch" href="/learn-book/assets/js/322.ad972338.js"><link rel="prefetch" href="/learn-book/assets/js/323.07f13ace.js"><link rel="prefetch" href="/learn-book/assets/js/324.18b8d5ae.js"><link rel="prefetch" href="/learn-book/assets/js/325.f01bde16.js"><link rel="prefetch" href="/learn-book/assets/js/326.629c1072.js"><link rel="prefetch" href="/learn-book/assets/js/327.39e6c9e2.js"><link rel="prefetch" href="/learn-book/assets/js/328.c699721e.js"><link rel="prefetch" href="/learn-book/assets/js/329.b54ab0db.js"><link rel="prefetch" href="/learn-book/assets/js/33.2386fa0f.js"><link rel="prefetch" href="/learn-book/assets/js/330.79e7cbcf.js"><link rel="prefetch" href="/learn-book/assets/js/331.377fadf6.js"><link rel="prefetch" href="/learn-book/assets/js/332.63cd94c2.js"><link rel="prefetch" href="/learn-book/assets/js/333.da52ece6.js"><link rel="prefetch" href="/learn-book/assets/js/334.5f196b50.js"><link rel="prefetch" href="/learn-book/assets/js/335.97b4ef4c.js"><link rel="prefetch" href="/learn-book/assets/js/336.e57f018e.js"><link rel="prefetch" href="/learn-book/assets/js/337.0a5a0859.js"><link rel="prefetch" href="/learn-book/assets/js/338.7a7f0b61.js"><link rel="prefetch" href="/learn-book/assets/js/339.7cd408bd.js"><link rel="prefetch" href="/learn-book/assets/js/34.0d02a15e.js"><link rel="prefetch" href="/learn-book/assets/js/340.04cb06e8.js"><link rel="prefetch" href="/learn-book/assets/js/341.537861d1.js"><link rel="prefetch" href="/learn-book/assets/js/342.da14f695.js"><link rel="prefetch" href="/learn-book/assets/js/343.74707d52.js"><link rel="prefetch" href="/learn-book/assets/js/344.b350096e.js"><link rel="prefetch" href="/learn-book/assets/js/345.dbf62aca.js"><link rel="prefetch" href="/learn-book/assets/js/346.3f255f50.js"><link rel="prefetch" href="/learn-book/assets/js/347.f4668b0d.js"><link rel="prefetch" href="/learn-book/assets/js/348.542573cc.js"><link rel="prefetch" href="/learn-book/assets/js/349.6888cb35.js"><link rel="prefetch" href="/learn-book/assets/js/35.74523ded.js"><link rel="prefetch" href="/learn-book/assets/js/350.cd705439.js"><link rel="prefetch" href="/learn-book/assets/js/351.093058d4.js"><link rel="prefetch" href="/learn-book/assets/js/352.77230cba.js"><link rel="prefetch" href="/learn-book/assets/js/353.8f883fac.js"><link rel="prefetch" href="/learn-book/assets/js/354.d52aee3e.js"><link rel="prefetch" href="/learn-book/assets/js/355.77a0126a.js"><link rel="prefetch" href="/learn-book/assets/js/356.dbf927e4.js"><link rel="prefetch" href="/learn-book/assets/js/357.0973baa0.js"><link rel="prefetch" href="/learn-book/assets/js/358.cac7fab3.js"><link rel="prefetch" href="/learn-book/assets/js/359.e8330d89.js"><link rel="prefetch" href="/learn-book/assets/js/36.0da2006f.js"><link rel="prefetch" href="/learn-book/assets/js/360.afef7c08.js"><link rel="prefetch" href="/learn-book/assets/js/361.6237f112.js"><link rel="prefetch" href="/learn-book/assets/js/362.34d1483e.js"><link rel="prefetch" href="/learn-book/assets/js/363.b7b45618.js"><link rel="prefetch" href="/learn-book/assets/js/364.e6d9ce62.js"><link rel="prefetch" href="/learn-book/assets/js/37.2fc83856.js"><link rel="prefetch" href="/learn-book/assets/js/38.79be50ee.js"><link rel="prefetch" href="/learn-book/assets/js/39.88a682f8.js"><link rel="prefetch" href="/learn-book/assets/js/4.0c4a4c2a.js"><link rel="prefetch" href="/learn-book/assets/js/40.e29bfa4b.js"><link rel="prefetch" href="/learn-book/assets/js/41.d4016d53.js"><link rel="prefetch" href="/learn-book/assets/js/42.c548ba43.js"><link rel="prefetch" href="/learn-book/assets/js/43.472c0c7f.js"><link rel="prefetch" href="/learn-book/assets/js/44.e0613af7.js"><link rel="prefetch" href="/learn-book/assets/js/45.e0c5b514.js"><link rel="prefetch" href="/learn-book/assets/js/46.0d833848.js"><link rel="prefetch" href="/learn-book/assets/js/47.167e51ca.js"><link rel="prefetch" href="/learn-book/assets/js/48.c55f2d7a.js"><link rel="prefetch" href="/learn-book/assets/js/49.600b0356.js"><link rel="prefetch" href="/learn-book/assets/js/5.c26035a1.js"><link rel="prefetch" href="/learn-book/assets/js/50.70947932.js"><link rel="prefetch" href="/learn-book/assets/js/51.924af1dd.js"><link rel="prefetch" href="/learn-book/assets/js/52.447da1c4.js"><link rel="prefetch" href="/learn-book/assets/js/53.b7e4c782.js"><link rel="prefetch" href="/learn-book/assets/js/54.4d31d080.js"><link rel="prefetch" href="/learn-book/assets/js/55.91a4b03c.js"><link rel="prefetch" href="/learn-book/assets/js/56.1cb7915e.js"><link rel="prefetch" href="/learn-book/assets/js/57.2affe6fc.js"><link rel="prefetch" href="/learn-book/assets/js/58.27d5c7cd.js"><link rel="prefetch" href="/learn-book/assets/js/59.2bd7f911.js"><link rel="prefetch" href="/learn-book/assets/js/60.626def20.js"><link rel="prefetch" href="/learn-book/assets/js/61.45f51e6d.js"><link rel="prefetch" href="/learn-book/assets/js/62.4bdda78c.js"><link rel="prefetch" href="/learn-book/assets/js/63.557bc394.js"><link rel="prefetch" href="/learn-book/assets/js/64.aff699bf.js"><link rel="prefetch" href="/learn-book/assets/js/65.692f7816.js"><link rel="prefetch" href="/learn-book/assets/js/66.25ecbcaa.js"><link rel="prefetch" href="/learn-book/assets/js/67.8fa8a16e.js"><link rel="prefetch" href="/learn-book/assets/js/68.92b6a3f8.js"><link rel="prefetch" href="/learn-book/assets/js/69.efff96d2.js"><link rel="prefetch" href="/learn-book/assets/js/7.8100f2ed.js"><link rel="prefetch" href="/learn-book/assets/js/70.aacd8d45.js"><link rel="prefetch" href="/learn-book/assets/js/71.97a38b91.js"><link rel="prefetch" href="/learn-book/assets/js/72.fa0bbfba.js"><link rel="prefetch" href="/learn-book/assets/js/73.7065bf44.js"><link rel="prefetch" href="/learn-book/assets/js/74.cc9e8786.js"><link rel="prefetch" href="/learn-book/assets/js/75.9853915c.js"><link rel="prefetch" href="/learn-book/assets/js/76.3bb84aff.js"><link rel="prefetch" href="/learn-book/assets/js/77.1d7faa0b.js"><link rel="prefetch" href="/learn-book/assets/js/78.82ccf15d.js"><link rel="prefetch" href="/learn-book/assets/js/79.1ca14563.js"><link rel="prefetch" href="/learn-book/assets/js/8.a6e82c65.js"><link rel="prefetch" href="/learn-book/assets/js/80.009c8d78.js"><link rel="prefetch" href="/learn-book/assets/js/81.7c70581a.js"><link rel="prefetch" href="/learn-book/assets/js/82.25fa4637.js"><link rel="prefetch" href="/learn-book/assets/js/84.9e77b512.js"><link rel="prefetch" href="/learn-book/assets/js/85.bebb4293.js"><link rel="prefetch" href="/learn-book/assets/js/86.5a6fb0e3.js"><link rel="prefetch" href="/learn-book/assets/js/87.5a748d18.js"><link rel="prefetch" href="/learn-book/assets/js/88.17a0f517.js"><link rel="prefetch" href="/learn-book/assets/js/89.22035541.js"><link rel="prefetch" href="/learn-book/assets/js/9.5a3b25cd.js"><link rel="prefetch" href="/learn-book/assets/js/90.3222c7da.js"><link rel="prefetch" href="/learn-book/assets/js/91.4b34da5a.js"><link rel="prefetch" href="/learn-book/assets/js/92.9739a603.js"><link rel="prefetch" href="/learn-book/assets/js/93.38329abe.js"><link rel="prefetch" href="/learn-book/assets/js/94.52432e65.js"><link rel="prefetch" href="/learn-book/assets/js/95.363db7ac.js"><link rel="prefetch" href="/learn-book/assets/js/96.f5e07454.js"><link rel="prefetch" href="/learn-book/assets/js/97.76268626.js"><link rel="prefetch" href="/learn-book/assets/js/98.34e210bb.js"><link rel="prefetch" href="/learn-book/assets/js/99.d3018ce2.js">
    <link rel="stylesheet" href="/learn-book/assets/css/0.styles.d1598957.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-book/" class="home-link router-link-active"><img src="/learn-book/mlogo.svg" alt="LEARN-BOOK" class="logo"> <span class="site-name can-hide">LEARN-BOOK</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow down"></span></button> <button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="mobile-dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          综合性导航
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/" class="nav-link">
  全目录导航
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/001-introduce.html" class="nav-link">
  第一版（001 ~ 123 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/124.html" class="nav-link">
  第二版（124 ~ 195 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/121.html" class="nav-link">
  课程总结（难题与解决方案）
</a></li></ul></li><li class="dropdown-item"><h4>
          精彩知识精选
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/redis/007.html" class="nav-link">
  Redis 篇（redis 企业级集群架构）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/035.html" class="nav-link">
  多级缓存架构设计
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/040.html" class="nav-link">
  数据库 + 缓存双写一致性解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/045.html" class="nav-link">
  缓存维度化拆分解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/051.html" class="nav-link">
  缓存命中率提升解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/057.html" class="nav-link">
  缓存并发重建冲突解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/069.html" class="nav-link">
  缓存预热解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/077.html" class="nav-link">
  热点缓存自动降级方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/110.html" class="nav-link">
  缓存雪崩解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/117.html" class="nav-link">
  缓存穿透解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/119.html" class="nav-link">
  缓存失效解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/hystrix/084.html" class="nav-link">
  高可用分布式系统架构设计（hystrix 篇）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/047.html" class="nav-link">
  spring boot 整合 ehcache
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/storm/062.html" class="nav-link">
  史上最通俗易懂 Storm 教程
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程目录" class="dropdown-title"><span class="title">课程目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程目录" class="mobile-dropdown-title"><span class="title">课程目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn-book/monitor-tuning/" class="nav-link">
  JAVA 生产环境下性能监控与调优详解
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/http-protocol/" class="nav-link router-link-active">
  透视 HTTP 协议
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/ddd/" class="nav-link">
  DDD 实战课
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/middle-office/" class="nav-link">
  说透中台
</a></li><li class="dropdown-item"><h4>
          设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/imocc/design_pattern/" class="nav-link">
  设计模式（慕课）
</a></li><li class="dropdown-subitem"><a href="/learn-book/design_pattern/" class="nav-link">
  研磨设计模式（李兴华）
</a></li></ul></li></ul></div></div> <a href="https://github.com/abc0721/learn-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow down"></span></button> <button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="mobile-dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          综合性导航
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/" class="nav-link">
  全目录导航
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/001-introduce.html" class="nav-link">
  第一版（001 ~ 123 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/124.html" class="nav-link">
  第二版（124 ~ 195 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/121.html" class="nav-link">
  课程总结（难题与解决方案）
</a></li></ul></li><li class="dropdown-item"><h4>
          精彩知识精选
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/redis/007.html" class="nav-link">
  Redis 篇（redis 企业级集群架构）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/035.html" class="nav-link">
  多级缓存架构设计
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/040.html" class="nav-link">
  数据库 + 缓存双写一致性解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/045.html" class="nav-link">
  缓存维度化拆分解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/051.html" class="nav-link">
  缓存命中率提升解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/057.html" class="nav-link">
  缓存并发重建冲突解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/069.html" class="nav-link">
  缓存预热解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/077.html" class="nav-link">
  热点缓存自动降级方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/110.html" class="nav-link">
  缓存雪崩解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/117.html" class="nav-link">
  缓存穿透解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/119.html" class="nav-link">
  缓存失效解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/hystrix/084.html" class="nav-link">
  高可用分布式系统架构设计（hystrix 篇）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/047.html" class="nav-link">
  spring boot 整合 ehcache
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/storm/062.html" class="nav-link">
  史上最通俗易懂 Storm 教程
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程目录" class="dropdown-title"><span class="title">课程目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程目录" class="mobile-dropdown-title"><span class="title">课程目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn-book/monitor-tuning/" class="nav-link">
  JAVA 生产环境下性能监控与调优详解
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/http-protocol/" class="nav-link router-link-active">
  透视 HTTP 协议
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/ddd/" class="nav-link">
  DDD 实战课
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/middle-office/" class="nav-link">
  说透中台
</a></li><li class="dropdown-item"><h4>
          设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/imocc/design_pattern/" class="nav-link">
  设计模式（慕课）
</a></li><li class="dropdown-subitem"><a href="/learn-book/design_pattern/" class="nav-link">
  研磨设计模式（李兴华）
</a></li></ul></li></ul></div></div> <a href="https://github.com/abc0721/learn-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/learn-book/http-protocol/" aria-current="page" class="sidebar-link">透视 HTTP 协议</a></li><li><a href="/learn-book/http-protocol/01/" class="sidebar-link">01 | 开篇: To Be a HTTP Hero</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/http-protocol/02/" class="sidebar-heading clickable"><span>02 | 破冰篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/http-protocol/03/" class="sidebar-heading clickable"><span>03 | 基础篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/http-protocol/04/" class="sidebar-heading clickable"><span>04 | 进阶篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/http-protocol/05/" class="sidebar-heading clickable"><span>05 | 安全篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/http-protocol/06/" class="sidebar-heading clickable router-link-active open"><span>06 | 飞翔篇</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-book/http-protocol/06/01.html" class="sidebar-link">01 | 时代之风：HTTP/2 特性概览</a></li><li><a href="/learn-book/http-protocol/06/02.html" aria-current="page" class="active sidebar-link">02 | 时代之风：HTTP/2 内核剖析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/06/02.html#连接前言" class="sidebar-link">连接前言</a></li><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/06/02.html#头部压缩" class="sidebar-link">头部压缩</a></li><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/06/02.html#二进制帧" class="sidebar-link">二进制帧</a></li><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/06/02.html#流与多路复用" class="sidebar-link">流与多路复用</a></li><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/06/02.html#流状态转换" class="sidebar-link">流状态转换</a></li><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/06/02.html#小结" class="sidebar-link">小结</a></li><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/06/02.html#课下作业" class="sidebar-link">课下作业</a></li><li class="sidebar-sub-header"><a href="/learn-book/http-protocol/06/02.html#拓展阅读" class="sidebar-link">拓展阅读</a></li></ul></li><li><a href="/learn-book/http-protocol/06/03.html" class="sidebar-link">03 | 未来之路：HTTP/3 展望</a></li><li><a href="/learn-book/http-protocol/06/04.html" class="sidebar-link">04 | 我应该迁移到 HTTP/2 吗？</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/http-protocol/07/" class="sidebar-heading clickable"><span>07 | 探索篇</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/learn-book/http-protocol/08/" class="sidebar-link">08 | 总结篇: HTTP 性能优化面面观</a></li><li><a href="/learn-book/http-protocol/09.html" class="sidebar-link">参考资源</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_02-时代之风-http-2-内核剖析"><a href="#_02-时代之风-http-2-内核剖析" class="header-anchor">#</a> 02 | 时代之风：HTTP/2 内核剖析</h1> <p>今天我们继续上一讲的话题，深入 HTTP/2 协议的内部，看看它的实现细节。</p> <p><img src="/learn-book/assets/img/8903a45c632b64c220299d5bc64ef717.8903a45c.png" alt="img"></p> <p>这次实验环境的 URI 是 <code>https://www.metroid.net:8443/31-1</code> ，我用 Wireshark 把请求响应的过程抓包存了下来，文件放在 GitHub 的 <code>wireshark</code> 目录。今天我们就对照着抓包来实地讲解 HTTP/2 的头部压缩、二进制帧等特性。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>上面的链接访问异常，并且配置的 SSLKEYLOGFILE 导入后也不怎么生效，不知道是啥原因</p> <p>但是配配套的抓包日志中的 log 是有效果的，也就是上图绿色背景的是导入日志后出现的</p></div> <h2 id="连接前言"><a href="#连接前言" class="header-anchor">#</a> 连接前言</h2> <p>由于 HTTP/2 事实上是基于 TLS，所以在正式收发数据之前，会有 TCP 握手和 TLS 握手，这两个步骤相信你一定已经很熟悉了，所以这里就略过去不再细说。</p> <p>TLS 握手成功之后，客户端必须要发送一个 <strong>连接前言</strong>（connection preface），用来确认建立 HTTP/2 连接。</p> <p>这个连接前言是标准的 HTTP/1 请求报文，使用纯文本的 ASCII 码格式，请求方法是特别注册的一个关键字 <code>PRI</code> ，全文只有 24 个字节：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>PRI * HTTP/2.0\r\n\r\nSM\r\n\r\n
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在 Wireshark 里，HTTP/2 的“连接前言”被称为 <strong>Magic</strong>，意思就是不可知的魔法。</p> <p>所以，就不要问为什么会是这样了，只要服务器收到这个有魔力的字符串，就知道客户端在 TLS 上想要的是 HTTP/2 协议，而不是其他别的协议，后面就会都使用 HTTP/2 的数据格式。</p> <p><img src="/learn-book/assets/img/image-20210312192121396.5fe0ea04.png" alt="image-20210312192121396"></p> <h2 id="头部压缩"><a href="#头部压缩" class="header-anchor">#</a> 头部压缩</h2> <p>确立了连接之后，HTTP/2 就开始准备请求报文。</p> <p>因为语义上它与 HTTP/1 兼容，所以报文还是由 <code>Header+Body</code> 构成的，但在请求发送前，必须要用 <strong>HPACK</strong> 算法来压缩头部数据。</p> <p><code>HPACK</code> 算法是专门为压缩 HTTP 头部定制的算法，与 gzip、zlib 等压缩算法不同，它是一个有状态的算法，需要客户端和服务器各自维护一份索引表，也可以说是字典（这有点类似 brotli），压缩和解压缩就是查表和更新表的操作。</p> <p>为了方便管理和压缩，HTTP/2 废除了原有的起始行概念，把起始行里面的请求方法、URI、状态码等统一转换成了头字段的形式，并且给这些“不是头字段的头字段起了个特别的名字—— <strong>伪头字段</strong> （pseudo-header fields）。而起始行里的版本号和错误原因短语因为没什么大用，顺便也给废除了。</p> <p>为了与真头字段区分开来，这些伪头字段会在名字前加一个 <code>:</code> ，比如 <code>:authority</code>、<code>:method</code>、 <code>:status</code>，分别表示的是域名、请求方法和状态码。</p> <p>现在 HTTP 报文头就简单了，全都是 <code>Key-Value</code> 形式的字段，于是 HTTP/2 就为一些最常用的头字段定义了一个只读的 <strong>静态表</strong>（Static Table）。</p> <p>下面的这个表格列出了静态表的一部分，这样只要查表就可以知道字段名和对应的值，比如数字 <code>2</code> 代表 <code>GET</code> ，数字 <code>8</code> 代表状态码 200。</p> <p><img src="/learn-book/assets/img/image-20210312192422763.b6aae017.png" alt="image-20210312192422763"></p> <p>像请求方法，在里面只占用一位</p> <p><img src="/learn-book/assets/img/769dcf953ddafc4573a0b4c3f0321f0c.769dcf95.png" alt="img"></p> <p>但如果表里只有 Key 没有 Value，或者是自定义字段根本找不到该怎么办呢？</p> <p>这就要用到 <strong>动态表</strong>（Dynamic Table），它添加在静态表后面，结构相同，但会在编码解码的时候随时更新。</p> <p>比如说，第一次发送请求时的 <code>user-agent</code> 字段长是一百多个字节，用哈夫曼压缩编码发送之后，客户端和服务器都更新自己的动态表，添加一个新的索引号 <code>65</code> 。那么下一次发送的时候就不用再重复发那么多字节了，只要用一个字节发送编号就好。</p> <p><img src="/learn-book/assets/img/5fa90e123c68855140e2b40f4f73c56f.5fa90e12.png" alt="img"></p> <p><img src="/learn-book/assets/img/image-20210312192806844.11974f0b.png" alt="image-20210312192806844"></p> <p>在第二次请求的时候，的确是缓存起来了。</p> <p>你可以想象得出来，随着在 HTTP/2 连接上发送的报文越来越多，两边的字典也会越来越丰富，最终每次的头部字段都会变成一两个字节的代码，原来上千字节的头用几十个字节就可以表示了，压缩效果比 gzip 要好得多。</p> <h2 id="二进制帧"><a href="#二进制帧" class="header-anchor">#</a> 二进制帧</h2> <p>头部数据压缩之后，HTTP/2 就要把报文拆成二进制的帧准备发送。</p> <p>HTTP/2 的帧结构有点类似 TCP 的段或者 TLS 里的记录，但报头很小，只有 9 字节，非常地节省（可以对比一下 TCP 头，它最少是 20 个字节）。</p> <p>二进制的格式也保证了不会有歧义，而且使用位运算能够非常简单高效地解析。</p> <p><img src="/learn-book/assets/img/615b49f9d13de718a34b9b98359066e3.615b49f9.png" alt="img"></p> <p>帧开头是 3 个字节的 <strong>长度</strong>（但不包括头的 9 个字节），默认上限是 2^14，最大是 2^24，也就是说 HTTP/2 的帧通常不超过 16K，最大是 16M。</p> <p>长度后面的一个字节是 <strong>帧类型</strong> ，大致可以分成 <strong>数据帧</strong> 和 <strong>控制帧</strong> 两类，HEADERS 帧和 DATA 帧属于数据帧，存放的是 HTTP 报文，而 SETTINGS、PING、PRIORITY 等则是用来管理流的控制帧。</p> <p>HTTP/2 总共定义了 10 种类型的帧，但一个字节可以表示最多 256 种，所以也允许在标准之外定义其他类型实现功能扩展。这就有点像 TLS 里扩展协议的意思了，比如 Google 的 gRPC 就利用了这个特点，定义了几种自用的新帧类型。</p> <p>第 5 个字节是非常重要的 <strong>帧标志</strong> 信息，可以保存 8 个标志位，携带简单的控制信息。常用的标志位有 <strong>END_HEADERS</strong> 表示头数据结束，相当于 HTTP/1 里头后的空行（<code>\r\n</code>），<strong>END_STREAM</strong> 表示单方向数据发送结束（即 EOS，End of Stream），相当于 HTTP/1 里 Chunked 分块结束标志（ <code>0\r\n\r\n</code> ）。</p> <p>报文头里最后 4 个字节是 <strong>流标识符</strong> ，也就是帧所属的 <code>流</code> ，接收方使用它就可以从乱序的帧里识别出具有相同流 ID 的帧序列，按顺序组装起来就实现了虚拟的“流”。</p> <p>流标识符虽然有 4 个字节，但最高位被保留不用，所以只有 31 位可以使用，也就是说，流标识符的上限是 2^31，大约是 21 亿。</p> <p>好了，把二进制头理清楚后，我们来看一下 Wireshark 抓包的帧实例：</p> <p><img src="/learn-book/assets/img/57b0d1814567e6317c8de1e3c04b7503.57b0d181.png" alt="img"></p> <p>在这个帧里，开头的三个字节是 <code>00010a</code> ，表示数据长度是 266 字节。</p> <p>帧类型是 1，表示 HEADERS 帧，负载（payload）里面存放的是被 HPACK 算法压缩的头部信息。</p> <p>标志位是 0x25，转换成二进制有 3 个位被设置为 1。PRIORITY 表示设置了流的优先级，END_HEADERS 表示这一个帧就是完整的头数据，END_STREAM 表示单方向数据发送结束，后续再不会有数据帧（即请求报文完毕，不会再有 DATA 帧 /Body 数据）。</p> <p><img src="/learn-book/assets/img/image-20210312193750452.cb1831a3.png" alt="image-20210312193750452"></p> <p>最后 4 个字节的流标识符是整数 1，表示这是客户端发起的第一个流，后面的响应数据帧也会是这个 ID，也就是说在 stream[1] 里完成这个请求响应。</p> <h2 id="流与多路复用"><a href="#流与多路复用" class="header-anchor">#</a> 流与多路复用</h2> <p>弄清楚了帧结构后我们就来看 HTTP/2 的流与多路复用，它是 HTTP/2 最核心的部分。</p> <p>在上一讲里我简单介绍了流的概念，不知道你“悟”得怎么样了？这里我再重复一遍：<strong>流是二进制帧的双向传输序列</strong>。</p> <p>要搞明白流，关键是要理解帧头里的流 ID。</p> <p>在 HTTP/2 连接上，虽然帧是乱序收发的，但只要它们都拥有相同的流 ID，就都属于一个流，而且在这个流里帧不是无序的，而是有着严格的先后顺序。</p> <p>比如在这次的 Wireshark 抓包里，就有 <code>0、1、3</code> 一共三个流，实际上就是分配了三个流 ID 号，把这些帧按编号分组，再排一下队，就成了流。</p> <p><img src="/learn-book/assets/img/688630945be2dd51ca62515ae498db33.68863094.png" alt="img"></p> <p>可以看到，笔者感觉上，从这里看来，直接就是发的帧，感觉像是每一次会传输一批帧，类似与短时间的刷新缓冲区一样</p> <p>在概念上，一个 HTTP/2 的流就等同于一个 HTTP/1 里的 <code>请求 - 应答</code> 。在 HTTP/1 里一个请求 - 响应报文来回是一次 HTTP 通信，在 HTTP/2 里一个流也承载了相同的功能。</p> <p>你还可以对照着 TCP 来理解。TCP 运行在 IP 之上，其实从 MAC 层、IP 层的角度来看，TCP 的连接概念也是虚拟的。但从功能上看，无论是 HTTP/2 的流，还是 TCP 的连接，都是实际存在的，所以你以后大可不必再纠结于流的“虚拟”性，把它当做是一个真实存在的实体来理解就好。</p> <p>HTTP/2 的流有哪些特点呢？我给你简单列了一下：</p> <ol><li>流是可并发的，一个 HTTP/2 连接上可以同时发出多个流传输数据，也就是并发多请求，实现多路复用；</li> <li>客户端和服务器都可以创建流，双方互不干扰；</li> <li>流是双向的，一个流里面客户端和服务器都可以发送或接收数据帧，也就是一个请求 - 应答来回；</li> <li>流之间没有固定关系，彼此独立，但流内部的帧是有严格顺序的；</li> <li>流可以设置优先级，让服务器优先处理，比如先传 HTML/CSS，后传图片，优化用户体验；</li> <li>流 ID 不能重用，只能顺序递增，客户端发起的 ID 是奇数，服务器端发起的 ID 是偶数；</li> <li>在流上发送 RST_STREAM 帧可以随时终止流，取消接收或发送；</li> <li>第 0 号流比较特殊，不能关闭，也不能发送数据帧，只能发送控制帧，用于流量控制。</li></ol> <p>这里我又画了一张图，把上次的图略改了一下，显示了连接中无序的帧是如何依据流 ID 重组成流的。</p> <p><img src="/learn-book/assets/img/b49595a5a425c0e67d46ee17cc212e7e.b49595a5.png" alt="img"></p> <p>从这些特性中，我们还可以推理出一些深层次的知识点。</p> <p>比如说，HTTP/2 在一个连接上使用多个流收发数据，那么它本身默认就会是长连接，所以永远不需要“Connection”头字段（keepalive 或 close）。</p> <p>你可以再看一下 Wireshark 的抓包，里面发送了两个请求 <code>/31-1</code> 和 <code>favicon.ico</code> ，始终用的是 <code>56095&lt;-&gt;8443</code> 这个连接，对比一下  <a href="/learn-book/http-protocol/03/01.html">键入网址再按下回车，后面究竟发生了什么？</a> ，你就能够看出差异了。</p> <p>又比如，下载大文件的时候想取消接收，在 HTTP/1 里只能断开 TCP 连接重新 <strong>三次握手</strong> ，成本很高，而在 HTTP/2 里就可以简单地发送一个 <code>RST_STREAM</code> 中断流，而长连接会继续保持。</p> <p>再比如，因为客户端和服务器两端都可以创建流，而流 ID 有奇数偶数和上限的区分，所以大多数的流 ID 都会是奇数，而且客户端在一个连接里最多只能发出 2^30，也就是 10 亿个请求。</p> <p>所以就要问了：ID 用完了该怎么办呢？这个时候可以再发一个控制帧 <code>GOAWAY</code> ，真正关闭 TCP 连接。</p> <h2 id="流状态转换"><a href="#流状态转换" class="header-anchor">#</a> 流状态转换</h2> <p>流很重要，也很复杂。为了更好地描述运行机制，HTTP/2 借鉴了 TCP，根据帧的标志位实现流状态转换。当然，这些状态也是虚拟的，只是为了辅助理解。</p> <p>HTTP/2 的流也有一个状态转换图，虽然比 TCP 要简单一点，但也不那么好懂，所以今天我只画了一个简化的图，对应到一个标准的 HTTP 请求 - 应答。</p> <p><img src="/learn-book/assets/img/d389ac436d8100406a4a488a69563cb4.d389ac43.png" alt="img"></p> <p>最开始的时候流都是 <strong>空闲</strong>（idle）状态，也就是「不存在」，可以理解成是待分配的号段资源。</p> <p>当客户端发送 HEADERS 帧后，有了流 ID，流就进入了 <strong>打开</strong> 状态，两端都可以收发数据，然后客户端发送一个带 <code>END_STREAM</code> 标志位的帧，流就进入了 <strong>半关闭</strong> 状态。</p> <p>这个 <strong>半关闭</strong> 状态很重要，意味着客户端的请求数据已经发送完了，需要接受响应数据，而服务器端也知道请求数据接收完毕，之后就要内部处理，再发送响应数据。</p> <p>响应数据发完了之后，也要带上 <code>END_STREAM</code> 标志位，表示数据发送完毕，这样流两端就都进入了 <strong>关闭</strong> 状态，流就结束了。</p> <p>刚才也说过，流 ID 不能重用，所以流的生命周期就是 HTTP/1 里的一次完整的请求 - 应答，流关闭就是一次通信结束。</p> <p>下一次再发请求就要开一个新流（而不是新连接），流 ID 不断增加，直到到达上限，发送 <code>GOAWAY</code> 帧开一个新的 TCP 连接，流 ID 就又可以重头计数。</p> <p>你再看看这张图，是不是和 HTTP/1 里的标准请求 - 应答过程很像，只不过这是发生在虚拟的流上，而不是实际的 TCP 连接，又因为流可以并发，所以 HTTP/2 就可以实现无阻塞的多路复用。</p> <h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <p>HTTP/2 的内容实在是太多了，为了方便学习，我砍掉了一些特性，比如流的优先级、依赖关系、流量控制等。</p> <p>但只要你掌握了今天的这些内容，以后再看 RFC 文档都不会有难度了。</p> <ol><li>HTTP/2 必须先发送一个连接前言字符串，然后才能建立正式连接；</li> <li>HTTP/2 废除了起始行，统一使用头字段，在两端维护字段 <code>Key-Value</code> 的索引表，使用 <code>HPACK</code> 算法压缩头部；</li> <li>HTTP/2 把报文切分为多种类型的二进制帧，报头里最重要的字段是流标识符，标记帧属于哪个流；</li> <li>流是 HTTP/2 虚拟的概念，是帧的双向传输序列，相当于 HTTP/1 里的一次请求 - 应答；</li> <li>在一个 HTTP/2 连接上可以并发多个流，也就是多个“请求 - 响应”报文，这就是多路复用。</li></ol> <h2 id="课下作业"><a href="#课下作业" class="header-anchor">#</a> 课下作业</h2> <ol><li><p>HTTP/2 的动态表维护、流状态转换很复杂，你认为 HTTP/2 还是「无状态」的吗？</p> <p>还是无状态，流状态只是表示流是否建立，单次请求响应的状态。并非会话级的状态保持</p></li> <li><p>HTTP/2 的帧最大可以达到 16M，你觉得大帧好还是小帧好？</p> <p>小帧好，少量多次，万一拥堵重复的的少。假设大帧好，只要分流不用分帧了。</p></li> <li><p>结合这两讲，谈谈 HTTP/2 是如何解决队头阻塞问题的。</p> <p>每一个请求响应都是一个流，流和流之间可以并行，流内的帧还是有序串行</p></li></ol> <h2 id="拓展阅读"><a href="#拓展阅读" class="header-anchor">#</a> 拓展阅读</h2> <ul><li><p>你一定很好奇 HTTP/2 连接前言的来历吧，其实把里面的字符串连起来就是 <code>PRSM</code>，也就是 2013 年斯诺登爆岀的棱镜计划。</p></li> <li><p>在 HTTP/1 里头字段是不区分大小写的，这在实践中造成了一些混乱，写法很随意，所以 HTTP/2 做出了明确的规定，要求所有的头字段必须全小写，大写会认为是格式错误。</p></li> <li><p>HPACK 的编码规则比较复杂，使用了一些特殊的标志位，所以在 Wireshark 抓包里不会直接看到字段的索引号，需要按照规则解码。</p></li> <li><p>HEADERS 帧后还可以接特殊的「CONTINUATION」帧，发送特别大的头，最后一个「CONTNUATION」需要设置标志位 <code>END HEADERS</code> 表示头结束。</p></li> <li><p>服务器端发起推送流需要使用 <code>PUSH_PROMSE</code> 帧，状态转换与客户端流基本类似，只是方向不同。</p></li> <li><p>在 RST_STREAM 和 GOAWAY 帧里可以携带 32 位的错误代码，表示终止流的原因，它是真正的「错误」，与状态码的含义是不同的。</p></li> <li><p>服务端是不是要为每一个客户端都单独维护一份索引表？连接的客户端多了的话内存不就 OOM 了</p> <p>是的，不过动态表也有淘汰机制，服务器可以自己定制策略，不会过度占用内存。</p> <iframe height="500px" width="100%" frameborder="0" allowfullscreen="allowfullscreen" src="/learn-book/ads.html"></iframe></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/abc0721/learn-book/edit/main/docs/http-protocol/06/02.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022-07-21 21:38:52</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/learn-book/http-protocol/06/01.html" class="prev">
        01 | 时代之风：HTTP/2 特性概览
      </a></span> <span class="next"><a href="/learn-book/http-protocol/06/03.html">
        03 | 未来之路：HTTP/3 展望
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/learn-book/assets/js/app.028ed7df.js" defer></script><script src="/learn-book/assets/js/2.21223788.js" defer></script><script src="/learn-book/assets/js/6.41833f8f.js" defer></script><script src="/learn-book/assets/js/83.ec5af474.js" defer></script>
  </body>
</html>
