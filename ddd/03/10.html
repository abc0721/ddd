<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>20 | 总结（二）：分布式架构关键设计 10 问 | LEARN-BOOK</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/learn-book/favicon.ico">
    <link rel="manifest" href="/learn-book/manifest.json">
    <meta name="description" content="note-book 的第二分仓笔记仓库">
    
    <link rel="preload" href="/learn-book/assets/css/0.styles.d1598957.css" as="style"><link rel="preload" href="/learn-book/assets/js/app.028ed7df.js" as="script"><link rel="preload" href="/learn-book/assets/js/2.21223788.js" as="script"><link rel="preload" href="/learn-book/assets/js/316.faa4e876.js" as="script"><link rel="preload" href="/learn-book/assets/js/83.ec5af474.js" as="script"><link rel="prefetch" href="/learn-book/assets/js/10.ae9ef0d5.js"><link rel="prefetch" href="/learn-book/assets/js/100.e2686a94.js"><link rel="prefetch" href="/learn-book/assets/js/101.1e48f558.js"><link rel="prefetch" href="/learn-book/assets/js/102.2b0aead0.js"><link rel="prefetch" href="/learn-book/assets/js/103.36a9d0c5.js"><link rel="prefetch" href="/learn-book/assets/js/104.940c0889.js"><link rel="prefetch" href="/learn-book/assets/js/105.4059f322.js"><link rel="prefetch" href="/learn-book/assets/js/106.258dd171.js"><link rel="prefetch" href="/learn-book/assets/js/107.dc32950f.js"><link rel="prefetch" href="/learn-book/assets/js/108.f96a8dee.js"><link rel="prefetch" href="/learn-book/assets/js/109.ba4b933c.js"><link rel="prefetch" href="/learn-book/assets/js/11.a08a42ea.js"><link rel="prefetch" href="/learn-book/assets/js/110.3035f734.js"><link rel="prefetch" href="/learn-book/assets/js/111.fa05b698.js"><link rel="prefetch" href="/learn-book/assets/js/112.bbb150f0.js"><link rel="prefetch" href="/learn-book/assets/js/113.1263dcc6.js"><link rel="prefetch" href="/learn-book/assets/js/114.82285aec.js"><link rel="prefetch" href="/learn-book/assets/js/115.7509736a.js"><link rel="prefetch" href="/learn-book/assets/js/116.f57394f2.js"><link rel="prefetch" href="/learn-book/assets/js/117.9f37dd43.js"><link rel="prefetch" href="/learn-book/assets/js/118.73b62d5e.js"><link rel="prefetch" href="/learn-book/assets/js/119.ccc80315.js"><link rel="prefetch" href="/learn-book/assets/js/12.40792829.js"><link rel="prefetch" href="/learn-book/assets/js/120.0feeb1b4.js"><link rel="prefetch" href="/learn-book/assets/js/121.7bbdbedc.js"><link rel="prefetch" href="/learn-book/assets/js/122.f239e92d.js"><link rel="prefetch" href="/learn-book/assets/js/123.430e5350.js"><link rel="prefetch" href="/learn-book/assets/js/124.4a74a756.js"><link rel="prefetch" href="/learn-book/assets/js/125.9d441c34.js"><link rel="prefetch" href="/learn-book/assets/js/126.97b348bf.js"><link rel="prefetch" href="/learn-book/assets/js/127.85743ce6.js"><link rel="prefetch" href="/learn-book/assets/js/128.133b2151.js"><link rel="prefetch" href="/learn-book/assets/js/129.91eacdb7.js"><link rel="prefetch" href="/learn-book/assets/js/13.65102ef7.js"><link rel="prefetch" href="/learn-book/assets/js/130.00470fe8.js"><link rel="prefetch" href="/learn-book/assets/js/131.181aef24.js"><link rel="prefetch" href="/learn-book/assets/js/132.4166cdea.js"><link rel="prefetch" href="/learn-book/assets/js/133.ec5b9acc.js"><link rel="prefetch" href="/learn-book/assets/js/134.0c928687.js"><link rel="prefetch" href="/learn-book/assets/js/135.0b49f1c2.js"><link rel="prefetch" href="/learn-book/assets/js/136.be67ae82.js"><link rel="prefetch" href="/learn-book/assets/js/137.6f85ad05.js"><link rel="prefetch" href="/learn-book/assets/js/138.b3fa2ba7.js"><link rel="prefetch" href="/learn-book/assets/js/139.abf8672e.js"><link rel="prefetch" href="/learn-book/assets/js/14.4813a349.js"><link rel="prefetch" href="/learn-book/assets/js/140.d03ed1c1.js"><link rel="prefetch" href="/learn-book/assets/js/141.da6ec0e4.js"><link rel="prefetch" href="/learn-book/assets/js/142.09aed130.js"><link rel="prefetch" href="/learn-book/assets/js/143.4cffc3e5.js"><link rel="prefetch" href="/learn-book/assets/js/144.224499c6.js"><link rel="prefetch" href="/learn-book/assets/js/145.0268dd0e.js"><link rel="prefetch" href="/learn-book/assets/js/146.f0d0970e.js"><link rel="prefetch" href="/learn-book/assets/js/147.4a203a56.js"><link rel="prefetch" href="/learn-book/assets/js/148.3b084bf3.js"><link rel="prefetch" href="/learn-book/assets/js/149.d42b82bd.js"><link rel="prefetch" href="/learn-book/assets/js/15.ca243d77.js"><link rel="prefetch" href="/learn-book/assets/js/150.30cad9c9.js"><link rel="prefetch" href="/learn-book/assets/js/151.a27ba2c5.js"><link rel="prefetch" href="/learn-book/assets/js/152.8e388b90.js"><link rel="prefetch" href="/learn-book/assets/js/153.380f332c.js"><link rel="prefetch" href="/learn-book/assets/js/154.163b241b.js"><link rel="prefetch" href="/learn-book/assets/js/155.dacd37a6.js"><link rel="prefetch" href="/learn-book/assets/js/156.9296f4c8.js"><link rel="prefetch" href="/learn-book/assets/js/157.0c12b4ce.js"><link rel="prefetch" href="/learn-book/assets/js/158.79e7656c.js"><link rel="prefetch" href="/learn-book/assets/js/159.02749d11.js"><link rel="prefetch" href="/learn-book/assets/js/16.22ac0778.js"><link rel="prefetch" href="/learn-book/assets/js/160.3efbd6a0.js"><link rel="prefetch" href="/learn-book/assets/js/161.11e17eb7.js"><link rel="prefetch" href="/learn-book/assets/js/162.ed81bb49.js"><link rel="prefetch" href="/learn-book/assets/js/163.c321ec8d.js"><link rel="prefetch" href="/learn-book/assets/js/164.6831a594.js"><link rel="prefetch" href="/learn-book/assets/js/165.9e13a7e1.js"><link rel="prefetch" href="/learn-book/assets/js/166.20287335.js"><link rel="prefetch" href="/learn-book/assets/js/167.06fe0883.js"><link rel="prefetch" href="/learn-book/assets/js/168.574a5d34.js"><link rel="prefetch" href="/learn-book/assets/js/169.78d54345.js"><link rel="prefetch" href="/learn-book/assets/js/17.467198e5.js"><link rel="prefetch" href="/learn-book/assets/js/170.a8a8c838.js"><link rel="prefetch" href="/learn-book/assets/js/171.bce5528f.js"><link rel="prefetch" href="/learn-book/assets/js/172.6d122eaf.js"><link rel="prefetch" href="/learn-book/assets/js/173.b7b1734b.js"><link rel="prefetch" href="/learn-book/assets/js/174.0c5ddece.js"><link rel="prefetch" href="/learn-book/assets/js/175.fcb3bb1e.js"><link rel="prefetch" href="/learn-book/assets/js/176.4c8b6c1b.js"><link rel="prefetch" href="/learn-book/assets/js/177.2c821a10.js"><link rel="prefetch" href="/learn-book/assets/js/178.4b938acb.js"><link rel="prefetch" href="/learn-book/assets/js/179.e5a3f9d5.js"><link rel="prefetch" href="/learn-book/assets/js/18.2c2655d3.js"><link rel="prefetch" href="/learn-book/assets/js/180.e075e24a.js"><link rel="prefetch" href="/learn-book/assets/js/181.a8659308.js"><link rel="prefetch" href="/learn-book/assets/js/182.e02e157b.js"><link rel="prefetch" href="/learn-book/assets/js/183.fec3be72.js"><link rel="prefetch" href="/learn-book/assets/js/184.06841422.js"><link rel="prefetch" href="/learn-book/assets/js/185.967d47f7.js"><link rel="prefetch" href="/learn-book/assets/js/186.b27543eb.js"><link rel="prefetch" href="/learn-book/assets/js/187.0ab43110.js"><link rel="prefetch" href="/learn-book/assets/js/188.d2c20c41.js"><link rel="prefetch" href="/learn-book/assets/js/189.e50ac920.js"><link rel="prefetch" href="/learn-book/assets/js/19.87356261.js"><link rel="prefetch" href="/learn-book/assets/js/190.0bcce66f.js"><link rel="prefetch" href="/learn-book/assets/js/191.1a3d3266.js"><link rel="prefetch" href="/learn-book/assets/js/192.b46f1f92.js"><link rel="prefetch" href="/learn-book/assets/js/193.7cd9a2e2.js"><link rel="prefetch" href="/learn-book/assets/js/194.c7cac8f4.js"><link rel="prefetch" href="/learn-book/assets/js/195.76b36b43.js"><link rel="prefetch" href="/learn-book/assets/js/196.9ad5f9de.js"><link rel="prefetch" href="/learn-book/assets/js/197.2914f34f.js"><link rel="prefetch" href="/learn-book/assets/js/198.2e2c2c64.js"><link rel="prefetch" href="/learn-book/assets/js/199.0d8fc29e.js"><link rel="prefetch" href="/learn-book/assets/js/20.8693e977.js"><link rel="prefetch" href="/learn-book/assets/js/200.2bc59ffe.js"><link rel="prefetch" href="/learn-book/assets/js/201.6765dba2.js"><link rel="prefetch" href="/learn-book/assets/js/202.d19062c8.js"><link rel="prefetch" href="/learn-book/assets/js/203.270e8e72.js"><link rel="prefetch" href="/learn-book/assets/js/204.0ecf2cd8.js"><link rel="prefetch" href="/learn-book/assets/js/205.b241dd2b.js"><link rel="prefetch" href="/learn-book/assets/js/206.3d555da2.js"><link rel="prefetch" href="/learn-book/assets/js/207.b88d10dc.js"><link rel="prefetch" href="/learn-book/assets/js/208.d15b9895.js"><link rel="prefetch" href="/learn-book/assets/js/209.404964dd.js"><link rel="prefetch" href="/learn-book/assets/js/21.ce55ac2d.js"><link rel="prefetch" href="/learn-book/assets/js/210.8a6ad39b.js"><link rel="prefetch" href="/learn-book/assets/js/211.9f828903.js"><link rel="prefetch" href="/learn-book/assets/js/212.ecdb6c3d.js"><link rel="prefetch" href="/learn-book/assets/js/213.093b4b7f.js"><link rel="prefetch" href="/learn-book/assets/js/214.17e91916.js"><link rel="prefetch" href="/learn-book/assets/js/215.8f7b103b.js"><link rel="prefetch" href="/learn-book/assets/js/216.5a4cb55c.js"><link rel="prefetch" href="/learn-book/assets/js/217.850e8745.js"><link rel="prefetch" href="/learn-book/assets/js/218.b8913e63.js"><link rel="prefetch" href="/learn-book/assets/js/219.3260d54b.js"><link rel="prefetch" href="/learn-book/assets/js/22.2a565240.js"><link rel="prefetch" href="/learn-book/assets/js/220.6e440719.js"><link rel="prefetch" href="/learn-book/assets/js/221.ed0a4a3e.js"><link rel="prefetch" href="/learn-book/assets/js/222.ab1bbc7e.js"><link rel="prefetch" href="/learn-book/assets/js/223.b8d3fbb0.js"><link rel="prefetch" href="/learn-book/assets/js/224.eba39f96.js"><link rel="prefetch" href="/learn-book/assets/js/225.ba57ac7b.js"><link rel="prefetch" href="/learn-book/assets/js/226.760b4caf.js"><link rel="prefetch" href="/learn-book/assets/js/227.ff81b1ba.js"><link rel="prefetch" href="/learn-book/assets/js/228.15305fd8.js"><link rel="prefetch" href="/learn-book/assets/js/229.b1f93d41.js"><link rel="prefetch" href="/learn-book/assets/js/23.e4419686.js"><link rel="prefetch" href="/learn-book/assets/js/230.982e5c6c.js"><link rel="prefetch" href="/learn-book/assets/js/231.8ac0560e.js"><link rel="prefetch" href="/learn-book/assets/js/232.32eb3205.js"><link rel="prefetch" href="/learn-book/assets/js/233.cb14ad35.js"><link rel="prefetch" href="/learn-book/assets/js/234.0e3fb631.js"><link rel="prefetch" href="/learn-book/assets/js/235.1d7db823.js"><link rel="prefetch" href="/learn-book/assets/js/236.56df2b30.js"><link rel="prefetch" href="/learn-book/assets/js/237.56902777.js"><link rel="prefetch" href="/learn-book/assets/js/238.077f8961.js"><link rel="prefetch" href="/learn-book/assets/js/239.836f2633.js"><link rel="prefetch" href="/learn-book/assets/js/24.4ef60a35.js"><link rel="prefetch" href="/learn-book/assets/js/240.1958dc97.js"><link rel="prefetch" href="/learn-book/assets/js/241.628723f2.js"><link rel="prefetch" href="/learn-book/assets/js/242.80a9054d.js"><link rel="prefetch" href="/learn-book/assets/js/243.59d79e44.js"><link rel="prefetch" href="/learn-book/assets/js/244.d3442a00.js"><link rel="prefetch" href="/learn-book/assets/js/245.df290ae1.js"><link rel="prefetch" href="/learn-book/assets/js/246.bb4eb062.js"><link rel="prefetch" href="/learn-book/assets/js/247.c1cbe04d.js"><link rel="prefetch" href="/learn-book/assets/js/248.920787b0.js"><link rel="prefetch" href="/learn-book/assets/js/249.7ab19c67.js"><link rel="prefetch" href="/learn-book/assets/js/25.2b3311b7.js"><link rel="prefetch" href="/learn-book/assets/js/250.eacfb6a8.js"><link rel="prefetch" href="/learn-book/assets/js/251.44eb2a6b.js"><link rel="prefetch" href="/learn-book/assets/js/252.5af941db.js"><link rel="prefetch" href="/learn-book/assets/js/253.1d016c96.js"><link rel="prefetch" href="/learn-book/assets/js/254.3a6ec810.js"><link rel="prefetch" href="/learn-book/assets/js/255.77db8369.js"><link rel="prefetch" href="/learn-book/assets/js/256.a7b36739.js"><link rel="prefetch" href="/learn-book/assets/js/257.cffe71a4.js"><link rel="prefetch" href="/learn-book/assets/js/258.fdb4c219.js"><link rel="prefetch" href="/learn-book/assets/js/259.455a0c8b.js"><link rel="prefetch" href="/learn-book/assets/js/26.70973cf8.js"><link rel="prefetch" href="/learn-book/assets/js/260.f7d47a3e.js"><link rel="prefetch" href="/learn-book/assets/js/261.b1e2a5bf.js"><link rel="prefetch" href="/learn-book/assets/js/262.aaa755c2.js"><link rel="prefetch" href="/learn-book/assets/js/263.e838a513.js"><link rel="prefetch" href="/learn-book/assets/js/264.b8733c83.js"><link rel="prefetch" href="/learn-book/assets/js/265.c5fdd3c5.js"><link rel="prefetch" href="/learn-book/assets/js/266.e8d01769.js"><link rel="prefetch" href="/learn-book/assets/js/267.c9742e28.js"><link rel="prefetch" href="/learn-book/assets/js/268.2b148bef.js"><link rel="prefetch" href="/learn-book/assets/js/269.e03565b0.js"><link rel="prefetch" href="/learn-book/assets/js/27.8106f1e9.js"><link rel="prefetch" href="/learn-book/assets/js/270.65b5d908.js"><link rel="prefetch" href="/learn-book/assets/js/271.fbde0cac.js"><link rel="prefetch" href="/learn-book/assets/js/272.03745530.js"><link rel="prefetch" href="/learn-book/assets/js/273.8785fc29.js"><link rel="prefetch" href="/learn-book/assets/js/274.0ff015ae.js"><link rel="prefetch" href="/learn-book/assets/js/275.4fe4ba23.js"><link rel="prefetch" href="/learn-book/assets/js/276.26d537d4.js"><link rel="prefetch" href="/learn-book/assets/js/277.d95836c7.js"><link rel="prefetch" href="/learn-book/assets/js/278.eb312d49.js"><link rel="prefetch" href="/learn-book/assets/js/279.d0ce3bfd.js"><link rel="prefetch" href="/learn-book/assets/js/28.b3ebf8e6.js"><link rel="prefetch" href="/learn-book/assets/js/280.0c7ddd76.js"><link rel="prefetch" href="/learn-book/assets/js/281.94b40ca5.js"><link rel="prefetch" href="/learn-book/assets/js/282.4f902cb2.js"><link rel="prefetch" href="/learn-book/assets/js/283.834f65b2.js"><link rel="prefetch" href="/learn-book/assets/js/284.283c48cf.js"><link rel="prefetch" href="/learn-book/assets/js/285.4c68b9f5.js"><link rel="prefetch" href="/learn-book/assets/js/286.c34e142a.js"><link rel="prefetch" href="/learn-book/assets/js/287.b6713fe5.js"><link rel="prefetch" href="/learn-book/assets/js/288.cac84ba9.js"><link rel="prefetch" href="/learn-book/assets/js/289.9a6f3ebc.js"><link rel="prefetch" href="/learn-book/assets/js/29.e196143d.js"><link rel="prefetch" href="/learn-book/assets/js/290.fe2f74e5.js"><link rel="prefetch" href="/learn-book/assets/js/291.23dc1b91.js"><link rel="prefetch" href="/learn-book/assets/js/292.80606528.js"><link rel="prefetch" href="/learn-book/assets/js/293.aa013666.js"><link rel="prefetch" href="/learn-book/assets/js/294.0dee2576.js"><link rel="prefetch" href="/learn-book/assets/js/295.c731059a.js"><link rel="prefetch" href="/learn-book/assets/js/296.b226f176.js"><link rel="prefetch" href="/learn-book/assets/js/297.69f8e024.js"><link rel="prefetch" href="/learn-book/assets/js/298.8d2da06c.js"><link rel="prefetch" href="/learn-book/assets/js/299.e168b956.js"><link rel="prefetch" href="/learn-book/assets/js/3.e9334214.js"><link rel="prefetch" href="/learn-book/assets/js/30.0f44a043.js"><link rel="prefetch" href="/learn-book/assets/js/300.335941ee.js"><link rel="prefetch" href="/learn-book/assets/js/301.4bab8322.js"><link rel="prefetch" href="/learn-book/assets/js/302.2f5148b0.js"><link rel="prefetch" href="/learn-book/assets/js/303.2e8d30f0.js"><link rel="prefetch" href="/learn-book/assets/js/304.f0e9bbb8.js"><link rel="prefetch" href="/learn-book/assets/js/305.80fc4688.js"><link rel="prefetch" href="/learn-book/assets/js/306.f554b95c.js"><link rel="prefetch" href="/learn-book/assets/js/307.03aa7e5b.js"><link rel="prefetch" href="/learn-book/assets/js/308.af120a3e.js"><link rel="prefetch" href="/learn-book/assets/js/309.af606132.js"><link rel="prefetch" href="/learn-book/assets/js/31.00dd7380.js"><link rel="prefetch" href="/learn-book/assets/js/310.47599795.js"><link rel="prefetch" href="/learn-book/assets/js/311.00539011.js"><link rel="prefetch" href="/learn-book/assets/js/312.fbc57673.js"><link rel="prefetch" href="/learn-book/assets/js/313.8e8daad4.js"><link rel="prefetch" href="/learn-book/assets/js/314.268dcf0e.js"><link rel="prefetch" href="/learn-book/assets/js/315.aabe7e52.js"><link rel="prefetch" href="/learn-book/assets/js/317.d802eb3f.js"><link rel="prefetch" href="/learn-book/assets/js/318.c262b463.js"><link rel="prefetch" href="/learn-book/assets/js/319.24a8ff4d.js"><link rel="prefetch" href="/learn-book/assets/js/32.7c34bc5e.js"><link rel="prefetch" href="/learn-book/assets/js/320.9c7cda5a.js"><link rel="prefetch" href="/learn-book/assets/js/321.23b9a0be.js"><link rel="prefetch" href="/learn-book/assets/js/322.ad972338.js"><link rel="prefetch" href="/learn-book/assets/js/323.07f13ace.js"><link rel="prefetch" href="/learn-book/assets/js/324.18b8d5ae.js"><link rel="prefetch" href="/learn-book/assets/js/325.f01bde16.js"><link rel="prefetch" href="/learn-book/assets/js/326.629c1072.js"><link rel="prefetch" href="/learn-book/assets/js/327.39e6c9e2.js"><link rel="prefetch" href="/learn-book/assets/js/328.c699721e.js"><link rel="prefetch" href="/learn-book/assets/js/329.b54ab0db.js"><link rel="prefetch" href="/learn-book/assets/js/33.2386fa0f.js"><link rel="prefetch" href="/learn-book/assets/js/330.79e7cbcf.js"><link rel="prefetch" href="/learn-book/assets/js/331.377fadf6.js"><link rel="prefetch" href="/learn-book/assets/js/332.63cd94c2.js"><link rel="prefetch" href="/learn-book/assets/js/333.da52ece6.js"><link rel="prefetch" href="/learn-book/assets/js/334.5f196b50.js"><link rel="prefetch" href="/learn-book/assets/js/335.97b4ef4c.js"><link rel="prefetch" href="/learn-book/assets/js/336.e57f018e.js"><link rel="prefetch" href="/learn-book/assets/js/337.0a5a0859.js"><link rel="prefetch" href="/learn-book/assets/js/338.7a7f0b61.js"><link rel="prefetch" href="/learn-book/assets/js/339.7cd408bd.js"><link rel="prefetch" href="/learn-book/assets/js/34.0d02a15e.js"><link rel="prefetch" href="/learn-book/assets/js/340.04cb06e8.js"><link rel="prefetch" href="/learn-book/assets/js/341.537861d1.js"><link rel="prefetch" href="/learn-book/assets/js/342.da14f695.js"><link rel="prefetch" href="/learn-book/assets/js/343.74707d52.js"><link rel="prefetch" href="/learn-book/assets/js/344.b350096e.js"><link rel="prefetch" href="/learn-book/assets/js/345.dbf62aca.js"><link rel="prefetch" href="/learn-book/assets/js/346.3f255f50.js"><link rel="prefetch" href="/learn-book/assets/js/347.f4668b0d.js"><link rel="prefetch" href="/learn-book/assets/js/348.542573cc.js"><link rel="prefetch" href="/learn-book/assets/js/349.6888cb35.js"><link rel="prefetch" href="/learn-book/assets/js/35.74523ded.js"><link rel="prefetch" href="/learn-book/assets/js/350.cd705439.js"><link rel="prefetch" href="/learn-book/assets/js/351.093058d4.js"><link rel="prefetch" href="/learn-book/assets/js/352.77230cba.js"><link rel="prefetch" href="/learn-book/assets/js/353.8f883fac.js"><link rel="prefetch" href="/learn-book/assets/js/354.d52aee3e.js"><link rel="prefetch" href="/learn-book/assets/js/355.77a0126a.js"><link rel="prefetch" href="/learn-book/assets/js/356.dbf927e4.js"><link rel="prefetch" href="/learn-book/assets/js/357.0973baa0.js"><link rel="prefetch" href="/learn-book/assets/js/358.cac7fab3.js"><link rel="prefetch" href="/learn-book/assets/js/359.e8330d89.js"><link rel="prefetch" href="/learn-book/assets/js/36.0da2006f.js"><link rel="prefetch" href="/learn-book/assets/js/360.afef7c08.js"><link rel="prefetch" href="/learn-book/assets/js/361.6237f112.js"><link rel="prefetch" href="/learn-book/assets/js/362.34d1483e.js"><link rel="prefetch" href="/learn-book/assets/js/363.b7b45618.js"><link rel="prefetch" href="/learn-book/assets/js/364.e6d9ce62.js"><link rel="prefetch" href="/learn-book/assets/js/37.2fc83856.js"><link rel="prefetch" href="/learn-book/assets/js/38.79be50ee.js"><link rel="prefetch" href="/learn-book/assets/js/39.88a682f8.js"><link rel="prefetch" href="/learn-book/assets/js/4.0c4a4c2a.js"><link rel="prefetch" href="/learn-book/assets/js/40.e29bfa4b.js"><link rel="prefetch" href="/learn-book/assets/js/41.d4016d53.js"><link rel="prefetch" href="/learn-book/assets/js/42.c548ba43.js"><link rel="prefetch" href="/learn-book/assets/js/43.472c0c7f.js"><link rel="prefetch" href="/learn-book/assets/js/44.e0613af7.js"><link rel="prefetch" href="/learn-book/assets/js/45.e0c5b514.js"><link rel="prefetch" href="/learn-book/assets/js/46.0d833848.js"><link rel="prefetch" href="/learn-book/assets/js/47.167e51ca.js"><link rel="prefetch" href="/learn-book/assets/js/48.c55f2d7a.js"><link rel="prefetch" href="/learn-book/assets/js/49.600b0356.js"><link rel="prefetch" href="/learn-book/assets/js/5.c26035a1.js"><link rel="prefetch" href="/learn-book/assets/js/50.70947932.js"><link rel="prefetch" href="/learn-book/assets/js/51.924af1dd.js"><link rel="prefetch" href="/learn-book/assets/js/52.447da1c4.js"><link rel="prefetch" href="/learn-book/assets/js/53.b7e4c782.js"><link rel="prefetch" href="/learn-book/assets/js/54.4d31d080.js"><link rel="prefetch" href="/learn-book/assets/js/55.91a4b03c.js"><link rel="prefetch" href="/learn-book/assets/js/56.1cb7915e.js"><link rel="prefetch" href="/learn-book/assets/js/57.2affe6fc.js"><link rel="prefetch" href="/learn-book/assets/js/58.27d5c7cd.js"><link rel="prefetch" href="/learn-book/assets/js/59.2bd7f911.js"><link rel="prefetch" href="/learn-book/assets/js/6.41833f8f.js"><link rel="prefetch" href="/learn-book/assets/js/60.626def20.js"><link rel="prefetch" href="/learn-book/assets/js/61.45f51e6d.js"><link rel="prefetch" href="/learn-book/assets/js/62.4bdda78c.js"><link rel="prefetch" href="/learn-book/assets/js/63.557bc394.js"><link rel="prefetch" href="/learn-book/assets/js/64.aff699bf.js"><link rel="prefetch" href="/learn-book/assets/js/65.692f7816.js"><link rel="prefetch" href="/learn-book/assets/js/66.25ecbcaa.js"><link rel="prefetch" href="/learn-book/assets/js/67.8fa8a16e.js"><link rel="prefetch" href="/learn-book/assets/js/68.92b6a3f8.js"><link rel="prefetch" href="/learn-book/assets/js/69.efff96d2.js"><link rel="prefetch" href="/learn-book/assets/js/7.8100f2ed.js"><link rel="prefetch" href="/learn-book/assets/js/70.aacd8d45.js"><link rel="prefetch" href="/learn-book/assets/js/71.97a38b91.js"><link rel="prefetch" href="/learn-book/assets/js/72.fa0bbfba.js"><link rel="prefetch" href="/learn-book/assets/js/73.7065bf44.js"><link rel="prefetch" href="/learn-book/assets/js/74.cc9e8786.js"><link rel="prefetch" href="/learn-book/assets/js/75.9853915c.js"><link rel="prefetch" href="/learn-book/assets/js/76.3bb84aff.js"><link rel="prefetch" href="/learn-book/assets/js/77.1d7faa0b.js"><link rel="prefetch" href="/learn-book/assets/js/78.82ccf15d.js"><link rel="prefetch" href="/learn-book/assets/js/79.1ca14563.js"><link rel="prefetch" href="/learn-book/assets/js/8.a6e82c65.js"><link rel="prefetch" href="/learn-book/assets/js/80.009c8d78.js"><link rel="prefetch" href="/learn-book/assets/js/81.7c70581a.js"><link rel="prefetch" href="/learn-book/assets/js/82.25fa4637.js"><link rel="prefetch" href="/learn-book/assets/js/84.9e77b512.js"><link rel="prefetch" href="/learn-book/assets/js/85.bebb4293.js"><link rel="prefetch" href="/learn-book/assets/js/86.5a6fb0e3.js"><link rel="prefetch" href="/learn-book/assets/js/87.5a748d18.js"><link rel="prefetch" href="/learn-book/assets/js/88.17a0f517.js"><link rel="prefetch" href="/learn-book/assets/js/89.22035541.js"><link rel="prefetch" href="/learn-book/assets/js/9.5a3b25cd.js"><link rel="prefetch" href="/learn-book/assets/js/90.3222c7da.js"><link rel="prefetch" href="/learn-book/assets/js/91.4b34da5a.js"><link rel="prefetch" href="/learn-book/assets/js/92.9739a603.js"><link rel="prefetch" href="/learn-book/assets/js/93.38329abe.js"><link rel="prefetch" href="/learn-book/assets/js/94.52432e65.js"><link rel="prefetch" href="/learn-book/assets/js/95.363db7ac.js"><link rel="prefetch" href="/learn-book/assets/js/96.f5e07454.js"><link rel="prefetch" href="/learn-book/assets/js/97.76268626.js"><link rel="prefetch" href="/learn-book/assets/js/98.34e210bb.js"><link rel="prefetch" href="/learn-book/assets/js/99.d3018ce2.js">
    <link rel="stylesheet" href="/learn-book/assets/css/0.styles.d1598957.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-book/" class="home-link router-link-active"><img src="/learn-book/mlogo.svg" alt="LEARN-BOOK" class="logo"> <span class="site-name can-hide">LEARN-BOOK</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow down"></span></button> <button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="mobile-dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          综合性导航
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/" class="nav-link">
  全目录导航
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/001-introduce.html" class="nav-link">
  第一版（001 ~ 123 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/124.html" class="nav-link">
  第二版（124 ~ 195 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/121.html" class="nav-link">
  课程总结（难题与解决方案）
</a></li></ul></li><li class="dropdown-item"><h4>
          精彩知识精选
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/redis/007.html" class="nav-link">
  Redis 篇（redis 企业级集群架构）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/035.html" class="nav-link">
  多级缓存架构设计
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/040.html" class="nav-link">
  数据库 + 缓存双写一致性解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/045.html" class="nav-link">
  缓存维度化拆分解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/051.html" class="nav-link">
  缓存命中率提升解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/057.html" class="nav-link">
  缓存并发重建冲突解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/069.html" class="nav-link">
  缓存预热解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/077.html" class="nav-link">
  热点缓存自动降级方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/110.html" class="nav-link">
  缓存雪崩解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/117.html" class="nav-link">
  缓存穿透解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/119.html" class="nav-link">
  缓存失效解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/hystrix/084.html" class="nav-link">
  高可用分布式系统架构设计（hystrix 篇）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/047.html" class="nav-link">
  spring boot 整合 ehcache
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/storm/062.html" class="nav-link">
  史上最通俗易懂 Storm 教程
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程目录" class="dropdown-title"><span class="title">课程目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程目录" class="mobile-dropdown-title"><span class="title">课程目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn-book/monitor-tuning/" class="nav-link">
  JAVA 生产环境下性能监控与调优详解
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/http-protocol/" class="nav-link">
  透视 HTTP 协议
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/ddd/" class="nav-link router-link-active">
  DDD 实战课
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/middle-office/" class="nav-link">
  说透中台
</a></li><li class="dropdown-item"><h4>
          设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/imocc/design_pattern/" class="nav-link">
  设计模式（慕课）
</a></li><li class="dropdown-subitem"><a href="/learn-book/design_pattern/" class="nav-link">
  研磨设计模式（李兴华）
</a></li></ul></li></ul></div></div> <a href="https://github.com/abc0721/learn-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow down"></span></button> <button type="button" aria-label="缓存架构-亿级流量电商详情页系统实战" class="mobile-dropdown-title"><span class="title">缓存架构-亿级流量电商详情页系统实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          综合性导航
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/" class="nav-link">
  全目录导航
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/001-introduce.html" class="nav-link">
  第一版（001 ~ 123 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/124.html" class="nav-link">
  第二版（124 ~ 195 章）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/121.html" class="nav-link">
  课程总结（难题与解决方案）
</a></li></ul></li><li class="dropdown-item"><h4>
          精彩知识精选
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/redis/007.html" class="nav-link">
  Redis 篇（redis 企业级集群架构）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/035.html" class="nav-link">
  多级缓存架构设计
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/040.html" class="nav-link">
  数据库 + 缓存双写一致性解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/045.html" class="nav-link">
  缓存维度化拆分解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/051.html" class="nav-link">
  缓存命中率提升解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/057.html" class="nav-link">
  缓存并发重建冲突解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/069.html" class="nav-link">
  缓存预热解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/077.html" class="nav-link">
  热点缓存自动降级方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/110.html" class="nav-link">
  缓存雪崩解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/117.html" class="nav-link">
  缓存穿透解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/119.html" class="nav-link">
  缓存失效解决方案
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/hystrix/084.html" class="nav-link">
  高可用分布式系统架构设计（hystrix 篇）
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/047.html" class="nav-link">
  spring boot 整合 ehcache
</a></li><li class="dropdown-subitem"><a href="/learn-book/cache-pdp/storm/062.html" class="nav-link">
  史上最通俗易懂 Storm 教程
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程目录" class="dropdown-title"><span class="title">课程目录</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程目录" class="mobile-dropdown-title"><span class="title">课程目录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn-book/monitor-tuning/" class="nav-link">
  JAVA 生产环境下性能监控与调优详解
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/http-protocol/" class="nav-link">
  透视 HTTP 协议
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/ddd/" class="nav-link router-link-active">
  DDD 实战课
</a></li><li class="dropdown-item"><!----> <a href="/learn-book/middle-office/" class="nav-link">
  说透中台
</a></li><li class="dropdown-item"><h4>
          设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn-book/imocc/design_pattern/" class="nav-link">
  设计模式（慕课）
</a></li><li class="dropdown-subitem"><a href="/learn-book/design_pattern/" class="nav-link">
  研磨设计模式（李兴华）
</a></li></ul></li></ul></div></div> <a href="https://github.com/abc0721/learn-book" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/learn-book/ddd/" aria-current="page" class="sidebar-link">DDD 实战课</a></li><li><a href="/learn-book/ddd/00/" class="sidebar-link">开篇 | 学好了 DDD，你能做什么？</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/ddd/01/" class="sidebar-heading clickable"><span>基础篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/ddd/02/" class="sidebar-heading clickable"><span>进阶篇</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn-book/ddd/03/" class="sidebar-heading clickable router-link-active open"><span>实战篇</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-book/ddd/03/01.html" class="sidebar-link">11 | DDD 实践：如何用 DDD 重构中台业务模型？</a></li><li><a href="/learn-book/ddd/03/02.html" class="sidebar-link">12 | 领域建模：如何用事件风暴构建领域模型？</a></li><li><a href="/learn-book/ddd/03/03.html" class="sidebar-link">13 | 代码模型（上）：如何使用 DDD 设计微服务代码模型？</a></li><li><a href="/learn-book/ddd/03/04.html" class="sidebar-link">14 | 代码模型（下）：如何保证领域模型与代码模型的一致性？</a></li><li><a href="/learn-book/ddd/03/05.html" class="sidebar-link">15 | 边界：微服务的各种边界在架构演进中的作用？</a></li><li><a href="/learn-book/ddd/03/06.html" class="sidebar-link">16 | 视图：如何实现服务和数据在微服务各层的协作？</a></li><li><a href="/learn-book/ddd/03/07.html" class="sidebar-link">17 | 从后端到前端：微服务后，前端如何设计？</a></li><li><a href="/learn-book/ddd/03/08.html" class="sidebar-link">18 | 知识点串讲：基于 DDD 的微服务设计实例</a></li><li><a href="/learn-book/ddd/03/09.html" class="sidebar-link">19 | 总结（一）：微服务设计和拆分要坚持哪些原则？</a></li><li><a href="/learn-book/ddd/03/10.html" aria-current="page" class="active sidebar-link">20 | 总结（二）：分布式架构关键设计 10 问</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#一、选择什么样的分布式数据库" class="sidebar-link">一、选择什么样的分布式数据库？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#_1-一体化分布式数据库方案" class="sidebar-link">1. 一体化分布式数据库方案</a></li><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#_2-集中式数据库-数据库中间件方案" class="sidebar-link">2. 集中式数据库 + 数据库中间件方案</a></li><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#_3-集中式数据库-分库类库方案" class="sidebar-link">3. 集中式数据库 + 分库类库方案</a></li></ul></li><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#二、如何设计数据库分库主键" class="sidebar-link">二、如何设计数据库分库主键？</a></li><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#三、数据库的数据同步和复制" class="sidebar-link">三、数据库的数据同步和复制</a></li><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#四、跨库关联查询如何处理" class="sidebar-link">四、跨库关联查询如何处理？</a></li><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#五、如何处理高频热点数据" class="sidebar-link">五、如何处理高频热点数据？</a></li><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#六、前后序业务数据的处理" class="sidebar-link">六、前后序业务数据的处理</a></li><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#七、数据中台与企业级数据集成" class="sidebar-link">七、数据中台与企业级数据集成</a></li><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#八、bff-与企业级业务编排和协同" class="sidebar-link">八、BFF 与企业级业务编排和协同</a></li><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#九、分布式事务还是事件驱动机制" class="sidebar-link">九、分布式事务还是事件驱动机制？</a></li><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#十、多中心多活的设计" class="sidebar-link">十、多中心多活的设计</a></li><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/learn-book/ddd/03/10.html#思考题" class="sidebar-link">思考题</a></li></ul></li></ul></section></li><li><a href="/learn-book/ddd/04/" class="sidebar-link">结束 | 所谓高手，就是跨过坑和大海！</a></li><li><a href="/learn-book/ddd/04/01.html" class="sidebar-link">基于 DDD 的微服务设计实例代码详解</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_20-总结-二-分布式架构关键设计-10-问"><a href="#_20-总结-二-分布式架构关键设计-10-问" class="header-anchor">#</a> 20 | 总结（二）：分布式架构关键设计 10 问</h1> <p>前面我们重点讲述了领域建模、微服务设计和前端设计方法，它们组合在一起就可以形成中台建设的整体解决方案。而中台大多基于分布式微服务架构，这种企业级的数字化转型有很多地方值得我们关注和思考。</p> <p>我们不仅要关注企业商业模式、业务边界以及前中台的融合，还要关注数据技术体系、微服务设计、多活等多领域的设计和协同。结合实施经验和思考，今天我们就来聊聊分布式架构下的几个关键问题。</p> <h2 id="一、选择什么样的分布式数据库"><a href="#一、选择什么样的分布式数据库" class="header-anchor">#</a> 一、选择什么样的分布式数据库？</h2> <p>分布式架构下的数据应用场景远比集中式架构复杂，会产生很多数据相关的问题。谈到数据，首先就是要选择合适的分布式数据库。</p> <p>分布式数据库大多采用数据多副本的方式，实现数据访问的高性能、多活和容灾。目前主要有三种不同的分布式数据库解决方案。它们的主要差异是数据多副本的处理方式和数据库中间件。</p> <h3 id="_1-一体化分布式数据库方案"><a href="#_1-一体化分布式数据库方案" class="header-anchor">#</a> 1. 一体化分布式数据库方案</h3> <p>它支持数据多副本、高可用。多采用 Paxos 协议，一次写入多数据副本，多数副本写入成功即算成功。代表产品是 OceanBase 和高斯数据库。</p> <h3 id="_2-集中式数据库-数据库中间件方案"><a href="#_2-集中式数据库-数据库中间件方案" class="header-anchor">#</a> 2. 集中式数据库 + 数据库中间件方案</h3> <p>它是集中式数据库与数据库中间件结合的方案，通过数据库中间件实现数据路由和全局数据管理。数据库中间件和数据库独立部署，采用数据库自身的同步机制实现主副本数据的一致性。集中式数据库主要有 MySQL 和 PostgreSQL 数据库，基于这两种数据库衍生出了很多的解决方案，比如开源数据库中间件 MyCat+MySQL 方案，TBase（基于 PostgreSQL，但做了比较大的封装和改动）等方案。</p> <h3 id="_3-集中式数据库-分库类库方案"><a href="#_3-集中式数据库-分库类库方案" class="header-anchor">#</a> 3. 集中式数据库 + 分库类库方案</h3> <p>它是一种轻量级的数据库中间件方案，分库类库实际上是一个基础 JAR 包，与应用软件部署在一起，实现数据路由和数据归集。它适合比较简单的读写交易场景，在强一致性和聚合分析查询方面相对较弱。典型分库基础组件有 ShardingSphere。</p> <p><strong>小结：</strong> 这三种方案实施成本不一样，业务支持能力差异也比较大。一体化分布式数据库主要由互联网大厂开发，具有超强的数据处理能力，大多需要云计算底座，实施成本和技术能力要求比较高。集中式数据库 + 数据库中间件方案，实施成本和技术能力要求适中，可满足中大型企业业务要求。第三种分库类库的方案可处理简单的业务场景，成本和技能要求相对较低。在选择数据库的时候，我们要考虑自身能力、成本以及业务需要，从而选择合适的方案。</p> <h2 id="二、如何设计数据库分库主键"><a href="#二、如何设计数据库分库主键" class="header-anchor">#</a> 二、如何设计数据库分库主键？</h2> <p>选择了分布式数据库，第二步就要考虑数据分库，这时分库主键的设计就很关键了。</p> <p>与客户接触的关键业务，我建议你以客户 ID 作为分库主键。这样可以确保同一个客户的数据分布在同一个数据单元内，避免出现跨数据单元的频繁数据访问。跨数据中心的频繁服务调用或跨数据单元的查询，会对系统性能造成致命的影响。</p> <p>将客户的所有数据放在同一个数据单元，对客户来说也更容易提供客户一致性服务。而对企业来说，“以客户为中心”的业务能力，首先就要做到数据上的“以客户为中心”。</p> <p>当然，你也可以根据业务需要用其它的业务属性作为分库主键，比如机构、用户等。</p> <h2 id="三、数据库的数据同步和复制"><a href="#三、数据库的数据同步和复制" class="header-anchor">#</a> 三、数据库的数据同步和复制</h2> <p>在微服务架构中，数据被进一步分割。为了实现数据的整合，数据库之间批量数据同步与复制是必不可少的。数据同步与复制主要用于数据库之间的数据同步，实现业务数据迁移、数据备份、不同渠道核心业务数据向数据平台或数据中台的数据复制、以及不同主题数据的整合等。</p> <p>传统的数据传输方式有 ETL 工具和定时提数程序，但数据在时效性方面存在短板。分布式架构一般采用基于数据库逻辑日志增量数据捕获（CDC）技术，它可以实现准实时的数据复制和传输，实现数据处理与应用逻辑解耦，使用起来更加简单便捷。</p> <p>现在主流的 PostgreSQL 和 MySQL 数据库外围，有很多数据库日志捕获技术组件。CDC 也可以用在领域事件驱动设计中，作为领域事件增量数据的获取技术。</p> <h2 id="四、跨库关联查询如何处理"><a href="#四、跨库关联查询如何处理" class="header-anchor">#</a> 四、跨库关联查询如何处理？</h2> <p>跨库关联查询是分布式数据库的一个短板，会影响查询性能。在领域建模时，很多实体会分散到不同的微服务中，但很多时候会因为业务需求，它们之间需要关联查询。</p> <p>关联查询的业务场景包括两类：</p> <ul><li>第一类是基于某一维度或某一主题域的数据查询，比如基于客户全业务视图的数据查询，这种查询会跨多个业务线的微服务；</li> <li>第二类是表与表之间的关联查询，比如机构表与业务表的联表查询，但机构表和业务表分散在不同的微服务。</li></ul> <p><strong>如何解决这两类关联查询呢？</strong></p> <p>对于第一类场景，由于数据分散在不同微服务里，我们无法跨多个微服务来统计这些数据。你可以建立面向主题的分布式数据库，它的数据来源于不同业务的微服务。采用数据库日志捕获技术，从各业务端微服务将数据准实时汇集到主题数据库。在数据汇集时，提前做好数据关联（如将多表数据合并为一个宽表）或者建立数据模型。面向主题数据库建设查询微服务。这样一次查询你就可以获取客户所有维度的业务数据了。你还可以根据主题或场景设计合适的分库主键，提高查询效率。</p> <p>对于第二类场景，对于不在同一个数据库的表与表之间的关联查询场景，你可以采用小表广播，在业务库中增加一张冗余的代码副表。当主表数据发生变化时，你可以通过消息发布和订阅的领域事件驱动模式，异步刷新所有副表数据。这样既可以解决表与表的关联查询，还可以提高数据的查询效率。</p> <h2 id="五、如何处理高频热点数据"><a href="#五、如何处理高频热点数据" class="header-anchor">#</a> 五、如何处理高频热点数据？</h2> <p>对于高频热点数据，比如商品、机构等代码类数据，它们同时面向多个应用，要有很高的并发响应能力。它们会给数据库带来巨大的访问压力，影响系统的性能。</p> <p>常见的做法是将这些高频热点数据，从数据库加载到如 Redis 等缓存中，通过缓存提供数据访问服务。这样既可以降低数据库的压力，还可以提高数据的访问性能。</p> <p>另外，对需要模糊查询的高频数据，你也可以选用 ElasticSearch 等搜索引擎。</p> <p>缓存就像调味料一样，投入小、见效快，用户体验提升快。</p> <h2 id="六、前后序业务数据的处理"><a href="#六、前后序业务数据的处理" class="header-anchor">#</a> 六、前后序业务数据的处理</h2> <p>在微服务设计时你会经常发现，某些数据需要关联前序微服务的数据。比如：在保险业务中，投保微服务生成投保单后，保单会关联前序投保单数据等。在电商业务中，货物运输单会关联前序订单数据。由于关联的数据分散在业务的前序微服务中，你无法通过不同微服务的数据库来给它们建立数据关联。</p> <p><strong>如何解决这种前后序的实体关联呢？</strong></p> <p>一般来说，前后序的数据都跟领域事件有关。你可以通过领域事件处理机制，按需将前序数据通过领域事件实体，传输并冗余到当前的微服务数据库中。</p> <p>你可以将前序数据设计为实体或者值对象，并被当前实体引用。在设计时你需要关注以下内容：如果前序数据在当前微服务只可整体修改，并且不会对它做查询和统计分析，你可以将它设计为值对象；当前序数据是多条，并且需要做查询和统计分析，你可以将它设计为实体。</p> <p>这样，你可以在货物运输微服务，一次获取前序订单的清单数据和货物运输单数据，将所有数据一次反馈给前端应用，降低跨微服务的调用。如果前序数据被设计为实体，你还可以将前序数据作为查询条件，在本地微服务完成多维度的综合数据查询。只有必要时才从前序微服务，获取前序实体的明细数据。这样，既可以保证数据的完整性，还可以降低微服务的依赖，减少跨微服务调用，提升系统性能。</p> <h2 id="七、数据中台与企业级数据集成"><a href="#七、数据中台与企业级数据集成" class="header-anchor">#</a> 七、数据中台与企业级数据集成</h2> <p>分布式微服务架构虽然提升了应用弹性和高可用能力，但原来集中的数据会随着微服务拆分而形成很多数据孤岛，增加数据集成和企业级数据使用的难度。你可以通过数据中台来实现数据融合，解决分布式架构下的数据应用和集成问题。</p> <p><strong>你可以分三步来建设数据中台。</strong></p> <p>第一，按照统一数据标准，完成不同微服务和渠道业务数据的汇集和存储，解决数据孤岛和初级数据共享的问题。</p> <p>第二，建立主题数据模型，按照不同主题和场景对数据进行加工处理，建立面向不同主题的数据视图，比如客户统一视图、代理人视图和渠道视图等。</p> <p>第三，建立业务需求驱动的数据体系，支持业务和商业模式创新。</p> <p>数据中台不仅限于分析场景，也适用于交易型场景。你可以建立在数据仓库和数据平台上，将数据平台化之后提供给前台业务使用，为交易</p> <h2 id="八、bff-与企业级业务编排和协同"><a href="#八、bff-与企业级业务编排和协同" class="header-anchor">#</a> 八、BFF 与企业级业务编排和协同</h2> <p>企业级业务流程往往是多个微服务一起协作完成的，每个单一职责的微服务就像积木块，它们只完成自己特定的功能。那如何组织这些微服务，完成企业级业务编排和协同呢？</p> <p>你可以在微服务和前端应用之间，增加一层 BFF 微服务（Backend for Frontends）。<strong>BFF 主要职责是处理微服务之间的服务组合和编排</strong> ，微服务内的应用服务也是处理服务的组合和编排，那这二者有什么差异呢？</p> <p>BFF 位于中台微服务之上，主要职责是微服务之间的服务协调；<strong>应用服务主要处理微服务内的服务组合和编排。</strong> 在设计时我们应尽可能地将可复用的服务能力往下层沉淀，在实现能力复用的同时，还可以避免跨中心的服务调用。</p> <p>BFF 像齿轮一样，来适配前端应用与微服务之间的步调。它通过 Façade 服务适配不同的前端，通过服务组合和编排，组织和协调微服务。BFF 微服务可根据需求和流程变化，与前端应用版本协同发布，避免中台微服务为适配前端需求的变化，而频繁地修改和发布版本，从而保证微服务核心领域逻辑的稳定。</p> <p>如果你的 BFF 做得足够强大，它就是一个集成了不同中台微服务能力、面向多渠道应用的业务能力平台。场景提供支持。</p> <h2 id="九、分布式事务还是事件驱动机制"><a href="#九、分布式事务还是事件驱动机制" class="header-anchor">#</a> 九、分布式事务还是事件驱动机制？</h2> <p>分布式架构下，原来单体的内部调用，会变成分布式调用。如果一个操作涉及多个微服务的数据修改，就会产生数据一致性的问题。数据一致性有强一致性和最终一致性两种，它们实现方案不一样，实施代价也不一样。</p> <p>对于实时性要求高的强一致性业务场景，你可以采用分布式事务，但分布式事务有性能代价，在设计时我们需平衡考虑业务拆分、数据一致性、性能和实现的复杂度，尽量避免分布式事务的产生。</p> <p>领域事件驱动的异步方式是分布式架构常用的设计方法，它可以解决非实时场景的数据最终一致性问题。基于消息中间件的领域事件发布和订阅，可以很好地解耦微服务。通过削峰填谷，可以减轻数据库实时访问压力，提高业务吞吐量和处理能力。你还可以通过事件驱动实现读写分离，提高数据库访问性能。对最终一致性的场景，我建议你采用领域事件驱动的设计方法。</p> <h2 id="十、多中心多活的设计"><a href="#十、多中心多活的设计" class="header-anchor">#</a> 十、多中心多活的设计</h2> <p>分布式架构的高可用主要通过多活设计来实现，多中心多活是一个非常复杂的工程，下面我主要列出以下几个关键的设计。</p> <ol><li><p>选择合适的分布式数据库。数据库应该支持多数据中心部署，满足数据多副本以及数据底层复制和同步技术要求，以及数据恢复的时效性要求。</p></li> <li><p>单元化架构设计。将若干个应用组成的业务单元作为部署的基本单位，实现同城和异地多活部署，以及跨中心弹性扩容。各单元业务功能自包含，所有业务流程都可在本单元完成；任意单元的数据在多个数据中心有副本，不会因故障而造成数据丢失；任何单元故障不影响其它同类单元的正常运行。单元化设计时我们要尽量避免跨数据中心和单元的调用。</p></li> <li><p>访问路由。访问路由包括接入层、应用层和数据层的路由，确保前端访问能够按照路由准确到达数据中心和业务单元，准确写入或获取业务数据所在的数据库。</p></li> <li><p>全局配置数据管理。实现各数据中心全局配置数据的统一管理，每个数据中心全局配置数据实时同步，保证数据的一致性。</p></li></ol> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>企业级分布式架构的实施是一个非常复杂的系统工程，涉及到非常多的技术体系和方法。今天我罗列了 10 个关键的设计领域，每个领域其实都非常复杂，需要很多的投入和研究。在实施的时候，你和你的公司要结合自身情况来选择合适的技术组件和实施方案。</p> <h2 id="思考题"><a href="#思考题" class="header-anchor">#</a> 思考题</h2> <p>在分布式架构设计时，你遇到过哪些问题？有什么样的解决方案？</p> <iframe height="500px" width="100%" frameborder="0" allowfullscreen="allowfullscreen" src="/learn-book/ads.html"></iframe></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/abc0721/learn-book/edit/main/docs/ddd/03/10.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022-07-21 21:38:52</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/learn-book/ddd/03/09.html" class="prev">
        19 | 总结（一）：微服务设计和拆分要坚持哪些原则？
      </a></span> <span class="next"><a href="/learn-book/ddd/04/">
        结束 | 所谓高手，就是跨过坑和大海！
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/learn-book/assets/js/app.028ed7df.js" defer></script><script src="/learn-book/assets/js/2.21223788.js" defer></script><script src="/learn-book/assets/js/316.faa4e876.js" defer></script><script src="/learn-book/assets/js/83.ec5af474.js" defer></script>
  </body>
</html>
